{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/polls/webpack/bootstrap","webpack://@fof/polls/webpack/runtime/compat get default export","webpack://@fof/polls/webpack/runtime/define property getters","webpack://@fof/polls/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/polls/webpack/runtime/make namespace object","webpack://@fof/polls/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Badge']\"","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@fof/polls/./src/forum/addDiscussionBadge.js","webpack://@fof/polls/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@fof/polls/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/polls/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Button']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/polls/./src/forum/components/CreatePollModal.js","webpack://@fof/polls/./src/forum/addComposerItems.js","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Link']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/polls/./src/forum/components/ListVotersModal.js","webpack://@fof/polls/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@fof/polls/./src/forum/components/EditPollModal.js","webpack://@fof/polls/./src/forum/components/PostPoll.js","webpack://@fof/polls/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@fof/polls/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/polls/external root \"flarum.core.compat['forum/utils/PostControls']\"","webpack://@fof/polls/./src/forum/components/index.js","webpack://@fof/polls/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/polls/./src/forum/models/Poll.js","webpack://@fof/polls/./src/forum/models/PollOption.js","webpack://@fof/polls/./src/forum/models/PollVote.js","webpack://@fof/polls/./src/forum/models/index.js","webpack://@fof/polls/external root \"flarum.core.compat['common/extenders']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/models/Post']\"","webpack://@fof/polls/external root \"flarum.core.compat['common/models/Forum']\"","webpack://@fof/polls/./src/forum/extend.js","webpack://@fof/polls/./src/forum/index.js","webpack://@fof/polls/./src/forum/addPostControls.js","webpack://@fof/polls/./src/forum/addPollsToPost.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Badge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Discussion'];","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport Badge from 'flarum/common/components/Badge';\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\nimport Discussion from 'flarum/common/models/Discussion';\n\nexport default () => {\n  extend(DiscussionList.prototype, 'requestParams', (params) => {\n    params.include.push('poll');\n  });\n\n  extend(Discussion.prototype, 'badges', function (badges) {\n    if (this.hasPoll()) {\n      badges.add(\n        'poll',\n        Badge.component({\n          type: 'poll',\n          label: app.translator.trans('fof-polls.forum.tooltip.badge'),\n          icon: 'fas fa-signal',\n        }),\n        5\n      );\n    }\n  });\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import app from 'flarum/forum/app';\n\nimport Button from 'flarum/common/components/Button';\nimport Modal from 'flarum/common/components/Modal';\nimport Switch from 'flarum/common/components/Switch';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport default class CreatePollModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.options = [Stream(''), Stream('')];\n    this.optionImageUrls = [Stream(''), Stream('')];\n\n    this.question = Stream('');\n\n    this.endDate = Stream();\n\n    this.publicPoll = Stream(false);\n    this.allowMultipleVotes = Stream(false);\n    this.maxVotes = Stream(0);\n\n    this.datepickerMinDate = this.formatDate(undefined);\n\n    const { poll } = this.attrs;\n\n    // When re-opening the modal for the same discussion composer where we already set poll attributes\n    if (poll && Array.isArray(poll.options)) {\n      this.options = [];\n      this.optionImageUrls = [];\n      poll.options.forEach((option) => {\n        this.options.push(Stream(option.answer));\n        this.optionImageUrls.push(Stream(option.imageUrl));\n      });\n\n      this.question(poll.question);\n      this.publicPoll(poll.publicPoll);\n\n      this.endDate(this.formatDate(poll.endDate));\n\n      // Replace minimum of 'today' for poll end date only if the poll is not already closed\n      if (this.endDate() && dayjs(poll.endDate).isAfter(dayjs())) {\n        this.datepickerMinDate = this.formatDate(poll.endDate);\n      }\n    }\n  }\n\n  title() {\n    return app.translator.trans('fof-polls.forum.modal.add_title');\n  }\n\n  className() {\n    return 'PollDiscussionModal Modal--medium';\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"PollDiscussionModal-form\">{this.fields().toArray()}</div>\n      </div>,\n    ];\n  }\n\n  fields() {\n    const items = new ItemList();\n\n    items.add(\n      'question',\n      <div className=\"Form-group\">\n        <label className=\"label\">{app.translator.trans('fof-polls.forum.modal.question_placeholder')}</label>\n\n        <input type=\"text\" name=\"question\" className=\"FormControl\" bidi={this.question} />\n      </div>,\n      100\n    );\n\n    items.add(\n      'answers',\n      <div className=\"PollModal--answers Form-group\">\n        <label className=\"label PollModal--answers-title\">\n          <span>{app.translator.trans('fof-polls.forum.modal.options_label')}</span>\n\n          {Button.component({\n            className: 'Button PollModal--button small',\n            icon: 'fas fa-plus',\n            onclick: this.addOption.bind(this),\n          })}\n        </label>\n\n        {this.displayOptions()}\n      </div>,\n      80\n    );\n\n    items.add(\n      'date',\n      <div className=\"Form-group\">\n        <label className=\"label\">{app.translator.trans('fof-polls.forum.modal.date_placeholder')}</label>\n\n        <div className=\"PollModal--date\">\n          <input className=\"FormControl\" type=\"datetime-local\" name=\"date\" bidi={this.endDate} min={this.datepickerMinDate} />\n          {Button.component({\n            className: 'Button PollModal--button',\n            icon: 'fas fa-times',\n            onclick: this.endDate.bind(this, null),\n          })}\n        </div>\n\n        {this.endDate() && (\n          <p className=\"helpText\">\n            <i class=\"icon fas fa-clock\" />\n            &nbsp;\n            {dayjs(this.endDate()).isBefore(dayjs())\n              ? app.translator.trans('fof-polls.forum.poll_ended')\n              : app.translator.trans('fof-polls.forum.days_remaining', { time: dayjs(this.endDate()).fromNow() })}\n          </p>\n        )}\n      </div>,\n      40\n    );\n\n    items.add(\n      'public',\n      <div className=\"Form-group\">\n        {Switch.component(\n          {\n            state: this.publicPoll() || false,\n            onchange: this.publicPoll,\n          },\n          app.translator.trans('fof-polls.forum.modal.public_poll_label')\n        )}\n      </div>,\n      20\n    );\n\n    items.add(\n      'allow-multiple-votes',\n      <div className=\"Form-group\">\n        {Switch.component(\n          {\n            state: this.allowMultipleVotes() || false,\n            onchange: this.allowMultipleVotes,\n          },\n          app.translator.trans('fof-polls.forum.modal.allow_multiple_votes_label')\n        )}\n      </div>,\n      15\n    );\n\n    if (this.allowMultipleVotes()) {\n      items.add(\n        'max-votes',\n        <div className=\"Form-group\">\n          <label className=\"label\">{app.translator.trans('fof-polls.forum.modal.max_votes_label')}</label>\n\n          <input type=\"number\" min=\"0\" max={this.options.length} name=\"maxVotes\" className=\"FormControl\" bidi={this.maxVotes} />\n\n          <p className=\"helpText\">{app.translator.trans('fof-polls.forum.modal.max_votes_help')}</p>\n        </div>,\n        15\n      );\n    }\n\n    items.add(\n      'submit',\n      <div className=\"Form-group\">\n        {Button.component(\n          {\n            type: 'submit',\n            className: 'Button Button--primary PollModal-SubmitButton',\n            loading: this.loading,\n          },\n          app.translator.trans('fof-polls.forum.modal.submit')\n        )}\n      </div>,\n      -10\n    );\n\n    return items;\n  }\n\n  displayOptions() {\n    return Object.keys(this.options).map((el, i) => (\n      <div className=\"Form-group\">\n        <fieldset className=\"Poll-answer-input\">\n          <input\n            className=\"FormControl\"\n            type=\"text\"\n            name={'answer' + (i + 1)}\n            bidi={this.options[i]}\n            placeholder={app.translator.trans('fof-polls.forum.modal.option_placeholder') + ' #' + (i + 1)}\n          />\n          {app.forum.attribute('allowPollOptionImage') ? (\n            <input\n              className=\"FormControl\"\n              type=\"text\"\n              name={'answerImage' + (i + 1)}\n              bidi={this.optionImageUrls[i]}\n              placeholder={app.translator.trans('fof-polls.forum.modal.image_option_placeholder') + ' #' + (i + 1)}\n            />\n          ) : null}\n        </fieldset>\n        {i >= 2\n          ? Button.component({\n              type: 'button',\n              className: 'Button Button--warning PollModal--button',\n              icon: 'fas fa-minus',\n              onclick: i >= 2 ? this.removeOption.bind(this, i) : '',\n            })\n          : ''}\n      </div>\n    ));\n  }\n\n  addOption() {\n    const setting = app.data['fof-polls.options.max'];\n    const max = (setting && parseInt(setting)) || 11;\n\n    if (this.options.length < max) {\n      this.options.push(Stream(''));\n      this.optionImageUrls.push(Stream(''));\n    } else {\n      alert(app.translator.trans('fof-polls.forum.modal.max'));\n    }\n  }\n\n  removeOption(option) {\n    this.options.splice(option, 1);\n    this.optionImageUrls.splice(option, 1);\n  }\n\n  data() {\n    const poll = {\n      question: this.question(),\n      endDate: this.dateToTimestamp(this.endDate()),\n      publicPoll: this.publicPoll(),\n      allowMultipleVotes: this.allowMultipleVotes(),\n      maxVotes: this.maxVotes(),\n      options: [],\n    };\n\n    this.options.forEach((answer, index) => {\n      if (answer()) {\n        poll.options.push({\n          answer: answer(),\n          imageUrl: this.optionImageUrls[index](),\n        });\n      }\n    });\n\n    if (this.question() === '') {\n      alert(app.translator.trans('fof-polls.forum.modal.include_question'));\n\n      return null;\n    }\n\n    if (poll.options.length < 2) {\n      alert(app.translator.trans('fof-polls.forum.modal.min'));\n\n      return null;\n    }\n\n    return poll;\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const data = this.data();\n\n    if (data === null) {\n      return;\n    }\n\n    const promise = this.attrs.onsubmit(data);\n\n    if (promise instanceof Promise) {\n      this.loading = true;\n\n      promise.then(this.hide.bind(this), (err) => {\n        console.error(err);\n        this.loaded();\n      });\n    } else {\n      app.modal.close();\n    }\n  }\n\n  formatDate(date, def = false) {\n    const dayjsDate = dayjs(date);\n\n    if (!dayjsDate.isValid()) return def !== false ? this.formatDate(def) : null;\n\n    return dayjsDate.format('YYYY-MM-DDTHH:mm');\n  }\n\n  dateToTimestamp(date) {\n    const dayjsDate = dayjs(date);\n\n    if (!dayjsDate.isValid()) return false;\n\n    return dayjsDate.format();\n  }\n}\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport classList from 'flarum/common/utils/classList';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport ReplyComposer from 'flarum/forum/components/ReplyComposer';\n\nimport CreatePollModal from './components/CreatePollModal';\n\nexport const addToComposer = (composer) => {\n  composer.prototype.addPoll = function () {\n    app.modal.show(CreatePollModal, {\n      poll: this.composer.fields.poll,\n      onsubmit: (poll) => (this.composer.fields.poll = poll),\n    });\n  };\n\n  // Add button to DiscussionComposer header\n  extend(composer.prototype, 'headerItems', function (items) {\n    const discussion = this.composer.body?.attrs?.discussion;\n    const canStartPoll = discussion?.canStartPoll() ?? app.forum.canStartPolls();\n\n    if (canStartPoll) {\n      items.add(\n        'polls',\n        <a className=\"ComposerBody-poll\" onclick={this.addPoll.bind(this)}>\n          <span className={classList('PollLabel', !this.composer.fields.poll && 'none')}>\n            {app.translator.trans(`fof-polls.forum.composer_discussion.${this.composer.fields.poll ? 'edit' : 'add'}_poll`)}\n          </span>\n        </a>,\n        1\n      );\n    }\n  });\n\n  extend(composer.prototype, 'data', function (data) {\n    if (this.composer.fields.poll) {\n      data.poll = this.composer.fields.poll;\n    }\n  });\n};\n\nexport default () => {\n  addToComposer(DiscussionComposer);\n  addToComposer(ReplyComposer);\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/CommentPost'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/avatar'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import app from 'flarum/forum/app';\n\nimport Modal from 'flarum/common/components/Modal';\nimport avatar from 'flarum/common/helpers/avatar';\nimport username from 'flarum/common/helpers/username';\nimport Link from 'flarum/common/components/Link';\nimport Stream from 'flarum/common/utils/Stream';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nexport default class ListVotersModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.loading = Stream(true);\n\n    app.store\n      .find('fof/polls', this.attrs.poll.id(), {\n        include: 'votes,votes.user,votes.option',\n      })\n      .then(() => this.loading(false))\n      .finally(() => m.redraw());\n  }\n\n  className() {\n    return 'Modal--medium VotesModal';\n  }\n\n  title() {\n    return app.translator.trans('fof-polls.forum.votes_modal.title');\n  }\n\n  content() {\n    return <div className=\"Modal-body\">{this.loading() ? <LoadingIndicator /> : this.attrs.poll.options().map(this.optionContent.bind(this))}</div>;\n  }\n\n  optionContent(opt) {\n    const votes = (this.attrs.poll.votes() || []).filter((v) => opt.id() === v.option().id());\n\n    return (\n      <div className=\"VotesModal-option\">\n        <h2>{opt.answer() + ':'}</h2>\n\n        {votes.length ? (\n          <div className=\"VotesModal-list\">{votes.map(this.voteContent.bind(this))}</div>\n        ) : (\n          <h4>{app.translator.trans('fof-polls.forum.modal.no_voters')}</h4>\n        )}\n      </div>\n    );\n  }\n\n  voteContent(vote) {\n    const user = vote.user();\n    const attrs = user && { href: app.route.user(user) };\n\n    return (\n      <Link {...attrs}>\n        {avatar(user)} {username(user)}\n      </Link>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","import app from 'flarum/forum/app';\n\nimport Button from 'flarum/common/components/Button';\nimport Stream from 'flarum/common/utils/Stream';\nimport CreatePollModal from './CreatePollModal';\n\nexport default class EditPollModal extends CreatePollModal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.poll = this.attrs.poll;\n\n    this.options = this.poll.options();\n    this.optionAnswers = this.options.map((o) => Stream(o.answer()));\n    this.optionImageUrls = this.options.map((o) => Stream(o.imageUrl()));\n    this.question = Stream(this.poll.question());\n    this.endDate = Stream(this.formatDate(this.poll.endDate()));\n    this.publicPoll = Stream(this.poll.publicPoll());\n    this.allowMultipleVotes = Stream(this.poll.allowMultipleVotes());\n    this.maxVotes = Stream(this.poll.maxVotes() || 0);\n\n    if (this.endDate() && dayjs(this.poll.endDate()).isAfter(dayjs())) {\n      this.datepickerMinDate = this.formatDate(this.endDate());\n    }\n  }\n\n  title() {\n    return app.translator.trans('fof-polls.forum.modal.edit_title');\n  }\n\n  displayOptions() {\n    return this.options.map((opt, i) => (\n      <div className=\"Form-group\">\n        <fieldset className=\"Poll-answer-input\">\n          <input\n            className=\"FormControl\"\n            type=\"text\"\n            name={'answer' + (i + 1)}\n            bidi={this.optionAnswers[i]}\n            placeholder={app.translator.trans('fof-polls.forum.modal.option_placeholder') + ' #' + (i + 1)}\n          />\n          {app.forum.attribute('allowPollOptionImage') ? (\n            <input\n              className=\"FormControl\"\n              type=\"text\"\n              name={'answerImage' + (i + 1)}\n              bidi={this.optionImageUrls[i]}\n              placeholder={app.translator.trans('fof-polls.forum.modal.image_option_placeholder') + ' #' + (i + 1)}\n            />\n          ) : null}\n        </fieldset>\n\n        {i >= 2\n          ? Button.component({\n              type: 'button',\n              className: 'Button PollModal--button',\n              icon: 'fas fa-minus',\n              onclick: i >= 2 ? this.removeOption.bind(this, i) : '',\n            })\n          : ''}\n      </div>\n    ));\n  }\n\n  addOption() {\n    const setting = app.data['fof-polls.options.max'];\n    const max = (setting && parseInt(setting)) || 11;\n\n    if (this.options.length < max) {\n      this.options.push(app.store.createRecord('poll_options'));\n      this.optionAnswers.push(Stream(''));\n      this.optionImageUrls.push(Stream(''));\n    } else {\n      alert(app.translator.trans('fof-polls.forum.modal.max'));\n    }\n  }\n\n  removeOption(i) {\n    this.options.splice(i, 1);\n    this.optionAnswers.splice(i, 1);\n    this.optionImageUrls.splice(i, 1);\n  }\n\n  data() {\n    const options = this.options.map((o, i) => {\n      if (!o.data.attributes) o.data.attributes = {};\n\n      o.data.attributes.answer = this.optionAnswers[i]();\n      o.data.attributes.imageUrl = this.optionImageUrls[i]();\n\n      return o.data;\n    });\n\n    return {\n      question: this.question(),\n      endDate: this.dateToTimestamp(this.endDate()),\n      publicPoll: this.publicPoll(),\n      allowMultipleVotes: this.allowMultipleVotes(),\n      maxVotes: this.maxVotes(),\n      options,\n    };\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    if (this.loading) return;\n\n    this.loading = true;\n\n    return this.poll\n      .save(this.data())\n      .then(() => {\n        this.hide();\n        m.redraw();\n      })\n      .catch((e) => {\n        this.loaded();\n        this.onerror(e);\n      });\n  }\n}\n","import app from 'flarum/forum/app';\n\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport ListVotersModal from './ListVotersModal';\nimport classList from 'flarum/common/utils/classList';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport EditPollModal from './EditPollModal';\n\nexport default class PostPoll extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.loadingOptions = false;\n  }\n\n  view() {\n    const poll = this.attrs.poll;\n    const options = poll.options() || [];\n    let maxVotes = poll.allowMultipleVotes() ? poll.maxVotes() : 1;\n\n    if (maxVotes === 0) maxVotes = options.length;\n\n    return (\n      <div className=\"Post-poll\" data-id={poll.id()}>\n        <div className=\"PollHeading\">\n          <h3 className=\"PollHeading-title\">{poll.question()}</h3>\n\n          {poll.canSeeVoters() && (\n            <Tooltip text={app.translator.trans('fof-polls.forum.public_poll')}>\n              <Button className=\"Button PollHeading-voters\" onclick={this.showVoters.bind(this)} icon=\"fas fa-poll\" />\n            </Tooltip>\n          )}\n\n          {poll.canEdit() && (\n            <Tooltip text={app.translator.trans('fof-polls.forum.moderation.edit')}>\n              <Button className=\"Button PollHeading-edit\" onclick={app.modal.show.bind(app.modal, EditPollModal, { poll })} icon=\"fas fa-pen\" />\n            </Tooltip>\n          )}\n          {poll.canDelete() && (\n            <Tooltip text={app.translator.trans('fof-polls.forum.moderation.delete')}>\n              <Button className=\"Button PollHeading-delete\" onclick={this.deletePoll.bind(this)} icon=\"fas fa-trash\" />\n            </Tooltip>\n          )}\n        </div>\n\n        <div className=\"PollOptions\">{options.map(this.viewOption.bind(this))}</div>\n\n        <div className=\"helpText PollInfoText\">\n          {app.session.user && !poll.canVote() && !poll.hasEnded() && (\n            <span>\n              <i className=\"icon fas fa-times-circle\" />\n              {app.translator.trans('fof-polls.forum.no_permission')}\n            </span>\n          )}\n          {poll.endDate() !== null && (\n            <span>\n              <i class=\"icon fas fa-clock\" />\n              {poll.hasEnded()\n                ? app.translator.trans('fof-polls.forum.poll_ended')\n                : app.translator.trans('fof-polls.forum.days_remaining', { time: dayjs(poll.endDate()).fromNow() })}\n            </span>\n          )}\n\n          {poll.canVote() && (\n            <span>\n              <i className=\"icon fas fa-poll\" />\n              {app.translator.trans('fof-polls.forum.max_votes_allowed', { max: maxVotes })}\n            </span>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  viewOption(opt) {\n    const poll = this.attrs.poll;\n    const hasVoted = poll.myVotes()?.length > 0;\n    const totalVotes = poll.voteCount();\n\n    const voted = poll.myVotes()?.some?.((vote) => vote.option() === opt);\n    const votes = opt.voteCount();\n    const percent = totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0;\n\n    // isNaN(null) is false, so we have to check type directly now that API always returns the field\n    const canSeeVoteCount = typeof votes === 'number';\n    const isDisabled = this.loadingOptions || (hasVoted && !poll.canChangeVote());\n\n    const bar = (\n      <div className=\"PollBar\" data-selected={voted}>\n        {((!poll.hasEnded() && poll.canVote()) || !app.session.user) && (\n          <label className=\"checkbox\">\n            <input onchange={this.changeVote.bind(this, opt)} type=\"checkbox\" checked={voted} disabled={isDisabled} />\n            <span className=\"checkmark\" />\n          </label>\n        )}\n\n        <div style={canSeeVoteCount && '--width: ' + percent + '%'} className=\"PollOption-active\" />\n        <label className=\"PollAnswer\">\n          <span>{opt.answer()}</span>\n          {opt.imageUrl() ? <img className=\"PollAnswerImage\" src={opt.imageUrl()} alt={opt.answer()} /> : null}\n        </label>\n        {canSeeVoteCount && (\n          <label>\n            <span className={classList('PollPercent', percent !== 100 && 'PollPercent--option')}>{percent}%</span>\n          </label>\n        )}\n      </div>\n    );\n\n    return (\n      <div\n        className={classList('PollOption', hasVoted && 'PollVoted', poll.hasEnded() && 'PollEnded', opt.imageUrl() && 'PollOption-hasImage')}\n        data-id={opt.id()}\n      >\n        {canSeeVoteCount ? (\n          <Tooltip text={app.translator.trans('fof-polls.forum.tooltip.votes', { count: votes })} onremove={this.hideOptionTooltip}>\n            {bar}\n          </Tooltip>\n        ) : (\n          bar\n        )}\n      </div>\n    );\n  }\n\n  changeVote(option, evt) {\n    if (!app.session.user) {\n      app.modal.show(LogInModal);\n      evt.target.checked = false;\n      return;\n    }\n\n    const optionIds = new Set(this.attrs.poll.myVotes().map?.((v) => v.option().id()));\n    const isUnvoting = optionIds.delete(option.id());\n    const allowsMultiple = this.attrs.poll.allowMultipleVotes();\n\n    if (!allowsMultiple) {\n      optionIds.clear();\n    }\n\n    if (!isUnvoting) {\n      optionIds.add(option.id());\n    }\n\n    this.loadingOptions = true;\n    m.redraw();\n\n    return app\n      .request({\n        method: 'PATCH',\n        url: `${app.forum.attribute('apiUrl')}/fof/polls/${this.attrs.poll.id()}/votes`,\n        body: {\n          data: {\n            optionIds: Array.from(optionIds),\n          },\n        },\n      })\n      .then((res) => {\n        app.store.pushPayload(res);\n\n        // m.redraw();\n      })\n      .catch(() => {\n        evt.target.checked = isUnvoting;\n      })\n      .finally(() => {\n        this.loadingOptions = false;\n\n        m.redraw();\n      });\n  }\n\n  showVoters() {\n    // Load all the votes only when opening the votes list\n    app.modal.show(ListVotersModal, {\n      poll: this.attrs.poll,\n      post: this.attrs.post,\n    });\n  }\n\n  deletePoll() {\n    if (confirm(app.translator.trans('fof-polls.forum.moderation.delete_confirm'))) {\n      this.attrs.poll.delete().then(() => {\n        m.redraw.sync();\n      });\n    }\n  }\n\n  /**\n   * Attempting to use the `tooltipVisible` attr on the Tooltip component set to 'false' when no vote count\n   * caused the tooltip to break on click. This is a workaround to hide the tooltip when no vote count is available,\n   * called on 'onremove' of the Tooltip component. It doesn't always work as intended either, but it does the job.\n   */\n  hideOptionTooltip(vnode) {\n    vnode.attrs.tooltipVisible = false;\n    vnode.state.updateVisibility();\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/PostControls'];","import CreatePollModal from './CreatePollModal';\nimport PostPoll from './PostPoll';\nimport EditPollModal from './EditPollModal';\nimport ListVotersModal from './ListVotersModal';\n\nexport const components = {\n  CreatePollModal,\n  PostPoll,\n  EditPollModal,\n  ListVotersModal,\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class Poll extends Model {\n  question = Model.attribute('question');\n  hasEnded = Model.attribute('hasEnded');\n  endDate = Model.attribute('endDate');\n  publicPoll = Model.attribute('publicPoll');\n  allowMultipleVotes = Model.attribute('allowMultipleVotes');\n  maxVotes = Model.attribute('maxVotes');\n\n  voteCount = Model.attribute('voteCount');\n\n  canVote = Model.attribute('canVote');\n  canEdit = Model.attribute('canEdit');\n  canDelete = Model.attribute('canDelete');\n  canSeeVoters = Model.attribute('canSeeVoters');\n  canChangeVote = Model.attribute('canChangeVote');\n\n  options = Model.hasMany('options');\n  votes = Model.hasMany('votes');\n  myVotes = Model.hasMany('myVotes');\n\n  apiEndpoint() {\n    return `/fof/polls${this.exists ? `/${this.data.id}` : ''}`;\n  }\n}\n","import Model from 'flarum/common/Model';\n\nexport default class PollOption extends Model {\n  answer = Model.attribute('answer');\n  imageUrl = Model.attribute('imageUrl');\n  voteCount = Model.attribute('voteCount');\n\n  poll = Model.hasOne('polls');\n  votes = Model.hasMany('votes');\n\n  apiEndpoint() {\n    return `/fof/polls/answers${this.exists ? `/${this.data.id}` : ''}`;\n  }\n}\n","import Model from 'flarum/common/Model';\n\nexport default class PollVote extends Model {\n  poll = Model.hasOne('poll');\n  option = Model.hasOne('option');\n  user = Model.hasOne('user');\n\n  pollId = Model.attribute('pollId');\n  optionId = Model.attribute('optionId');\n\n  apiEndpoint() {\n    return `/fof/polls/${this.pollId()}/vote`;\n  }\n}\n","import Poll from './Poll';\nimport PollOption from './PollOption';\nimport PollVote from './PollVote';\n\nexport const models = {\n  Poll,\n  PollOption,\n  PollVote,\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Post'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Forum'];","import Extend from 'flarum/common/extenders';\nimport Post from 'flarum/common/models/Post';\nimport Forum from 'flarum/common/models/Forum';\nimport Discussion from 'flarum/common/models/Discussion';\nimport Poll from './models/Poll';\nimport PollOption from './models/PollOption';\nimport PollVote from './models/PollVote';\n\nexport default [\n  new Extend.Store().add('polls', Poll).add('poll_options', PollOption).add('poll_votes', PollVote),\n\n  new Extend.Model(Post).hasMany('polls').attribute('canStartPoll'),\n\n  new Extend.Model(Forum).attribute('canStartPolls'),\n\n  new Extend.Model(Discussion).attribute('hasPoll').attribute('canStartPoll'),\n];\n","import app from 'flarum/forum/app';\n\nimport addDiscussionBadge from './addDiscussionBadge';\nimport addComposerItems from './addComposerItems';\nimport addPollsToPost from './addPollsToPost';\nimport addPostControls from './addPostControls';\n\nexport * from './components';\nexport * from './models';\n\napp.initializers.add('fof/polls', () => {\n  addDiscussionBadge();\n  addComposerItems();\n  addPollsToPost();\n  addPostControls();\n});\n\nexport { default as extend } from './extend';\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport PostControls from 'flarum/forum/utils/PostControls';\nimport CreatePollModal from './components/CreatePollModal';\nimport Button from 'flarum/common/components/Button';\n\nexport default () => {\n  const createPoll = (post) =>\n    app.modal.show(CreatePollModal, {\n      onsubmit: (data) =>\n        app.store\n          .createRecord('polls')\n          .save(\n            {\n              ...data,\n              relationships: {\n                post,\n              },\n            },\n            {\n              data: {\n                include: 'options,myVotes,myVotes.option',\n              },\n            }\n          )\n          .then((poll) => {\n            post.rawRelationship('polls')?.push?.({ type: 'polls', id: poll.id() });\n\n            return poll;\n          }),\n    });\n\n  extend(PostControls, 'moderationControls', function (items, post) {\n    if (!post.isHidden() && post.canStartPoll()) {\n      items.add(\n        'addPoll',\n        <Button icon=\"fas fa-poll\" onclick={createPoll.bind(this, post)}>\n          {app.translator.trans('fof-polls.forum.moderation.add')}\n        </Button>\n      );\n    }\n  });\n};\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport CommentPost from 'flarum/forum/components/CommentPost';\nimport PostPoll from './components/PostPoll';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\n\nexport default () => {\n  extend(CommentPost.prototype, 'content', function (content) {\n    const post = this.attrs.post;\n\n    if ((!post.isHidden() || this.revealContent) && post.polls()) {\n      for (const poll of post.polls()) {\n        if (poll) {\n          content.push(<PostPoll post={post} poll={poll} />);\n        }\n      }\n    }\n  });\n\n  extend(CommentPost.prototype, 'oninit', function () {\n    this.subtree.check(() => {\n      const polls = this.attrs.post.polls();\n\n      const checks = polls?.map?.(\n        (poll) =>\n          poll && [\n            poll.data?.attributes,\n            poll.options().map?.((option) => option?.data?.attributes),\n            poll.myVotes().map?.((vote) => vote.option()?.id()),\n          ]\n      );\n\n      return JSON.stringify(checks);\n    });\n  });\n\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    if (app.pusher) {\n      app.pusher.then((binding) => {\n        // We will listen for updates to all polls and options\n        // Even if that model is not in the current discussion, it doesn't really matter\n        binding.channels.main.bind('updatedPollOptions', (data) => {\n          const poll = app.store.getById('polls', data['pollId']);\n\n          if (poll) {\n            poll.pushAttributes({\n              voteCount: data['pollVoteCount'],\n            });\n\n            // Not redrawing here, as the option below should trigger the redraw already\n          }\n\n          const changedOptions = data['options'];\n\n          for (const optionId in changedOptions) {\n            const option = app.store.getById('poll_options', optionId);\n\n            if (option && option.voteCount() !== undefined) {\n              option.pushAttributes({\n                voteCount: changedOptions[optionId],\n              });\n            }\n          }\n\n          m.redraw();\n        });\n      });\n    }\n  });\n\n  extend(DiscussionPage.prototype, 'onremove', function () {\n    if (app.pusher) {\n      app.pusher.then((binding) => {\n        binding.channels.main.unbind('updatedPollOptions');\n      });\n    }\n  });\n};\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","CreatePollModal","oninit","vnode","this","options","Stream","optionImageUrls","question","endDate","publicPoll","allowMultipleVotes","maxVotes","datepickerMinDate","formatDate","undefined","poll","attrs","Array","isArray","forEach","option","push","answer","imageUrl","dayjs","isAfter","title","app","className","content","fields","toArray","items","ItemList","add","type","name","bidi","Button","icon","onclick","addOption","displayOptions","min","class","isBefore","time","fromNow","Switch","state","onchange","max","length","loading","keys","map","el","i","placeholder","removeOption","setting","parseInt","alert","splice","data","dateToTimestamp","index","onsubmit","e","preventDefault","promise","Promise","then","hide","err","console","error","loaded","date","def","dayjsDate","isValid","format","Modal","addToComposer","composer","addPoll","extend","discussion","body","canStartPoll","classList","ListVotersModal","id","include","m","redraw","optionContent","opt","votes","filter","v","voteContent","vote","user","href","avatar","username","EditPollModal","optionAnswers","attributes","save","onerror","PostPoll","loadingOptions","view","canSeeVoters","text","showVoters","canEdit","canDelete","deletePoll","viewOption","canVote","hasEnded","hasVoted","myVotes","totalVotes","voteCount","voted","some","percent","Math","round","canSeeVoteCount","isDisabled","canChangeVote","bar","changeVote","checked","disabled","style","src","alt","count","onremove","hideOptionTooltip","evt","LogInModal","target","optionIds","Set","isUnvoting","clear","method","url","from","res","post","confirm","sync","tooltipVisible","updateVisibility","Component","_extends","assign","arguments","source","apply","components","Poll","Model","apiEndpoint","exists","PollOption","PollVote","pollId","optionId","models","Extend","Post","hasMany","attribute","Forum","Discussion","createPoll","DiscussionList","params","badges","hasPoll","Badge","label","DiscussionComposer","ReplyComposer","CommentPost","isHidden","revealContent","polls","subtree","check","checks","JSON","stringify","DiscussionPage","binding","channels","main","pushAttributes","changedOptions","unbind","relationships","rawRelationship","PostControls"],"sourceRoot":""}