/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,o,e)=>{var n=e(735).default;function r(){"use strict";t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var o,e={},a=Object.prototype,l=a.hasOwnProperty,s=Object.defineProperty||function(t,o,e){t[o]=e.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",p=i.toStringTag||"@@toStringTag";function m(t,o,e){return Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[o]}try{m({},"")}catch(o){m=function(t,o,e){return t[o]=e}}function f(t,o,e,n){var r=o&&o.prototype instanceof w?o:w,a=Object.create(r.prototype),l=new E(n||[]);return s(a,"_invoke",{value:O(t,e,l)}),a}function d(t,o,e){try{return{type:"normal",arg:t.call(o,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",v="suspendedYield",g="executing",b="completed",y={};function w(){}function P(){}function N(){}var x={};m(x,u,(function(){return this}));var _=Object.getPrototypeOf,V=_&&_(_(L([])));V&&V!==a&&l.call(V,u)&&(x=V);var I=N.prototype=w.prototype=Object.create(x);function A(t){["next","throw","return"].forEach((function(o){m(t,o,(function(t){return this._invoke(o,t)}))}))}function C(t,o){function e(r,a,s,i){var u=d(t[r],t,a);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==n(p)&&l.call(p,"__await")?o.resolve(p.__await).then((function(t){e("next",t,s,i)}),(function(t){e("throw",t,s,i)})):o.resolve(p).then((function(t){c.value=t,s(c)}),(function(t){return e("throw",t,s,i)}))}i(u.arg)}var r;s(this,"_invoke",{value:function(t,n){function a(){return new o((function(o,r){e(t,n,o,r)}))}return r=r?r.then(a,a):a()}})}function O(t,e,n){var r=h;return function(a,l){if(r===g)throw new Error("Generator is already running");if(r===b){if("throw"===a)throw l;return{value:o,done:!0}}for(n.method=a,n.arg=l;;){var s=n.delegate;if(s){var i=S(s,n);if(i){if(i===y)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=b,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var u=d(t,e,n);if("normal"===u.type){if(r=n.done?b:v,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=b,n.method="throw",n.arg=u.arg)}}}function S(t,e){var n=e.method,r=t.iterator[n];if(r===o)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=o,S(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=d(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,y;var l=a.arg;return l?l.done?(e[t.resultName]=l.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=o),e.delegate=null,y):l:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function k(t){var o={tryLoc:t[0]};1 in t&&(o.catchLoc=t[1]),2 in t&&(o.finallyLoc=t[2],o.afterLoc=t[3]),this.tryEntries.push(o)}function M(t){var o=t.completion||{};o.type="normal",delete o.arg,t.completion=o}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function L(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(l.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=o,e.done=!0,e};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return P.prototype=N,s(I,"constructor",{value:N,configurable:!0}),s(N,"constructor",{value:P,configurable:!0}),P.displayName=m(N,p,"GeneratorFunction"),e.isGeneratorFunction=function(t){var o="function"==typeof t&&t.constructor;return!!o&&(o===P||"GeneratorFunction"===(o.displayName||o.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,N):(t.__proto__=N,m(t,p,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},A(C.prototype),m(C.prototype,c,(function(){return this})),e.AsyncIterator=C,e.async=function(t,o,n,r,a){void 0===a&&(a=Promise);var l=new C(f(t,o,n,r),a);return e.isGeneratorFunction(o)?l:l.next().then((function(t){return t.done?t.value:l.next()}))},A(I),m(I,p,"Generator"),m(I,u,(function(){return this})),m(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var o=Object(t),e=[];for(var n in o)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in o)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=L,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(M),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=o),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var i=l.call(a,"catchLoc"),u=l.call(a,"finallyLoc");if(i&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,o){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=o&&o<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=o,r?(this.method="next",this.next=r.finallyLoc,y):this.complete(a)},complete:function(t,o){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&o&&(this.next=o),y},finish:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),M(e),y}},catch:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var r=n.arg;M(e)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:L(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=o),y}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,o,e)=>{var n=e(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},o={};function e(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return t[n](a,a.exports,e),a.exports}e.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},e.d=(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},e.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";e.r(n),e.d(n,{components:()=>bo,extend:()=>Lo,models:()=>Io,states:()=>Ao});const t=flarum.core.compat["forum/app"];var o=e.n(t);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/Badge"];var l=e.n(a);const s=flarum.core.compat["forum/components/DiscussionList"];var i=e.n(s);const u=flarum.core.compat["common/models/Discussion"];var c=e.n(u);const p=flarum.core.compat["common/utils/classList"];var f=e.n(p);const d=flarum.core.compat["forum/components/DiscussionComposer"];var h=e.n(d);const v=flarum.core.compat["forum/components/ReplyComposer"];var g=e.n(v);function b(t,o,e,n,r,a,l){try{var s=t[a](l),i=s.value}catch(t){return void e(t)}s.done?o(i):Promise.resolve(i).then(n,r)}function y(t){return function(){var o=this,e=arguments;return new Promise((function(n,r){var a=t.apply(o,e);function l(t){b(a,n,r,l,s,"next",t)}function s(t){b(a,n,r,l,s,"throw",t)}l(void 0)}))}}function w(t,o){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},w(t,o)}function P(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,w(t,o)}var N=e(183),x=e.n(N);const _=flarum.core.compat["common/components/Modal"];var V=e.n(_);const I=flarum.core.compat["common/Component"];var A=e.n(I);const C=flarum.core.compat["common/components/Button"];var O=e.n(C);const S=flarum.core.compat["common/components/Switch"];var k=e.n(S);const M=flarum.core.compat["common/utils/ItemList"];var E=e.n(M);const L=flarum.core.compat["common/utils/Stream"];var D=e.n(L);const B=flarum.core.compat["common/utils/extractText"];var U=e.n(B);function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function j(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(j=function(){return!!t})()}function F(t){var o="function"==typeof Map?new Map:void 0;return F=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(o){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return function(t,o,e){if(j())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,o);var r=new(t.bind.apply(t,n));return e&&w(r,e.prototype),r}(t,arguments,T(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),w(e,t)},F(t)}var q=function(t){function o(o){return t.call(this,o+"")||this}return P(o,t),o}(F(Error)),R=function(){function t(o){this.poll=void 0,this.loading=void 0,this.deleting=void 0,this.expandedGroup=void 0,o||(o=t.createNewPoll()),this.loading=!1,this.deleting=!1,this.poll=o,this.expandedGroup="setup"}t.createNewPoll=function(){var t=o().store.createRecord("polls");return t.pushAttributes({question:"",endDate:"",publicPoll:!1,allowMultipleVotes:!1,hideVotes:!1,allowChangeVote:!1,maxVotes:0}),t.tempOptions=[o().store.createRecord("poll_options"),o().store.createRecord("poll_options")],t};var e=t.prototype;return e.isExpanded=function(t){return this.expandedGroup===t},e.expand=function(t){this.expandedGroup=t,m.redraw()},e.save=function(){var t=y(x().mark((function t(o){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.save(o);case 5:this.poll=t.sent,delete this.poll.data.attributes.options;case 7:return t.prev=7,this.loading=!1,m.redraw(),t.finish(7);case 11:case"end":return t.stop()}}),t,this,[[2,,7,11]])})));return function(o){return t.apply(this,arguments)}}(),e.delete=function(){var t=y(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.delete();case 5:this.deleting=!0;case 6:return t.prev=6,this.loading=!1,m.redraw(),t.finish(6);case 10:case"end":return t.stop()}}),t,this,[[2,,6,10]])})));return function(){return t.apply(this,arguments)}}(),t}();const H=flarum.core.compat["common/components/Page"];var G=e.n(H);const z=flarum.core.compat["common/components/LoadingIndicator"];var Y=e.n(z);const J=flarum.core.compat["common/components/LinkButton"];var W=e.n(J),K=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.poll=this.attrs.poll},n.view=function(){return m("div",{className:"ComposePollHero Hero"},m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h2",{className:"Hero-title"},o().translator.trans("fof-polls.forum.compose."+(this.poll.id()?"edit":"add")+"_title")),m("div",{className:"ComposePollHero-controls"},this.controlItems().toArray()))))},n.controlItems=function(){var t=new(E());return t.add("edit",m(W(),{icon:"far fa-edit",className:"Button Button--secondary GlobalPollListLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.list")},o().translator.trans("fof-polls.forum.compose.polls_manager"))),this.poll.exists&&t.add("view",m(W(),{icon:"far fa-arrow-up-right-from-square",className:"Button Button--secondary PollPreviewLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.view",{id:this.poll.id()})},o().translator.trans("fof-polls.forum.compose.polls_preview"))),t},e}(A());const Q=flarum.core.compat["common/helpers/listItems"];var X=e.n(Q);const Z=flarum.core.compat["common/components/SelectDropdown"];var tt=e.n(Z);const ot=flarum.core.compat["forum/components/IndexPage"];var et=e.n(ot),nt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=null,o.loading=!1,o}P(e,t);var n=e.prototype;return n.oninit=function(e){var n,r,a=this;if(t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")){var l=m.route.param("id");l?(this.poll=o().store.getById("poll",l),this.poll||(this.loading=!0,o().store.find("fof/polls",l).then((function(t){var e;a.poll=t,a.loading=!1,o().setTitle(o().translator.trans("fof-polls.forum.compose."+(null!=(e=a.poll)&&e.id()?"edit":"add")+"_title")),m.redraw()})))):this.poll=R.createNewPoll(),o().history.push("compose-poll",o().translator.trans("fof-polls.forum.compose."+(null!=(n=this.poll)&&n.id()?"edit":"add")+"_title")),this.bodyClass="App--compose-poll",o().setTitle(o().translator.trans("fof-polls.forum.compose."+(null!=(r=this.poll)&&r.id()?"edit":"add")+"_title"))}else m.route.set("/")},n.view=function(){if(o().forum.attribute("canStartGlobalPolls"))return this.loading?m(Y(),null):m("div",{className:"ComposePollPage"},m(K,{poll:this.poll}),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset"},m(oo,{poll:this.poll,onsubmit:this.onsubmit.bind(this)})))));m.route.set("/")},n.onsubmit=function(){var t=y(x().mark((function t(e,n){var r,a,l;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===n.poll.id(),t.next=3,n.save(e);case 3:a=r?{type:"success",controls:[m(O(),{className:"Button Button--link",onclick:function(){return m.route.set(o().route("fof.polls.compose",{id:n.poll.id()}))}},o().translator.trans("fof-polls.forum.compose.continue_editing"))]}:{type:"success"},l=o().alerts.show(a,o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(l)}),1e4),r&&m.route.set(o().route("fof.polls.list"));case 7:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),n.sidebarItems=function(){var t=new(E());return t.add("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){return et().prototype.navItems()},e}(G());const rt=flarum.core.compat["common/utils/SubtreeRetainer"];var at=e.n(rt);const lt=flarum.core.compat["common/components/Dropdown"];var st=e.n(lt);const it=flarum.core.compat["common/components/Link"];var ut=e.n(it);const ct=flarum.core.compat["common/helpers/highlight"];var pt=e.n(ct);const mt=flarum.core.compat["forum/utils/slidable"];var ft=e.n(mt);const dt=flarum.core.compat["common/helpers/icon"];var ht=e.n(dt);const vt=flarum.core.compat["common/utils/abbreviateNumber"];var gt=e.n(vt);const bt=flarum.core.compat["common/components/Tooltip"];var yt=e.n(bt),wt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.view=function(){var t,e=this.attrs.option,n=this.attrs.state,r=n.hasVoted(),a=n.overallVoteCount(),l=e.voteCount(),s=n.hasVotedFor(e),i=a>0?Math.round(l/a*100):0,u=n.poll,c="number"==typeof l,p=n.loadingOptions||r&&!u.canChangeVote(),d=c?i:Number(s)/((null==(t=u.myVotes())?void 0:t.length)||1)*100,h=m("div",{className:"PollBar","data-selected":!!s,style:"--poll-option-width: "+d+"%"},n.showCheckMarks&&m("label",{className:"PollAnswer-checkbox checkbox"},m("input",{onchange:n.changeVote.bind(n,e),type:"checkbox",checked:s,disabled:p}),m("span",{className:"checkmark"})),m("div",{className:"PollAnswer-text"},m("span",{className:"PollAnswer-text-answer"},e.answer()),s&&!n.showCheckMarks&&ht()("fas fa-check-circle",{className:"PollAnswer-check"}),c&&m("span",{className:f()("PollPercent",100!==i&&"PollPercent--option")},i,"%")),e.imageUrl()?m("img",{className:"PollAnswer-image",src:e.imageUrl(),alt:e.answer()}):null);return m("div",{className:f()("PollOption",r&&"PollVoted",e.imageUrl()&&"PollOption-hasImage"),"data-id":e.id()},c?m(yt(),{text:o().translator.trans("fof-polls.forum.tooltip.votes",{count:l}),onremove:this.hideOptionTooltip},h):h)},n.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},e}(A()),Pt=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.view=function(){return m("div",{className:"Poll-options list-layout"},this.pollOptions().toArray())},e.pollOptions=function(){var t=this,o=new(E());return this.attrs.options.forEach((function(e){o.add("option"+e.id(),t.createOptionView(e))})),o},e.createOptionView=function(t){return m(wt,{name:this.attrs.name,option:t,state:this.attrs.state})},o}(A()),Nt=function(t){function o(){return t.apply(this,arguments)||this}return P(o,t),o.prototype.view=function(){return m("div",{className:"PollImage"},m("img",{src:this.attrs.imageUrl,alt:this.attrs.alt,className:"PollImage-image"}))},o}(A());const xt=flarum.core.compat["forum/components/LogInModal"];var _t=e.n(xt);const Vt=flarum.core.compat["common/helpers/avatar"];var It=e.n(Vt);const At=flarum.core.compat["common/helpers/username"];var Ct=e.n(At),Ot=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.loading=!0,o().store.find("fof/polls",this.attrs.poll.id(),{include:"votes,votes.user,votes.option"}).then((function(){return n.loading=!1})).finally((function(){return m.redraw()}))},n.className=function(){return"Modal--medium VotesModal"},n.title=function(){return o().translator.trans("fof-polls.forum.votes_modal.title")},n.content=function(){var t=this.attrs.poll.options();return m("div",{className:"Modal-body"},this.loading?m(Y(),null):t.map(this.optionContent.bind(this)))},n.optionContent=function(t){var e=(this.attrs.poll.votes()||[]).filter((function(o){return t.id()===o.option().id()}));return m("div",{className:"VotesModal-option"},m("h2",null,t.answer()+":"),e.length?m("div",{className:"VotesModal-list"},e.map(this.voteContent.bind(this))):m("h4",null,o().translator.trans("fof-polls.forum.modal.no_voters")))},n.voteContent=function(t){var e=t.user(),n=e&&{href:o().route.user(e)};return m(ut(),n,It()(e)," ",Ct()(e))},e}(V()),St=function(){function t(t){var e=this;this.poll=void 0,this.pendingSubmit=!1,this.pendingOptions=null,this.loadingOptions=!1,this.useSubmitUI=void 0,this.showCheckMarks=void 0,this.canSeeVoteCount=void 0,this.showVoters=function(){o().modal.show(Ot,{poll:e.poll})},this.poll=t,this.useSubmitUI=!(null!=t&&t.canChangeVote())&&(null==t?void 0:t.allowMultipleVotes()),this.showCheckMarks=!o().session.user||!t.hasEnded()&&t.canVote()&&(!this.hasVoted()||t.canChangeVote()),this.canSeeVoteCount="number"==typeof t.voteCount(),this.init()}var e=t.prototype;return e.init=function(){},e.isShowResult=function(){return this.poll.hasEnded()||this.canSeeVoteCount&&this.hasVoted()},e.hasVoted=function(){return this.poll.myVotes().length>0},e.overallVoteCount=function(){return this.poll.voteCount()},e.hasVotedFor=function(t){return this.pendingOptions?this.pendingOptions.has(t.id()):this.poll.myVotes().some((function(o){return o.option()===t}))},e.getMaxVotes=function(){var t=this.poll,o=t.allowMultipleVotes()?t.maxVotes():1;return 0===o&&(o=t.options().length),o},e.showButton=function(){return this.useSubmitUI&&this.pendingSubmit},e.changeVote=function(t,e){var n=e.target;if(!o().session.user)return o().modal.show(_t()),void(n.checked=!1);var r=this.pendingOptions||new Set(this.poll.myVotes().map((function(t){return t.option().id()}))),a=r.delete(t.id());if(this.poll.allowMultipleVotes()||r.clear(),a||r.add(t.id()),this.pendingOptions=r.size?r:null,this.pendingSubmit=!!this.pendingOptions,this.useSubmitUI)return this.pendingOptions=r.size?r:null,this.pendingSubmit=!!this.pendingOptions,void m.redraw();this.submit(r,null,(function(){return n.checked=a}))},e.hasSelectedOptions=function(){return this.pendingSubmit},e.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}))},e.submit=function(t,e,n){var r=this;return void 0===n&&(n=null),this.loadingOptions=!0,m.redraw(),o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.poll.id()+"/votes",body:{data:{optionIds:Array.from(t)}}}).then((function(t){o().store.pushPayload(t),null==e||e()})).catch((function(t){null==n||n(t)})).finally((function(){r.loadingOptions=!1,r.canSeeVoteCount="number"==typeof r.poll.voteCount(),m.redraw()}))},t}(),kt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.view=function(){var t=this,e=this.attrs.state;return m(O(),{className:"Button Button--primary Poll-submit",loading:e.loadingOptions,onclick:function(o){return t.pollButtonSubmit(e,o)},disabled:!e.hasSelectedOptions()},o().translator.trans("fof-polls.forum.poll.submit_button"))},n.pollButtonSubmit=function(t,o){t.onsubmit()},e}(A());const Mt=flarum.core.compat["common/utils/string"];var Et=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).state=void 0,o.preventClose=function(t){if(o.state.hasSelectedOptions())return t.preventDefault(),!0},o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new St(this.attrs.poll)},n.oncreate=function(o){t.prototype.oncreate.call(this,o),this.preventClose=this.preventClose.bind(this),window.addEventListener("beforeunload",this.preventClose)},n.onremove=function(o){t.prototype.onremove.call(this,o),window.removeEventListener("beforeunload",this.preventClose)},n.view=function(){var t=this.attrs.poll,e=this.state,n=Xt.controls(t,this);return n.add("view",m(O(),{onclick:e.showVoters,icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.public_poll"))),m("div",{className:f()("Poll",t.imageUrl()&&"Poll--image"),"data-id":t.id()},this.controlsView(n.toArray()),m("div",{className:"Poll-wrapper"},this.createMainView().toArray()))},n.createMainView=function(){var t=new(E());return this.attrs.poll,t.add("header",m("div",{className:"Poll-header"},this.createPollHeader().toArray())),t.add("content",m("div",{className:"Poll-content"},this.createPollContent().toArray())),t.add("footer",m("div",{className:"Poll-footer"},this.createPollFooter().toArray())),t},n.createPollHeader=function(){var t=new(E()),o=this.attrs.poll;return t.add("title",m("h2",{className:"Poll-title"},o.question())),o.subtitle()&&t.add("subtitle",m("p",{className:"Poll-subtitle"},o.subtitle())),t},n.createPollContent=function(){var t=new(E()),o=this.attrs.poll;return o.imageUrl()&&t.add("image",m(Nt,{imageUrl:o.imageUrl(),alt:o.imageAlt()})),t.add("form",m("form",{className:"Poll-form"},this.createFormItems().toArray())),t},n.createPollFooter=function(){var t=new(E()),o=this.state,e=this.infoItems(o.getMaxVotes());return t.add("sticky",m("div",{className:"Poll-sticky"},!e.isEmpty()&&m("div",{className:"helpText PollInfoText"},e.toArray()),o.showButton()&&m(kt,{state:o}))),t},n.createFormItems=function(){var t=new(E()),o=this.attrs.poll,e=this.state,n=(0,Mt.slug)(o.question());return t.add("elements",m("fieldset",null,m("legend",{className:"sr-only"},o.question()),m(Pt,{name:n,options:o.options(),state:e}))),t},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.infoItems=function(t){var e=new(E()),n=this.attrs.poll;return!o().session.user||n.canVote()||n.hasEnded()||e.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),n.endDate()&&e.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),n.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(n.endDate()).fromNow()}))),n.canVote()&&(e.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),n.canChangeVote()||e.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(this.state.hasVoted()?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),e},e}(A()),Lt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.poll=null,o.polls=[],o}P(e,t);var n=e.prototype;return n.view=function(){return m("div",{className:"PollsPage"},this.pageContent().toArray())},n.pageContent=function(){var t=new(E());return t.add("hero",this.hero(),100),t.add("main",m("div",{className:"container"},this.mainContent().toArray()),10),t},n.mainContent=function(){var t=new(E());return t.add("sidebar",this.sidebar(),100),t.add("content",this.content(),10),t},n.content=function(){return m("div",{className:"PollsPage-content sideNavOffset"},this.contentItems().toArray())},n.contentItems=function(){var t=new(E());return this.loading&&t.add("loading",m(Y(),null)),t},n.hero=function(){return et().prototype.hero()},n.sidebar=function(){return m("nav",{className:"PollsPage-nav IndexPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray())))},n.sidebarItems=function(){var t=et().prototype.sidebarItems();return t.setContent("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){var t=et().prototype.navItems();if(o().initializers.has("flarum-tags"))for(var e in t.remove("separator"),t.remove("moreTags"),t.toObject())e.startsWith("tag")&&"tags"!==e&&t.remove(e);return t},e}(G()),Dt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;if(t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")){var r=m.route.param("id");this.poll=o().store.getById("poll",r),this.poll||(this.loading=!0,o().store.find("fof/polls",r).then((function(t){n.poll=t,n.loading=!1,o().setTitle(n.poll.question()),m.redraw()})))}else m.route.set("/")},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return this.loading||o.add("poll",m(Et,{poll:this.poll})),o},e}(Lt),Bt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).subtree=void 0,o.poll=void 0,o.highlightRegExp=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.poll=this.attrs.poll,this.subtree=new(at())((function(){return n.poll.freshness}),(function(){var t=o().session.user&&o().session.user.markedAllAsReadAt();return t&&t.getTime()}),(function(){return n.active()}))},n.elementAttrs=function(){return{className:f()("PollListItem",{active:this.active(),"PollListItem--hidden":this.poll.isHidden(),Slidable:"ontouchstart"in window})}},n.view=function(){var t=Xt.controls(this.poll,this).toArray(),o=this.elementAttrs();return m("div",o,this.controlsView(t),this.contentView(),this.slidableUnderneathView())},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.slidableUnderneathView=function(){var t=this.poll.isUnread();return m("span",{className:f()("Slidable-underneath Slidable-underneath--left Slidable-underneath--elastic",{disabled:!t}),onclick:this.markAsRead.bind(this)},ht()("fas fa-check"))},n.contentView=function(){return m("div",{className:f()("PollListItem-content")},this.mainView())},n.mainView=function(){return m(ut(),{href:o().route("fof.polls.view",{id:this.poll.id()}),className:"PollListItem-main"},m("h2",{className:"PollListItem-title"},pt()(this.poll.question(),this.highlightRegExp)),this.poll.subtitle()&&m("p",{className:"PollListItem-subtitle helpText"},this.poll.subtitle()),m("ul",{className:"PollListItem-info"},X()(this.infoItems().toArray())))},n.oncreate=function(o){if(t.prototype.oncreate.call(this,o),"ontouchstart"in window){var e=ft()(this.element);this.$(".PollListItem-controls").on("hidden.bs.dropdown",(function(){return e.reset()}))}},n.onbeforeupdate=function(o){return t.prototype.onbeforeupdate.call(this,o),this.subtree.needsRebuild()},n.active=function(){return o().current.matches(Dt,{poll:this.poll})},n.markAsRead=function(){this.poll.isUnread()&&(this.poll.save({lastVotedNumber:this.poll.voteCount()}),m.redraw())},n.infoItems=function(){var t=new(E()),e=!this.poll.hasEnded(),n=this.poll.endDate()?[ht()("fas fa-clock")," ",e?o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.poll.endDate()).fromNow()}):o().translator.trans("fof-polls.forum.poll_ended")]:[ht()("fas fa-infinity")," ",o().translator.trans("fof-polls.forum.poll_never_ends")];t.add("active",m("span",{className:f()("PollListItem-endStatus",{active:e})},n));var r=this.poll.voteCount();return void 0!==r&&t.add("voteCount",m("span",null,ht()("fas fa-poll fa-fw"),[" ",o().translator.trans("fof-polls.forum.polls_count",{count:gt()(r)})]),70),t},e}(A());const Ut=flarum.core.compat["common/components/Placeholder"];var Tt=e.n(Ut),jt=function(t){function e(){return t.apply(this,arguments)||this}return P(e,t),e.prototype.view=function(){var t,e=this.attrs.state,n=e.getParams(),r=e.isInitialLoading()||e.isLoadingNext();if(r?t=m(Y(),null):e.hasNext()&&(t=m(O(),{className:"Button",onclick:e.loadNext.bind(e)},o().translator.trans("fof-polls.forum.polls_list.load_more_button"))),e.isEmpty()){var a=o().translator.trans("fof-polls.forum.polls_list.empty_text");return m("div",{className:"PollList"},m(Tt(),{text:a}))}return m("div",{className:f()("PollList",{"PollList--searchResults":e.isSearchResults()})},m("ul",{"aria-busy":r,className:"PollList-polls"},e.getPages().map((function(t){return t.items.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},m(Bt,{poll:t,params:n}))}))}))),m("div",{className:"PollList-loadMore"},t))},e}(A());function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function qt(t){var o=function(t,o){if("object"!=Ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ft(o)?o:String(o)}function Rt(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qt(n.key),n)}}const Ht=flarum.core.compat["common/states/PaginatedListState"];var Gt=e.n(Ht);const zt=flarum.core.compat["common/utils/EventEmitter"];function Yt(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}var $t=new(e.n(zt)()),Jt=function(t){function e(o,e){var n;return void 0===e&&(e=1),(n=t.call(this,o,e,20)||this).extraPolls=[],n.eventEmitter=void 0,n.eventEmitter=$t.on("poll.deleted",n.deletePoll.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n))),n}P(e,t);var n,r,a=e.prototype;return a.requestParams=function(){var t,o={include:this.params.include||["options","votes"],filter:this.params.filter||{},sort:this.sortMap()[null!=(t=this.params.sort)?t:""]};return this.params.q&&(o.filter.q=this.params.q),o},a.loadPage=function(e){void 0===e&&(e=1);var n=o().preloadedApiDocument();return n?(this.initialLoading=!1,Promise.resolve(n)):t.prototype.loadPage.call(this,e)},a.clear=function(){t.prototype.clear.call(this),this.extraPolls=[]},a.sortMap=function(){var t={};return this.params.q&&(t.relevance=""),t.newest="-createdAt",t.oldest="createdAt",t},a.isSearchResults=function(){return!!this.params.q},a.removePoll=function(t){this.eventEmitter.emit("poll.deleted",t)},a.deletePoll=function(t){for(var o,e=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return Yt(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Yt(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.pages);!(o=e()).done;){var n=o.value,r=n.items.indexOf(t);if(-1!==r){n.items.splice(r,1);break}}var a=this.extraPolls.indexOf(t);-1!==a&&this.extraPolls.splice(a),m.redraw()},a.addPoll=function(t){this.removePoll(t),this.extraPolls.unshift(t),m.redraw()},a.getAllItems=function(){return this.extraPolls.concat(t.prototype.getAllItems.call(this))},a.getPages=function(){var o=t.prototype.getPages.call(this);return this.extraPolls.length?[{number:-1,items:this.extraPolls}].concat(o):o},n=e,(r=[{key:"type",get:function(){return"fof/polls"}}])&&Rt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}(Gt()),Wt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")?(this.state=new Jt({sort:m.route.param("sort"),filter:m.route.param("filter")}),this.state.refresh(),o().setTitle(U()(o().translator.trans("fof-polls.forum.page.nav")))):m.route.set("/")},n.view=function(){return this.loading?m(Y(),null):this.poll?m("div",{className:"PollsListPage"},m("div",{className:"container"},m(Et,{poll:this.poll}))):m("div",{className:"PollsListPage"},t.prototype.hero.call(this),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsListPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray()))),m("div",{className:"PollsPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},X()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},X()(this.actionItems().toArray()))),m(jt,{state:this.state})))))},n.sidebarItems=function(){var t=this,e=new(E()),n=o().forum.attribute("canStartGlobalPolls");return e.add("newGlobalPoll",m(O(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){t.newPollAction()},disabled:!n},o().translator.trans("fof-polls.forum.poll."+(n?"start_poll_button":"cannot_start_poll_button")))),e.add("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),e},n.actionItems=function(){var t=this,e=new(E());return e.add("refresh",O().component({title:o().translator.trans("fof-polls.forum.page.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){t.state.refresh()}})),e},n.viewItems=function(){return et().prototype.viewItems()},n.navItems=function(){return et().prototype.navItems()},n.newPollAction=function(){o().session.user?m.route.set(o().route("fof.polls.compose")):o().modal.show(_t())},e}(Lt);const Kt=flarum.core.compat["common/components/Separator"];var Qt=e.n(Kt);const Xt={controls:function(t,o){var e=this,n=new(E());return["poll","moderation","destructive"].forEach((function(r){var a=e[r+"Controls"](t,o).toArray();a.length&&(a.forEach((function(t){return n.add(t.itemName,t)})),n.add(r+"Separator",m(Qt(),null)))})),n},pollControls:function(t,o){return new(E())},moderationControls:function(t,e){var n=new(E());return t.canEdit()&&n.add("edit",m(O(),{icon:"fas fa-pencil-alt",onclick:this.editAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.edit_label"))),n},destructiveControls:function(t,e){var n=new(E());return t.canDelete()&&n.add("delete",m(O(),{icon:"far fa-trash-alt",onclick:this.deleteAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.delete_label"))),n},deleteAction:function(t){var e=this;return y(x().mark((function n(){return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm(o().translator.trans("fof-polls.forum.poll_controls.delete_confirmation"))){n.next=2;break}return n.abrupt("return");case 2:return n.abrupt("return",t.delete().then((function(){e.showDeletionAlert(t,"success"),o().current.matches(nt,{id:t.id()})||o().current.matches(Wt,{id:t.id()})?o().history.back():window.location.reload()})).catch((function(){return e.showDeletionAlert(t,"error")})));case 3:case"end":return n.stop()}}),n)})))()},showDeletionAlert:function(t,e){var n={success:"fof-polls.forum.poll_controls.delete_success_message",error:"fof-polls.forum.poll_controls.delete_error_message"}[e];o().alerts.show({type:e},o().translator.trans(n,{poll:t}))},editAction:function(t){m.route.set(o().route("fof.polls.compose",{id:t.id()}))}};function Zt(){return Zt=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},Zt.apply(this,arguments)}var to=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.uploadedImageUrl=void 0,o.fileName=void 0,o}P(e,t);var n=e.prototype;return n.view=function(e){var n;if(this.attrs.loading=this.loading,this.attrs.className=f()(this.attrs.className,"Button"),null!=(n=this.attrs.poll)&&n.imageUrl()||this.uploadedImageUrl){var r,a=this.uploadedImageUrl||(null==(r=this.attrs.poll)?void 0:r.imageUrl());return this.attrs.onclick=this.remove.bind(this),m("div",null,m("p",null,m("img",{src:a,alt:""})),m("p",null,t.prototype.view.call(this,Zt({},e,{children:o().translator.trans("fof-polls.forum.upload_image.remove_button")}))))}return this.attrs.onclick=this.upload.bind(this),t.prototype.view.call(this,Zt({},e,{children:o().translator.trans("fof-polls.forum.upload_image.upload_button")}))},n.upload=function(){var t=this;this.loading||$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(e){var n=new FormData;n.append(t.attrs.name,$(e.target)[0].files[0]),t.loading=!0,m.redraw(),o().request({method:"POST",url:t.resourceUrl(),serialize:function(t){return t},body:n}).then(t.success.bind(t),t.failure.bind(t))}))},n.remove=function(){this.loading=!0,m.redraw(),o().request({method:"DELETE",url:this.resourceUrl()}).then(this.success.bind(this),this.failure.bind(this))},n.resourceUrl=function(){var t=o().forum.attribute("apiUrl")+"/fof/polls/"+this.attrs.name,e=this.attrs.poll;return null!=e&&e.exists&&(t+="/"+(null==e?void 0:e.id())),t},n.success=function(t){var o,e;this.loading=!1,this.uploadedImageUrl=null==t?void 0:t.fileUrl,this.fileName=null==t?void 0:t.fileName,null==(o=(e=this.attrs).onUpload)||o.call(e,null==t?void 0:t.fileName),m.redraw()},n.failure=function(t){this.loading=!1,m.redraw()},e}(O()),oo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).options=[],o.optionAnswers=[],o.optionImageUrls=[],o.question=void 0,o.subtitle=void 0,o.pollImage=void 0,o.imageAlt=void 0,o.endDate=void 0,o.publicPoll=void 0,o.allowMultipleVotes=void 0,o.hideVotes=void 0,o.allowChangeVote=void 0,o.maxVotes=void 0,o.datepickerMinDate="",o}P(e,t);var n=e.prototype;return n.oninit=function(o){var e;t.prototype.oninit.call(this,o),this.state=new R(this.attrs.poll);var n=this.state.poll;this.options=null!=(e=n.tempOptions)?e:n.options(),this.optionAnswers=this.options.map((function(t){return D()(t.answer())})),this.optionImageUrls=this.options.map((function(t){return D()(t.imageUrl())})),this.question=D()(n.question()),this.subtitle=D()(n.subtitle()),this.pollImage=D()(n.imageUrl()),this.imageAlt=D()(n.imageAlt()),this.endDate=D()(this.formatDate(n.endDate())),this.publicPoll=D()(n.publicPoll()),this.allowMultipleVotes=D()(n.allowMultipleVotes()),this.hideVotes=D()(n.hideVotes()),this.allowChangeVote=D()(n.allowChangeVote()),this.maxVotes=D()(n.maxVotes()||0),this.datepickerMinDate=this.formatDate(),this.endDate()&&dayjs(n.endDate).isAfter(dayjs())&&(this.datepickerMinDate=this.formatDate(n.endDate()))},n.view=function(){return m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"PollDiscussionModal-form"},this.fields().toArray()))},n.fields=function(){var t=new(E());return t.add("question",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.question_placeholder")),m("input",{type:"text",name:"question",className:"FormControl",bidi:this.question})),100),t.add("subtitle",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.subtitle_placeholder")),m("input",{type:"text",name:"subtitle",className:"FormControl",bidi:this.subtitle})),95),t.add("poll_image",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.poll_image.label")),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_image.help")),m(to,{name:"pollImage",poll:this.state.poll,onUpload:this.pollImageUploadSuccess.bind(this)}),m("input",{type:"hidden",name:"pollImage",value:this.pollImage()})),90),this.pollImage()&&t.add("poll_image_alt",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.poll_image.alt_label")),m("input",{type:"text",required:!0,name:"imageAlt",className:"FormControl",bidi:this.imageAlt}),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_image.alt_help_text"))),90),t.add("answers",m("div",{className:"PollModal--answers Form-group"},m("label",{className:"label PollModal--answers-title"},m("span",null,o().translator.trans("fof-polls.forum.modal.options_label"))),this.displayOptions(),m(yt(),{text:o().translator.trans("fof-polls.forum.modal.tooltip.options.add-button")},m(O(),{className:"Button PollModal--button Button--icon PollModal--add-button",icon:"fas fa-plus",onclick:this.addOption.bind(this)}))),80),t.add("date",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.date_placeholder")),m("div",{className:"PollModal--date"},m("input",{className:"FormControl",type:"datetime-local",name:"date",bidi:this.endDate,min:this.datepickerMinDate,max:this.formatDate("2038")}),O().component({className:"Button PollModal--button Button--icon",icon:"fas fa-times",onclick:this.endDate.bind(this,null)})),this.endDate()&&m("p",{className:"helpText"},m("i",{class:"icon fas fa-clock"}),"Â ",dayjs(this.endDate()).isBefore(dayjs())?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.endDate()).fromNow()}))),40),t.add("public",m("div",{className:"Form-group"},k().component({state:this.publicPoll()||!1,onchange:this.publicPoll},o().translator.trans("fof-polls.forum.modal.public_poll_label"))),20),t.add("hide-votes",m("div",{className:"Form-group"},m(k(),{state:this.endDate()&&this.hideVotes(),onchange:this.hideVotes,disabled:!this.endDate()},o().translator.trans("fof-polls.forum.modal.hide_votes_label"))),20),t.add("allow-change-vote",m("div",{className:"Form-group"},m(k(),{state:this.allowChangeVote(),onchange:this.allowChangeVote},o().translator.trans("fof-polls.forum.modal.allow_change_vote_label"))),20),t.add("allow-multiple-votes",m("div",{className:"Form-group"},k().component({state:this.allowMultipleVotes()||!1,onchange:this.allowMultipleVotes},o().translator.trans("fof-polls.forum.modal.allow_multiple_votes_label"))),15),this.allowMultipleVotes()&&t.add("max-votes",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.max_votes_label")),m("input",{type:"number",min:"0",max:this.options.length,name:"maxVotes",className:"FormControl",bidi:this.maxVotes}),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.max_votes_help"))),15),t.add("submit",m("div",{className:"Form-group"},m(O(),{type:"submit",className:"Button Button--primary PollModal-SubmitButton",icon:"fas fa-save",loading:this.state.loading},o().translator.trans("fof-polls.forum.modal.submit")),this.state.poll.exists&&m(O(),{className:"Button Button--secondary PollModal-deleteButton",icon:"fas fa-trash-alt",loading:this.state.deleting,onclick:this.delete.bind(this)},o().translator.trans("fof-polls.forum.modal.delete"))),-10),t},n.displayOptions=function(){var t=this;return Object.keys(this.options).map((function(e,n){return m("div",{className:"Form-group"},m("fieldset",{className:"Poll-answer-input"},m("input",{className:"FormControl",type:"text",name:"answer"+(n+1),bidi:t.optionAnswers[n],placeholder:o().translator.trans("fof-polls.forum.modal.option_placeholder")+" #"+(n+1)}),o().forum.attribute("allowPollOptionImage")?m("input",{className:"FormControl",type:"text",name:"answerImage"+(n+1),bidi:t.optionImageUrls[n],placeholder:o().translator.trans("fof-polls.forum.modal.image_option_placeholder")+" #"+(n+1)}):null),n>=2?O().component({type:"button",className:"Button PollModal--button Button--icon",icon:"fas fa-minus",onclick:n>=2?t.removeOption.bind(t,n):""}):"")}))},n.addOption=function(){var t=Math.max(o().forum.attribute("pollMaxOptions"),2);this.options.length<t?(this.options.push(o().store.createRecord("poll_options")),this.optionAnswers.push(D()("")),this.optionImageUrls.push(D()(""))):alert(U()(o().translator.trans("fof-polls.forum.modal.max",{max:t})))},n.removeOption=function(t){this.options.splice(t,1),this.optionAnswers.splice(t,1),this.optionImageUrls.splice(t,1)},n.data=function(){var t,e=this;if(""===this.question())throw new q(o().translator.trans("fof-polls.forum.modal.include_question"));if(this.options.length<2)throw new q(o().translator.trans("fof-polls.forum.modal.min"));var n=this.state.poll.exists,r=this.options.map((function(t,o){return t.pushAttributes({answer:e.optionAnswers[o](),imageUrl:e.optionImageUrls[o]()}),n?t.data:t.data.attributes}));return{question:this.question(),subtitle:this.subtitle(),pollImage:this.pollImage(),imageAlt:this.imageAlt(),endDate:null!=(t=this.dateToTimestamp(this.endDate()))&&t,publicPoll:this.publicPoll(),hideVotes:this.hideVotes(),allowChangeVote:this.allowChangeVote(),allowMultipleVotes:this.allowMultipleVotes(),maxVotes:this.maxVotes(),options:r}},n.onsubmit=function(){var t=y(x().mark((function t(e){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,this.attrs.onsubmit(this.data(),this.state);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),t.t0 instanceof q?o().alerts.show({type:"error"},t.t0.message):(console.error(t.t0),o().alerts.show({type:"error"},o().translator.trans("fof-polls.forum.modal.error")));case 9:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(o){return t.apply(this,arguments)}}(),n.delete=function(){var t=y(x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.state.loading=!0,t.prev=1,t.next=4,Xt.deleteAction(this.state.poll);case 4:this.state.deleting=!0;case 5:return t.prev=5,this.state.loading=!1,m.redraw(),t.finish(5);case 9:case"end":return t.stop()}}),t,this,[[1,,5,9]])})));return function(){return t.apply(this,arguments)}}(),n.formatDate=function(t,o){void 0===t&&(t=void 0),void 0===o&&(o=!1);var e=dayjs(t);return!1!==t&&e.isValid()?e.format("YYYY-MM-DDTHH:mm"):!1!==o&&this.formatDate(o)},n.dateToTimestamp=function(t){var o=dayjs(t);return t&&o.isValid()?o.format():null},n.pollImageUploadSuccess=function(t){this.pollImage(t)},e}(A()),eo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.add_title")},n.className=function(){return"PollDiscussionModal Modal--medium"},n.content=function(){return[m("div",{className:"Modal-body"},m(oo,{poll:this.attrs.poll,onsubmit:this.onFormSubmit.bind(this)}))]},n.onFormSubmit=function(){var t=y(x().mark((function t(o,e){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.hide(),t.next=3,this.attrs.onsubmit(o);case 3:case"end":return t.stop()}}),t,this)})));return function(o,e){return t.apply(this,arguments)}}(),e}(V());function no(t){if(t){var e=o().store.createRecord("polls");return e.tempOptions=t.options.map((function(t){var e=o().store.createRecord("poll_options");return e.pushAttributes(t),e})),e.pushAttributes(t),e}return t}var ro=function(t){t.prototype.addPoll=function(){var t=this;o().modal.show(eo,{poll:no(this.composer.fields.poll),onsubmit:function(o){return t.composer.fields.poll=o}})},(0,r.extend)(t.prototype,"headerItems",(function(t){var e,n,r=null==(e=this.composer.body)||null==(e=e.attrs)?void 0:e.discussion;(null!=(n=null==r?void 0:r.canStartPoll())?n:o().forum.canStartPolls())&&t.add("polls",m("a",{className:"ComposerBody-poll",onclick:this.addPoll.bind(this)},m("span",{className:f()("PollLabel",!this.composer.fields.poll&&"none")},o().translator.trans("fof-polls.forum.composer_discussion."+(this.composer.fields.poll?"edit":"add")+"_poll"))),1)})),(0,r.extend)(t.prototype,"data",(function(t){this.composer.fields.poll&&(t.poll=this.composer.fields.poll)}))};const ao=flarum.core.compat["forum/components/CommentPost"];var lo=e.n(ao);const so=flarum.core.compat["forum/components/DiscussionPage"];var io=e.n(so);function uo(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}const co=flarum.core.compat["forum/utils/PostControls"];var po=e.n(co),mo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.edit_title")},n.onFormSubmit=function(){var t=y(x().mark((function t(e,n){var r;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.save(e);case 2:r=o().alerts.show({type:"success"},o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(r)}),1e4);case 4:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),e}(eo),fo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loadingOptions=!1,o.useSubmitUI=void 0,o.pendingSubmit=!1,o.pendingOptions=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){var e,n;t.prototype.oninit.call(this,o),this.useSubmitUI=!(null!=(e=this.attrs.poll)&&e.canChangeVote())&&(null==(n=this.attrs.poll)?void 0:n.allowMultipleVotes()),this.pendingOptions=null},n.oncreate=function(o){t.prototype.oncreate.call(this,o),this.preventClose=this.preventClose.bind(this),window.addEventListener("beforeunload",this.preventClose)},n.onremove=function(o){t.prototype.onremove.call(this,o),window.removeEventListener("beforeunload",this.preventClose)},n.view=function(){var t=this.attrs.poll,e=t.options()||[],n=t.allowMultipleVotes()?t.maxVotes():1;0===n&&(n=e.length);var r=this.infoItems(n);return m("div",{className:"Post-poll","data-id":t.id()},m("div",{className:"PollHeading"},m("div",{className:"PollHeading-title-container"},m("h3",{className:"PollHeading-title"},t.question()),t.subtitle()&&m("p",{className:"helpText PollHeading-subtitle"},t.subtitle())),m("div",{className:"PollHeading-actions"},t.canSeeVoters()&&m(yt(),{text:o().translator.trans("fof-polls.forum.public_poll")},m(O(),{className:"Button PollHeading-voters",onclick:this.showVoters.bind(this),icon:"fas fa-poll"})),t.canEdit()&&m(yt(),{text:o().translator.trans("fof-polls.forum.moderation.edit")},m(O(),{className:"Button PollHeading-edit",onclick:o().modal.show.bind(o().modal,mo,{poll:t}),icon:"fas fa-pen"})),t.canDelete()&&m(yt(),{text:o().translator.trans("fof-polls.forum.moderation.delete")},m(O(),{className:"Button PollHeading-delete",onclick:this.deletePoll.bind(this),icon:"fas fa-trash"})))),m("div",null,m("div",{className:"PollOptions"},e.map(this.viewOption.bind(this))),m("div",{className:"Poll-sticky"},!r.isEmpty()&&m("div",{className:"helpText PollInfoText"},r.toArray()),this.useSubmitUI&&this.pendingSubmit&&m(O(),{className:"Button Button--primary Poll-submit",loading:this.loadingOptions,onclick:this.onsubmit.bind(this)},o().translator.trans("fof-polls.forum.poll.submit_button")))))},n.infoItems=function(t){var e,n=new(E()),r=this.attrs.poll,a=(null==(e=r.myVotes())?void 0:e.length)>0;return!o().session.user||r.canVote()||r.hasEnded()||n.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),r.endDate()&&n.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),r.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(r.endDate()).fromNow()}))),r.canVote()&&(n.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),r.canChangeVote()||n.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(a?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),n},n.viewOption=function(t){var e,n,r,a=this.attrs.poll,l=(null==(e=a.myVotes())?void 0:e.length)>0,s=a.voteCount(),i=this.pendingOptions?this.pendingOptions.has(t.id()):null==(n=a.myVotes())||null==n.some?void 0:n.some((function(o){return o.option()===t})),u=t.voteCount(),c=s>0?Math.round(u/s*100):0,p="number"==typeof u,d=this.loadingOptions||l&&!a.canChangeVote(),h=p?c:Number(i)/((null==(r=a.myVotes())?void 0:r.length)||1)*100,v=!o().session.user||!a.hasEnded()&&a.canVote()&&(!l||a.canChangeVote()),g=m("div",{className:"PollBar","data-selected":!!i,style:"--poll-option-width: "+h+"%"},v&&m("label",{className:"PollAnswer-checkbox checkbox"},m("input",{onchange:this.changeVote.bind(this,t),type:"checkbox",checked:i,disabled:d}),m("span",{className:"checkmark"})),m("div",{className:"PollAnswer-text"},m("span",{className:"PollAnswer-text-answer"},t.answer()),i&&!v&&ht()("fas fa-check-circle",{className:"PollAnswer-check"}),p&&m("span",{className:f()("PollPercent",100!==c&&"PollPercent--option")},c,"%")),t.imageUrl()?m("img",{className:"PollAnswer-image",src:t.imageUrl(),alt:t.answer()}):null);return m("div",{className:f()("PollOption",l&&"PollVoted",a.hasEnded()&&"PollEnded",t.imageUrl()&&"PollOption-hasImage"),"data-id":t.id()},p?m(yt(),{text:o().translator.trans("fof-polls.forum.tooltip.votes",{count:u}),onremove:this.hideOptionTooltip},g):g)},n.changeVote=function(t,e){var n,r;if(!o().session.user)return o().modal.show(_t()),void(e.target.checked=!1);var a=this.pendingOptions||new Set(null==(n=(r=this.attrs.poll.myVotes()).map)?void 0:n.call(r,(function(t){return t.option().id()}))),l=a.delete(t.id());return this.attrs.poll.allowMultipleVotes()||a.clear(),l||a.add(t.id()),this.useSubmitUI?(this.pendingOptions=a.size?a:null,void(this.pendingSubmit=!!this.pendingOptions)):this.submit(a,null,(function(){return e.target.checked=l}))},n.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}))},n.submit=function(t,e,n){var r=this;return this.loadingOptions=!0,m.redraw(),o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.attrs.poll.id()+"/votes",body:{data:{optionIds:Array.from(t)}}}).then((function(t){o().store.pushPayload(t),null==e||e()})).catch((function(t){null==n||n(t)})).finally((function(){r.loadingOptions=!1,m.redraw()}))},n.showVoters=function(){o().modal.show(Ot,{poll:this.attrs.poll,post:this.attrs.post})},n.deletePoll=function(){confirm(U()(o().translator.trans("fof-polls.forum.moderation.delete_confirm")))&&this.attrs.poll.delete().then((function(){m.redraw.sync()}))},n.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},n.preventClose=function(t){if(this.pendingOptions)return t.preventDefault(),!0},e}(A()),ho=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=void 0,o}P(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.poll=this.attrs.poll},e.view=function(){return m("div",{className:"PollShowcase--item"},m(Et,{poll:this.poll}))},o}(A()),vo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.attrs.state.refresh()},n.view=function(){return m("div",{className:"PollShowcase"},m("div",{className:"PollShowcase-featured"},m("h3",null,o().translator.trans("fof-polls.forum.showcase.active-polls")),this.showcaseItems().toArray(),0===this.showcaseItems().toArray().length&&m(Tt(),{text:o().translator.trans("fof-polls.forum.showcase.no-active-polls")})),m("div",{className:"PollShowcase-ended"},m("h3",null,o().translator.trans("fof-polls.forum.showcase.ended-polls")),this.endedItems().toArray(),0===this.endedItems().toArray().length&&m(Tt(),{text:o().translator.trans("fof-polls.forum.showcase.no-recent-polls")})))},n.showcaseItems=function(){var t=new(E());return this.attrs.state.getPages().map((function(o){o.items.map((function(o){o.hasEnded()||t.add("poll-active-"+o.id(),m(ho,{poll:o}))}))})),t},n.endedItems=function(){var t=new(E());return this.attrs.state.getPages().map((function(o){o.items.map((function(o){o.hasEnded()&&t.add("poll-ended-"+o.id(),m(ho,{poll:o}))}))})),t},e}(A()),go=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")?(this.state=new Jt({sort:m.route.param("sort"),filter:m.route.param("filter"),include:["options","votes","myVotes","myVotes.option"]}),this.state.refresh(),o().setTitle(U()(o().translator.trans("fof-polls.forum.page.nav")))):m.route.set("/")},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return this.loading||o.add("poll-showcase",m(vo,{state:this.state})),o},n.sidebarItems=function(){var e=this,n=t.prototype.sidebarItems.call(this),r=o().forum.attribute("canStartGlobalPolls");return r&&(n.remove("newDiscussion"),n.add("newGlobalPoll",m(O(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){e.newPollAction()},disabled:!r},o().translator.trans("fof-polls.forum.poll."+(r?"start_poll_button":"cannot_start_poll_button"))),100)),n},n.newPollAction=function(){o().session.user?m.route.set(o().route("fof.polls.compose")):o().modal.show(_t())},e}(Lt),bo={CreatePollModal:eo,PostPoll:fo,EditPollModal:mo,ListVotersModal:Ot,PollForm:oo,ComposePollHero:K,ComposePollPage:nt,PollsPage:Wt,PollView:Et,PollViewPage:Dt,PollSubmitButton:kt,PollOptions:Pt,PollsShowcasePage:go,PollShowcase:vo,PollShowcaseItem:ho,AbstractPollPage:Lt};const yo=flarum.core.compat["common/Model"];var wo=e.n(yo);const Po=flarum.core.compat["common/utils/computed"];var No=e.n(Po),xo=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).tempOptions=void 0,o}P(o,t);var e=o.prototype;return e.question=function(){return wo().attribute("question").call(this)},e.subtitle=function(){return wo().attribute("subtitle").call(this)},e.imageUrl=function(){return wo().attribute("imageUrl").call(this)},e.imageAlt=function(){return wo().attribute("imageAlt").call(this)},e.hasEnded=function(){return wo().attribute("hasEnded").call(this)},e.endDate=function(){return wo().attribute("endDate",wo().transformDate).call(this)},e.publicPoll=function(){return wo().attribute("publicPoll").call(this)},e.hideVotes=function(){return wo().attribute("hideVotes").call(this)},e.allowChangeVote=function(){return wo().attribute("allowChangeVote").call(this)},e.allowMultipleVotes=function(){return wo().attribute("allowMultipleVotes").call(this)},e.maxVotes=function(){return wo().attribute("maxVotes").call(this)},e.voteCount=function(){return wo().attribute("voteCount").call(this)},e.canVote=function(){return wo().attribute("canVote").call(this)},e.canEdit=function(){return wo().attribute("canEdit").call(this)},e.canDelete=function(){return wo().attribute("canDelete").call(this)},e.canSeeVoters=function(){return wo().attribute("canSeeVoters").call(this)},e.canChangeVote=function(){return wo().attribute("canChangeVote").call(this)},e.options=function(){return wo().hasMany("options").call(this)||[]},e.votes=function(){return wo().hasMany("votes").call(this)},e.myVotes=function(){return wo().hasMany("myVotes").call(this)||[]},e.isGlobal=function(){return wo().attribute("isGlobal").call(this)},e.isHidden=function(){return No()("hiddenAt",(function(t){return!!t})).call(this)},e.isUnread=function(){return!1},e.apiEndpoint=function(){return"/fof/polls"+(this.exists?"/"+this.data.id:"")},o}(wo()),_o=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.answer=function(){return wo().attribute("answer").call(this)},e.imageUrl=function(){return wo().attribute("imageUrl").call(this)},e.voteCount=function(){return wo().attribute("voteCount").call(this)},e.poll=function(){return wo().hasOne("polls").call(this)},e.votes=function(){return wo().hasMany("votes").call(this)},e.apiEndpoint=function(){return"/fof/polls/answers"+(this.exists?"/"+this.data.id:"")},o}(wo()),Vo=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.poll=function(){return wo().hasOne("poll").call(this)},e.option=function(){var t=wo().hasOne("option").call(this);return!1===t?null:t},e.user=function(){return wo().hasOne("user").call(this)},e.pollId=function(){return wo().attribute("pollId").call(this)},e.optionId=function(){return wo().attribute("optionId").call(this)},e.apiEndpoint=function(){return"/fof/polls/"+this.pollId()+"/vote"},o}(wo()),Io={Poll:xo,PollOption:_o,PollVote:Vo},Ao={PollFormState:R,PollListState:Jt,PollState:St};const Co=flarum.core.compat["common/extenders"];var Oo=e.n(Co);const So=flarum.core.compat["common/models/Post"];var ko=e.n(So);const Mo=flarum.core.compat["common/models/Forum"];var Eo=e.n(Mo);const Lo=[(new(Oo().Routes)).add("fof.polls.showcase","/polls",go).add("fof.polls.list","/polls/all",Wt).add("fof.polls.view","/polls/view/:id",Dt).add("fof.polls.compose","/polls/composer",nt),(new(Oo().Store)).add("polls",xo).add("poll_options",_o).add("poll_votes",Vo),new(Oo().Model)(ko()).hasMany("polls").attribute("canStartPoll"),new(Oo().Model)(Eo()).attribute("canStartPolls"),new(Oo().Model)(c()).attribute("hasPoll").attribute("canStartPoll")];o().initializers.add("fof/polls",(function(){var t;(0,r.extend)(i().prototype,"requestParams",(function(t){t.include.push("poll")})),(0,r.extend)(c().prototype,"badges",(function(t){this.hasPoll()&&t.add("poll",l().component({type:"poll",label:o().translator.trans("fof-polls.forum.tooltip.badge"),icon:"fas fa-poll"}),5)})),ro(h()),ro(g()),(0,r.extend)(lo().prototype,"content",(function(t){var o=this.attrs.post;if((!o.isHidden()||this.revealContent)&&o.polls())for(var e,n=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return uo(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?uo(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.polls());!(e=n()).done;){var r=e.value;r&&t.push(m(Et,{poll:r}))}})),(0,r.extend)(lo().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var o=t.attrs.post.polls(),e=null==o||null==o.map?void 0:o.map((function(t){var o,e,n,r,a;return t&&[null==(o=t.data)?void 0:o.attributes,null==(e=(n=t.options()).map)?void 0:e.call(n,(function(t){var o;return null==t||null==(o=t.data)?void 0:o.attributes})),null==(r=(a=t.myVotes()).map)?void 0:r.call(a,(function(t){var o;return null==(o=t.option())?void 0:o.id()}))]}));return JSON.stringify(e)}))})),(0,r.extend)(io().prototype,"oncreate",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.bind("updatedPollOptions",(function(t){var e=o().store.getById("polls",t.pollId);e&&e.pushAttributes({voteCount:t.pollVoteCount});var n=t.options;for(var r in n){var a=o().store.getById("poll_options",r);a&&void 0!==a.voteCount()&&a.pushAttributes({voteCount:n[r]})}m.redraw()}))}))})),(0,r.extend)(io().prototype,"onremove",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.unbind("updatedPollOptions")}))})),t=function(t){return o().modal.show(eo,{onsubmit:function(e){return o().store.createRecord("polls").save(Zt({},e,{relationships:{post:t}}),{data:{include:"options,myVotes,myVotes.option"}}).then((function(o){var e;return null==(e=t.rawRelationship("polls"))||null==e.push||e.push({type:"polls",id:o.id()}),o}))}})},(0,r.extend)(po(),"moderationControls",(function(e,n){!n.isHidden()&&n.canStartPoll()&&e.add("addPoll",m(O(),{icon:"fas fa-poll",onclick:t.bind(this,n)},o().translator.trans("fof-polls.forum.moderation.add")))})),(0,r.extend)(et().prototype,"navItems",(function(t){o().forum.attribute("globalPollsEnabled")&&(t.add("fof-polls-showcase",W().component({href:o().route("fof.polls.showcase"),icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.page.nav")),35),o().forum.attribute("canStartGlobalPolls")&&t.add("fof-polls-list",W().component({href:o().route("fof.polls.list"),icon:"fas fa-list"},o().translator.trans("fof-polls.forum.page.nav-all")),32))}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map