/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,o,e)=>{var n=e(735).default;function r(){"use strict";t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var o,e={},l=Object.prototype,a=l.hasOwnProperty,s=Object.defineProperty||function(t,o,e){t[o]=e.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",p=i.toStringTag||"@@toStringTag";function m(t,o,e){return Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[o]}try{m({},"")}catch(o){m=function(t,o,e){return t[o]=e}}function d(t,o,e,n){var r=o&&o.prototype instanceof w?o:w,l=Object.create(r.prototype),a=new L(n||[]);return s(l,"_invoke",{value:S(t,e,a)}),l}function f(t,o,e){try{return{type:"normal",arg:t.call(o,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var h="suspendedStart",v="suspendedYield",g="executing",y="completed",b={};function w(){}function P(){}function N(){}var _={};m(_,u,(function(){return this}));var x=Object.getPrototypeOf,I=x&&x(x(E([])));I&&I!==l&&a.call(I,u)&&(_=I);var A=N.prototype=w.prototype=Object.create(_);function V(t){["next","throw","return"].forEach((function(o){m(t,o,(function(t){return this._invoke(o,t)}))}))}function C(t,o){function e(r,l,s,i){var u=f(t[r],t,l);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==n(p)&&a.call(p,"__await")?o.resolve(p.__await).then((function(t){e("next",t,s,i)}),(function(t){e("throw",t,s,i)})):o.resolve(p).then((function(t){c.value=t,s(c)}),(function(t){return e("throw",t,s,i)}))}i(u.arg)}var r;s(this,"_invoke",{value:function(t,n){function l(){return new o((function(o,r){e(t,n,o,r)}))}return r=r?r.then(l,l):l()}})}function S(t,e,n){var r=h;return function(l,a){if(r===g)throw Error("Generator is already running");if(r===y){if("throw"===l)throw a;return{value:o,done:!0}}for(n.method=l,n.arg=a;;){var s=n.delegate;if(s){var i=G(s,n);if(i){if(i===b)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var u=f(t,e,n);if("normal"===u.type){if(r=n.done?y:v,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=y,n.method="throw",n.arg=u.arg)}}}function G(t,e){var n=e.method,r=t.iterator[n];if(r===o)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=o,G(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var l=f(r,t.iterator,e.arg);if("throw"===l.type)return e.method="throw",e.arg=l.arg,e.delegate=null,b;var a=l.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=o),e.delegate=null,b):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b)}function k(t){var o={tryLoc:t[0]};1 in t&&(o.catchLoc=t[1]),2 in t&&(o.finallyLoc=t[2],o.afterLoc=t[3]),this.tryEntries.push(o)}function O(t){var o=t.completion||{};o.type="normal",delete o.arg,t.completion=o}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,l=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=o,e.done=!0,e};return l.next=l}}throw new TypeError(n(t)+" is not iterable")}return P.prototype=N,s(A,"constructor",{value:N,configurable:!0}),s(N,"constructor",{value:P,configurable:!0}),P.displayName=m(N,p,"GeneratorFunction"),e.isGeneratorFunction=function(t){var o="function"==typeof t&&t.constructor;return!!o&&(o===P||"GeneratorFunction"===(o.displayName||o.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,N):(t.__proto__=N,m(t,p,"GeneratorFunction")),t.prototype=Object.create(A),t},e.awrap=function(t){return{__await:t}},V(C.prototype),m(C.prototype,c,(function(){return this})),e.AsyncIterator=C,e.async=function(t,o,n,r,l){void 0===l&&(l=Promise);var a=new C(d(t,o,n,r),l);return e.isGeneratorFunction(o)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},V(A),m(A,p,"Generator"),m(A,u,(function(){return this})),m(A,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var o=Object(t),e=[];for(var n in o)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in o)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=E,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=o),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var l=this.tryEntries[r],s=l.completion;if("root"===l.tryLoc)return n("end");if(l.tryLoc<=this.prev){var i=a.call(l,"catchLoc"),u=a.call(l,"finallyLoc");if(i&&u){if(this.prev<l.catchLoc)return n(l.catchLoc,!0);if(this.prev<l.finallyLoc)return n(l.finallyLoc)}else if(i){if(this.prev<l.catchLoc)return n(l.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return n(l.finallyLoc)}}}},abrupt:function(t,o){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=o&&o<=r.finallyLoc&&(r=null);var l=r?r.completion:{};return l.type=t,l.arg=o,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(l)},complete:function(t,o){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&o&&(this.next=o),b},finish:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),b}},catch:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var r=n.arg;O(e)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=o),b}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,o,e)=>{var n=e(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},o={};function e(n){var r=o[n];if(void 0!==r)return r.exports;var l=o[n]={exports:{}};return t[n](l,l.exports,e),l.exports}e.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},e.d=(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},e.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";e.r(n),e.d(n,{components:()=>Do,extend:()=>ee,models:()=>Yo,states:()=>Qo,utils:()=>Wo});const t=flarum.core.compat["forum/app"];var o=e.n(t);const r=flarum.core.compat["common/extend"],l=flarum.core.compat["common/components/Badge"];var a=e.n(l);const s=flarum.core.compat["forum/components/DiscussionList"];var i=e.n(s);const u=flarum.core.compat["common/models/Discussion"];var c=e.n(u);const p=flarum.core.compat["common/utils/classList"];var d=e.n(p);const f=flarum.core.compat["forum/components/DiscussionComposer"];var h=e.n(f);const v=flarum.core.compat["forum/components/ReplyComposer"];var g=e.n(v);function y(t,o,e,n,r,l,a){try{var s=t[l](a),i=s.value}catch(t){return void e(t)}s.done?o(i):Promise.resolve(i).then(n,r)}function b(t){return function(){var o=this,e=arguments;return new Promise((function(n,r){var l=t.apply(o,e);function a(t){y(l,n,r,a,s,"next",t)}function s(t){y(l,n,r,a,s,"throw",t)}a(void 0)}))}}function w(t,o){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},w(t,o)}function P(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,w(t,o)}var N=e(183),_=e.n(N);const x=flarum.core.compat["common/components/Modal"];var I=e.n(x);const A=flarum.core.compat["common/Component"];var V=e.n(A);const C=flarum.core.compat["common/components/Button"];var S=e.n(C);const G=flarum.core.compat["common/components/Switch"];var k=e.n(G);const O=flarum.core.compat["common/utils/ItemList"];var L=e.n(O);const E=flarum.core.compat["common/utils/Stream"];var M=e.n(E);const B=flarum.core.compat["common/utils/extractText"];var U=e.n(B);function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function T(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(T=function(){return!!t})()}function j(t){var o="function"==typeof Map?new Map:void 0;return j=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(o){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return function(t,o,e){if(T())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,o);var r=new(t.bind.apply(t,n));return e&&w(r,e.prototype),r}(t,arguments,D(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),w(e,t)},j(t)}var q=function(t){function o(o){return t.call(this,o+"")||this}return P(o,t),o}(j(Error)),F=function(){function t(o){this.poll=void 0,this.loading=void 0,this.deleting=void 0,this.expandedGroup=void 0,o||(o=t.createNewPoll()),this.loading=!1,this.deleting=!1,this.poll=o,this.expandedGroup="setup"}t.createNewPoll=function(){var t=o().store.createRecord("polls");return t.pushAttributes({question:"",endDate:"",publicPoll:!1,allowMultipleVotes:!1,hideVotes:!1,allowChangeVote:!1,maxVotes:0}),t.tempOptions=[o().store.createRecord("poll_options"),o().store.createRecord("poll_options")],t};var e=t.prototype;return e.isExpanded=function(t){return this.expandedGroup===t},e.expand=function(t){this.expandedGroup=t,m.redraw()},e.save=function(){var t=b(_().mark((function t(o){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.save(o);case 5:this.poll=t.sent,delete this.poll.data.attributes.options;case 7:return t.prev=7,this.loading=!1,m.redraw(),t.finish(7);case 11:case"end":return t.stop()}}),t,this,[[2,,7,11]])})));return function(o){return t.apply(this,arguments)}}(),e.delete=function(){var t=b(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.delete();case 5:this.deleting=!0;case 6:return t.prev=6,this.loading=!1,m.redraw(),t.finish(6);case 10:case"end":return t.stop()}}),t,this,[[2,,6,10]])})));return function(){return t.apply(this,arguments)}}(),t}();const H=flarum.core.compat["common/components/Page"];var R=e.n(H);const z=flarum.core.compat["common/components/LoadingIndicator"];var Y=e.n(z);const Q=flarum.core.compat["common/components/LinkButton"];var W=e.n(Q),J=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.poll=this.attrs.poll},n.view=function(){return m("div",{className:"ComposePollHero Hero"},m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h2",{className:"Hero-title"},o().translator.trans("fof-polls.forum.compose."+(this.poll.id()?"edit":"add")+"_title")),m("div",{className:"ComposePollHero-controls"},this.controlItems().toArray()))))},n.controlItems=function(){var t=new(L());return t.add("edit",m(W(),{icon:"far fa-edit",className:"Button Button--secondary GlobalPollListLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.list")},o().translator.trans("fof-polls.forum.compose.polls_manager"))),this.poll.exists&&t.add("view",m(W(),{icon:"far fa-arrow-up-right-from-square",className:"Button Button--secondary PollPreviewLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.view",{id:this.poll.id()})},o().translator.trans("fof-polls.forum.compose.polls_preview"))),t},e}(V());const K=flarum.core.compat["common/helpers/listItems"];var X=e.n(K);const Z=flarum.core.compat["common/components/SelectDropdown"];var tt=e.n(Z);const ot=flarum.core.compat["forum/components/IndexPage"];var et=e.n(ot),nt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=null,o.loading=!1,o}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;if(t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")&&o().forum.attribute("canStartGlobalPolls")){this.bodyClass="App--compose-poll";var r=m.route.param("id");(r?this.loadEditingPoll(r):Promise.resolve(F.createNewPoll())).then((function(t){var e,r;n.poll=t,null==t||!t.exists||t.canEdit()?(o().history.push("compose-poll",o().translator.trans("fof-polls.forum.compose."+(null!=(e=n.poll)&&e.id()?"edit":"add")+"_title")),o().setTitle(o().translator.trans("fof-polls.forum.compose."+(null!=(r=n.poll)&&r.id()?"edit":"add")+"_title")),m.redraw()):m.route.set("/")}))}else m.route.set("/")},n.loadEditingPoll=function(){var t=b(_().mark((function t(e){var n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=o().store.getById("poll",e))){t.next=3;break}return t.abrupt("return",n);case 3:return this.loading=!0,t.next=6,o().store.find("fof/polls",e);case 6:return r=t.sent,this.loading=!1,t.abrupt("return",r);case 9:case"end":return t.stop()}}),t,this)})));return function(o){return t.apply(this,arguments)}}(),n.view=function(){return this.loading||!this.poll?m(Y(),null):m("div",{className:"ComposePollPage"},m(J,{poll:this.poll}),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset"},m(io,{poll:this.poll,onsubmit:this.onsubmit.bind(this)})))))},n.onsubmit=function(){var t=b(_().mark((function t(e,n){var r,l,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===n.poll.id(),t.next=3,n.save(e);case 3:l=r?{type:"success",controls:[m(S(),{className:"Button Button--link",onclick:function(){return m.route.set(o().route("fof.polls.compose",{id:n.poll.id()}))}},o().translator.trans("fof-polls.forum.compose.continue_editing"))]}:{type:"success"},a=o().alerts.show(l,o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(a)}),1e4),r&&m.route.set(o().route("fof.polls.list"));case 7:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),n.sidebarItems=function(){var t=new(L());return t.add("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){return et().prototype.navItems()},e}(R());const rt=flarum.core.compat["common/utils/SubtreeRetainer"];var lt=e.n(rt);const at=flarum.core.compat["common/components/Dropdown"];var st=e.n(at);const it=flarum.core.compat["common/components/Link"];var ut=e.n(it);const ct=flarum.core.compat["common/helpers/highlight"];var pt=e.n(ct);const mt=flarum.core.compat["forum/utils/slidable"];var dt=e.n(mt);const ft=flarum.core.compat["common/helpers/icon"];var ht=e.n(ft);const vt=flarum.core.compat["common/utils/abbreviateNumber"];var gt=e.n(vt);const yt=flarum.core.compat["common/components/Tooltip"];var bt=e.n(yt),wt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).option=void 0,o.name=void 0,o.state=void 0,o.hasVoted=!1,o.totalVotes=0,o.votes=0,o.voted=!1,o.poll=void 0,o.canSeeVoteCount=!1,o.answer=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.option=this.attrs.option,this.name=this.attrs.name,this.state=this.attrs.state,this.poll=this.state.poll,this.canSeeVoteCount="number"==typeof this.votes,this.answer=this.option.answer()},n.percent=function(){return this.totalVotes>0?Math.round(this.votes/this.totalVotes*100):0},n.view=function(){var t;this.hasVoted=this.state.hasVoted(),this.totalVotes=this.state.overallVoteCount(),this.votes=this.option.voteCount(),this.voted=this.state.hasVotedFor(this.option);var e=this.state.loadingOptions||this.hasVoted&&!this.poll.canChangeVote(),n=this.canSeeVoteCount?this.percent():Number(this.voted)/((null==(t=this.poll.myVotes())?void 0:t.length)||1)*100,r=m("label",{className:"PollBar","data-selected":!!this.voted,style:"--poll-option-width: "+n+"%"},this.state.showCheckMarks&&m("div",{className:"PollAnswer-checkbox"},m("input",{className:"PollAnswer-input sr-only",type:"checkbox",id:this.option.id(),name:this.name,value:this.answer,checked:this.voted,disabled:e,"aria-labelledby":this.name+"-"+this.option.id()+"-label",onchange:this.state.changeVote.bind(this.state,this.option)}),m("span",{className:"checkmark"})),m("div",{className:"PollAnswer-text"},this.optionDisplayItems().toArray()),this.option.imageUrl()?m("img",{className:"PollAnswer-image",src:this.option.imageUrl(),alt:this.option.answer(),loading:"lazy"}):null);return m("div",{className:d()("PollOption",this.hasVoted&&"PollVoted",this.option.imageUrl()&&"PollOption-hasImage"),"data-id":this.option.id()},this.canSeeVoteCount?m(bt(),{text:o().translator.trans("fof-polls.forum.tooltip.votes",{count:this.votes}),onremove:this.hideOptionTooltip},r):r)},n.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},n.optionDisplayItems=function(){var t=new(L());return t.add("answer",m("span",{className:"PollAnswer-text-answer",id:this.name+"-"+this.option.id()+"-label"},this.answer)),this.voted&&!this.state.showCheckMarks&&t.add("check",ht()("fas fa-check-circle",{className:"PollAnswer-check"})),this.canSeeVoteCount&&t.add("percent",m("span",{className:d()("PollPercent",100!==this.percent()&&"PollPercent--option")},this.percent(),"%")),t},e}(V()),Pt=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.view=function(){return m("div",{className:"Poll-options list-layout"},this.pollOptions().toArray())},e.pollOptions=function(){var t=this,o=new(L());return this.attrs.options.forEach((function(e){o.add("option"+e.id(),t.createOptionView(e))})),o},e.createOptionView=function(t){return m(wt,{name:this.attrs.name,option:t,state:this.attrs.state})},o}(V()),Nt=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).imageUrl=null,o.imageAlt=null,o}P(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.imageUrl=this.attrs.poll.imageUrl(),this.imageAlt=this.attrs.poll.imageAlt()},e.view=function(){if(this.imageUrl)return m("div",{className:"PollImage"},this.imageItems().toArray())},e.imageItems=function(){var t,o=new(L());return o.add("image",m("img",{src:this.imageUrl,alt:null!=(t=this.imageAlt)?t:"",className:"PollImage-image",loading:"lazy"})),o},o}(V());const _t=flarum.core.compat["forum/components/LogInModal"];var xt=e.n(_t);const It=flarum.core.compat["common/helpers/avatar"];var At=e.n(It);const Vt=flarum.core.compat["common/helpers/username"];var Ct=e.n(Vt),St=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.loading=!0,o().store.find("fof/polls",this.attrs.poll.id(),{include:"votes,votes.user,votes.option"}).then((function(){return n.loading=!1})).finally((function(){return m.redraw()}))},n.className=function(){return"Modal--medium VotesModal"},n.title=function(){return o().translator.trans("fof-polls.forum.votes_modal.title")},n.content=function(){var t=this.attrs.poll.options();return m("div",{className:"Modal-body"},this.loading?m(Y(),null):t.map(this.optionContent.bind(this)))},n.optionContent=function(t){var e=(this.attrs.poll.votes()||[]).filter((function(o){return t.id()===o.option().id()}));return m("div",{className:"VotesModal-option"},m("h3",null,this.optionAnswer(t)+":"),e.length?m("div",{className:"VotesModal-list"},e.map(this.voteContent.bind(this))):m("h4",null,o().translator.trans("fof-polls.forum.modal.no_voters")))},n.optionAnswer=function(t){return t.answer()},n.voteContent=function(t){var e=t.user(),n=e&&{href:o().route.user(e)};return m(ut(),n,At()(e)," ",Ct()(e))},e}(I()),Gt=function(){function t(t){var e=this;this.poll=void 0,this.pendingSubmit=!1,this.pendingOptions=null,this.loadingOptions=!1,this.useSubmitUI=void 0,this.showCheckMarks=void 0,this.canSeeVoteCount=void 0,this.showVoters=function(){o().modal.show(St,{poll:e.poll})},this.poll=t,this.useSubmitUI=!(null!=t&&t.canChangeVote())&&(null==t?void 0:t.allowMultipleVotes()),this.showCheckMarks=!o().session.user||!t.hasEnded()&&t.canVote()&&(!this.hasVoted()||t.canChangeVote()),this.canSeeVoteCount="number"==typeof t.voteCount(),this.init()}var e=t.prototype;return e.init=function(){},e.isShowResult=function(){return this.poll.hasEnded()||this.canSeeVoteCount&&!!o().session.user&&this.hasVoted()},e.hasVoted=function(){return this.poll.myVotes().length>0},e.overallVoteCount=function(){return this.poll.voteCount()},e.hasVotedFor=function(t){return this.pendingOptions?this.pendingOptions.has(t.id()):this.poll.myVotes().some((function(o){return o.option()===t}))},e.getMaxVotes=function(){var t=this.poll,o=t.allowMultipleVotes()?t.maxVotes():1;return 0===o&&(o=t.options().length),o},e.showButton=function(){return this.useSubmitUI&&this.pendingSubmit},e.changeVote=function(t,e){var n=e.target;if(!o().session.user)return o().modal.show(xt()),void(n.checked=!1);var r=this.pendingOptions||new Set(this.poll.myVotes().map((function(t){return t.option().id()}))),l=r.delete(t.id());if(this.poll.allowMultipleVotes()||r.clear(),l||r.add(t.id()),this.pendingOptions=r.size?r:null,this.pendingSubmit=!!this.pendingOptions,this.useSubmitUI)return this.pendingOptions=r.size?r:null,this.pendingSubmit=!!this.pendingOptions,void m.redraw();this.submit(r,null,(function(){return n.checked=l}))},e.hasSelectedOptions=function(){return this.pendingSubmit},e.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}))},e.submit=function(t,e,n){var r=this;return void 0===n&&(n=null),this.loadingOptions=!0,m.redraw(),o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.poll.id()+"/votes",body:{data:{optionIds:Array.from(t)}}}).then((function(t){o().store.pushPayload(t),null==e||e()})).catch((function(t){null==n||n(t)})).finally((function(){r.loadingOptions=!1,r.canSeeVoteCount="number"==typeof r.poll.voteCount(),m.redraw()}))},t}(),kt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.view=function(){var t=this,e=this.attrs.state;return m(S(),{className:"Button Button--primary Poll-submit",loading:e.loadingOptions,onclick:function(o){return t.pollButtonSubmit(e,o)},disabled:!e.hasSelectedOptions()},o().translator.trans("fof-polls.forum.poll.submit_button"))},n.pollButtonSubmit=function(t,o){t.onsubmit()},e}(V());const Ot=flarum.core.compat["common/utils/string"];var Lt=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.view=function(){return m("div",{className:"Poll-title-component"},this.pollTitleItems().toArray())},e.pollTitleItems=function(){var t=new(L());return t.add("title",m("h3",{className:"Poll-title"},this.attrs.poll.question())),t},o}(V()),Et=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.view=function(){if(this.attrs.poll.subtitle())return m("div",{className:"Poll-subtitle-component"},this.pollSubtitleItems().toArray())},e.pollSubtitleItems=function(){var t=new(L());return t.add("subtitle",m("p",{className:"Poll-subtitle"},this.attrs.poll.subtitle())),t},o}(V()),Mt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).state=void 0,o.preventClose=function(t){if(o.state.hasSelectedOptions())return t.preventDefault(),!0},o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new Gt(this.attrs.poll)},n.oncreate=function(o){t.prototype.oncreate.call(this,o),this.preventClose=this.preventClose.bind(this),window.addEventListener("beforeunload",this.preventClose)},n.onremove=function(o){t.prototype.onremove.call(this,o),window.removeEventListener("beforeunload",this.preventClose)},n.view=function(){var t=this.attrs.poll,e=this.state,n=no.controls(t,this);return(t.publicPoll()||t.canEdit())&&n.add("view",m(S(),{onclick:e.showVoters,icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.public_poll"))),m("div",{className:d()("Poll",t.imageUrl()&&"Poll--image"),"data-id":t.id()},this.controlsView(n.toArray()),m("div",{className:"Poll-wrapper"},this.createMainView().toArray()))},n.createMainView=function(){var t=new(L());return t.add("header",m("div",{className:"Poll-header"},this.createPollHeader().toArray())),t.add("content",m("div",{className:"Poll-content"},this.createPollContent().toArray())),t.add("footer",m("div",{className:"Poll-footer"},this.createPollFooter().toArray())),t},n.createPollHeader=function(){var t=new(L()),o=this.attrs.poll;return t.add("title",m(Lt,{poll:o})),o.subtitle()&&t.add("subtitle",m(Et,{poll:o})),t},n.createPollContent=function(){var t=new(L()),o=this.attrs.poll;return o.imageUrl()&&t.add("image",m(Nt,{poll:o})),t.add("form",m("form",{className:"Poll-form"},this.createFormItems().toArray())),t},n.createPollFooter=function(){var t=new(L()),o=this.state,e=this.infoItems(o.getMaxVotes());return t.add("sticky",m("div",{className:"Poll-sticky"},!e.isEmpty()&&m("div",{className:"helpText PollInfoText"},e.toArray()),o.showButton()&&m(kt,{state:o}))),t},n.createFormItems=function(){var t=new(L()),o=this.attrs.poll,e=this.state,n=(0,Ot.slug)(o.question());return t.add("elements",m("fieldset",null,m("legend",{className:"sr-only"},o.question()),m(Pt,{name:n,options:o.options(),state:e}))),t},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.infoItems=function(t){var e=new(L()),n=this.attrs.poll;return!o().session.user||n.canVote()||n.hasEnded()||e.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),n.endDate()&&e.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),n.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(n.endDate()).fromNow()}))),!n.canVote()||n.hasEnded()||this.state.hasVoted()||(e.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),n.canChangeVote()||e.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(this.state.hasVoted()?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),(n.hasEnded()||this.state.hasVoted())&&e.add("total-vote-count",m("span",null,m("i",{className:"icon fas fa-poll fa-fw","aria-hidden":"true"}),o().translator.trans("fof-polls.forum.poll.total_votes",{count:n.voteCount()}))),e},e}(V());function Bt(t){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(t)}function Ut(t){var o=function(t){if("object"!=Bt(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var e=o.call(t,"string");if("object"!=Bt(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Bt(o)?o:o+""}function Dt(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ut(n.key),n)}}function Tt(t,o,e){return o&&Dt(t.prototype,o),e&&Dt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var jt=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o)},n.oncreate=function(o){t.prototype.oncreate.call(this,o)},n.view=function(){return m("div",{className:this.wrapperClasses},m("header",{className:this.classNames},m("div",{className:"container"},m("div",{className:"containerNarrow"},this.items().toArray()))))},n.items=function(){var t=new(L());return t.add("title",m("h2",{className:"Hero-title"},[ht()(this.icon)," ",this.title]),50),t},Tt(e,[{key:"classNames",get:function(){return d()({PollPageHero:!0,Hero:!0})}},{key:"wrapperClasses",get:function(){return d()({"PollPageHero--wrapper":!0})}},{key:"title",get:function(){return this.attrs.title||o().translator.trans("fof-polls.forum.polls_page.title")}},{key:"icon",get:function(){return this.attrs.icon||"fas fa-poll"}}])}(V()),qt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.poll=null,o.polls=[],o}P(e,t);var n=e.prototype;return n.view=function(){return m("div",{className:"PollsPage"},this.pageContent().toArray())},n.pageContent=function(){var t=new(L());return t.add("hero",this.hero(),100),t.add("main",m("div",{className:"container"},this.mainContent().toArray()),10),t},n.mainContent=function(){var t=new(L());return t.add("sidebar",this.sidebar(),100),t.add("content",this.content(),10),t},n.content=function(){return m("div",{className:"PollsPage-content sideNavOffset"},this.contentItems().toArray())},n.contentItems=function(){var t=new(L());return this.loading&&t.add("loading",m(Y(),null)),t},n.hero=function(){return m(jt,null)},n.sidebar=function(){return m("nav",{className:"PollsPage-nav IndexPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray())))},n.sidebarItems=function(){var t=et().prototype.sidebarItems();return t.setContent("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){var t=et().prototype.navItems();if(o().initializers.has("flarum-tags"))for(var e in t.remove("separator"),t.remove("moreTags"),t.toObject())e.startsWith("tag")&&"tags"!==e&&t.remove(e);return t},e}(R()),Ft=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;if(t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")){var r=m.route.param("id");this.poll=o().store.getById("poll",r),this.poll||(this.loading=!0,o().store.find("fof/polls",r).then((function(t){n.poll=t,n.loading=!1,o().setTitle(n.poll.question()),m.redraw()})))}else m.route.set("/")},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return this.loading||o.add("poll",m(Mt,{poll:this.poll})),o},e}(qt),Ht=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).subtree=void 0,o.poll=void 0,o.highlightRegExp=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.poll=this.attrs.poll,this.subtree=new(lt())((function(){return n.poll.freshness}),(function(){var t=o().session.user&&o().session.user.markedAllAsReadAt();return t&&t.getTime()}),(function(){return n.active()}))},n.elementAttrs=function(){return{className:d()("PollListItem",{active:this.active(),"PollListItem--hidden":this.poll.isHidden(),Slidable:"ontouchstart"in window})}},n.view=function(){var t=no.controls(this.poll,this).toArray(),o=this.elementAttrs();return m("div",o,this.controlsView(t),this.contentView(),this.slidableUnderneathView())},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.slidableUnderneathView=function(){var t=this.poll.isUnread();return m("span",{className:d()("Slidable-underneath Slidable-underneath--left Slidable-underneath--elastic",{disabled:!t}),onclick:this.markAsRead.bind(this)},ht()("fas fa-check"))},n.contentView=function(){return m("div",{className:d()("PollListItem-content")},this.mainView())},n.mainView=function(){return m(ut(),{href:o().route("fof.polls.view",{id:this.poll.id()}),className:"PollListItem-main"},m("h2",{className:"PollListItem-title"},pt()(this.pollQuestion(this.poll),this.highlightRegExp)),this.poll.subtitle()&&m("p",{className:"PollListItem-subtitle helpText"},this.pollSubtitle(this.poll)),m("ul",{className:"PollListItem-info"},X()(this.infoItems().toArray())))},n.pollQuestion=function(t){return t.question()},n.pollSubtitle=function(t){return t.subtitle()},n.oncreate=function(o){if(t.prototype.oncreate.call(this,o),"ontouchstart"in window){var e=dt()(this.element);this.$(".PollListItem-controls").on("hidden.bs.dropdown",(function(){return e.reset()}))}},n.onbeforeupdate=function(o){return t.prototype.onbeforeupdate.call(this,o),this.subtree.needsRebuild()},n.active=function(){return o().current.matches(Ft,{poll:this.poll})},n.markAsRead=function(){this.poll.isUnread()&&(this.poll.save({lastVotedNumber:this.poll.voteCount()}),m.redraw())},n.infoItems=function(){var t=new(L()),e=!this.poll.hasEnded(),n=this.poll.endDate()?[ht()("fas fa-clock")," ",e?o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.poll.endDate()).fromNow()}):o().translator.trans("fof-polls.forum.poll_ended")]:[ht()("fas fa-infinity")," ",o().translator.trans("fof-polls.forum.poll_never_ends")];t.add("active",m("span",{className:d()("PollListItem-endStatus",{active:e})},n));var r=this.poll.voteCount();return void 0!==r&&t.add("voteCount",m("span",null,ht()("fas fa-poll fa-fw"),[" ",o().translator.trans("fof-polls.forum.polls_count",{count:gt()(r)})]),70),t},e}(V());const Rt=flarum.core.compat["common/components/Placeholder"];var $t=e.n(Rt),zt=function(t){function e(){return t.apply(this,arguments)||this}return P(e,t),e.prototype.view=function(){var t,e=this.attrs.state,n=e.getParams(),r=e.isInitialLoading()||e.isLoadingNext();if(r?t=m(Y(),null):e.hasNext()&&(t=m(S(),{className:"Button",onclick:e.loadNext.bind(e)},o().translator.trans("fof-polls.forum.polls_list.load_more_button"))),e.isEmpty()){var l=o().translator.trans("fof-polls.forum.polls_list.empty_text");return m("div",{className:"PollList"},m($t(),{text:l}))}return m("div",{className:d()("PollList",{"PollList--searchResults":e.isSearchResults()})},m("ul",{"aria-busy":r,className:"PollList-polls"},e.getPages().map((function(t){return t.items.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},m(Ht,{poll:t,params:n}))}))}))),m("div",{className:"PollList-loadMore"},t))},e}(V());const Yt=flarum.core.compat["common/states/PaginatedListState"];var Qt=e.n(Yt);const Wt=flarum.core.compat["common/utils/EventEmitter"];var Jt=e.n(Wt);function Kt(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=Array(o);e<o;e++)n[e]=t[e];return n}var Xt=new(Jt()),Zt=function(t){function e(o,e){var n;return void 0===e&&(e=1),(n=t.call(this,o,e,20)||this).extraPolls=[],n.eventEmitter=void 0,n.eventEmitter=Xt.on("poll.deleted",n.deletePoll.bind(n)),n}P(e,t);var n=e.prototype;return n.requestParams=function(){var t,o={include:this.requestIncludes(),filter:this.params.filter||{},sort:this.sortMap()[null!=(t=this.params.sort)?t:""]};return this.params.q&&(o.filter.q=this.params.q),o},n.includes=function(){return["options","votes"]},n.requestIncludes=function(){var t=this.includes();return[].concat(t,this.params.include||[]).join(",")},n.loadPage=function(e){void 0===e&&(e=1);var n=o().preloadedApiDocument();return n?(this.initialLoading=!1,Promise.resolve(n)):t.prototype.loadPage.call(this,e)},n.clear=function(){t.prototype.clear.call(this),this.extraPolls=[]},n.sortMap=function(){var t={};return this.params.q&&(t.relevance=""),t.newest="-createdAt",t.oldest="createdAt",t},n.isSearchResults=function(){return!!this.params.q},n.removePoll=function(t){this.eventEmitter.emit("poll.deleted",t)},n.deletePoll=function(t){for(var o,e=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return Kt(t,o);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Kt(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.pages);!(o=e()).done;){var n=o.value,r=n.items.indexOf(t);if(-1!==r){n.items.splice(r,1);break}}var l=this.extraPolls.indexOf(t);-1!==l&&this.extraPolls.splice(l,1),m.redraw()},n.addPoll=function(t){this.removePoll(t),this.extraPolls.unshift(t),m.redraw()},n.getAllItems=function(){return this.extraPolls.concat(t.prototype.getAllItems.call(this))},n.getPages=function(){var o=t.prototype.getPages.call(this);return this.extraPolls.length?[{number:-1,items:this.extraPolls}].concat(o):o},Tt(e,[{key:"type",get:function(){return"fof/polls"}}])}(Qt()),to=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")?(this.state=new Zt({sort:m.route.param("sort"),filter:m.route.param("filter")}),this.state.refresh(),o().setTitle(U()(o().translator.trans("fof-polls.forum.page.nav")))):m.route.set("/")},n.view=function(){return this.loading?m(Y(),null):this.poll?m("div",{className:"PollsListPage"},m("div",{className:"container"},m(Mt,{poll:this.poll}))):m("div",{className:"PollsListPage"},t.prototype.hero.call(this),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsListPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray()))),m("div",{className:"PollsPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},X()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},X()(this.actionItems().toArray()))),m(zt,{state:this.state})))))},n.sidebarItems=function(){var t=this,e=new(L()),n=o().forum.attribute("canStartGlobalPolls");return e.add("newGlobalPoll",m(S(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){t.newPollAction()},disabled:!n},o().translator.trans("fof-polls.forum.poll."+(n?"start_poll_button":"cannot_start_poll_button")))),e.add("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),e},n.actionItems=function(){var t=this,e=new(L());return e.add("refresh",S().component({title:o().translator.trans("fof-polls.forum.page.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){t.state.refresh()}})),e},n.viewItems=function(){return et().prototype.viewItems()},n.navItems=function(){return et().prototype.navItems()},n.newPollAction=function(){o().session.user?m.route.set(o().route("fof.polls.composer")):o().modal.show(xt())},e}(qt);const oo=flarum.core.compat["common/components/Separator"];var eo=e.n(oo);const no={controls:function(t,o){var e=this,n=new(L());return["poll","moderation","destructive"].forEach((function(r){var l=e[r+"Controls"](t,o).toArray();l.length&&(l.forEach((function(t){return n.add(t.itemName,t)})),n.add(r+"Separator",m(eo(),null)))})),n},pollControls:function(t,o){return new(L())},moderationControls:function(t,e){var n=new(L());return t.canEdit()&&n.add("edit",m(S(),{icon:"fas fa-pencil-alt",onclick:this.editAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.edit_label"))),n},destructiveControls:function(t,e){var n=new(L());return t.canDelete()&&n.add("delete",m(S(),{icon:"far fa-trash-alt",onclick:this.deleteAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.delete_label"))),n},deleteAction:function(t){var e=this;return b(_().mark((function n(){return _().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm(o().translator.trans("fof-polls.forum.poll_controls.delete_confirmation"))){n.next=2;break}return n.abrupt("return");case 2:return n.abrupt("return",t.delete().then((function(){e.showDeletionAlert(t,"success"),o().current.matches(nt,{id:t.id()})||o().current.matches(to,{id:t.id()})?o().history.back():window.location.reload()})).catch((function(){return e.showDeletionAlert(t,"error")})));case 3:case"end":return n.stop()}}),n)})))()},showDeletionAlert:function(t,e){var n={success:"fof-polls.forum.poll_controls.delete_success_message",error:"fof-polls.forum.poll_controls.delete_error_message"}[e];o().alerts.show({type:e},o().translator.trans(n,{poll:t}))},editAction:function(t){m.route.set(o().route("fof.polls.composer",{id:t.id()}))}};function ro(){return ro=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},ro.apply(null,arguments)}var lo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.uploadedImageUrl=!1,o.fileName=void 0,o.$input=void 0,o}P(e,t);var n=e.prototype;return n.view=function(e){this.attrs.loading=this.loading,this.attrs.className=d()(this.attrs.className,"Button","Button--inverted");var n=this.getImageUrl(),r=o().forum.attribute("canUploadPollImages");return n?(this.attrs.onclick=this.remove.bind(this),m("div",null,m("p",null,m("img",{src:n,alt:""})),m("p",null,t.prototype.view.call(this,ro({},e,{children:o().translator.trans("fof-polls.forum.upload_image.remove_button")}))))):(this.attrs.onclick=this.upload.bind(this),r&&t.prototype.view.call(this,ro({},e,{poll:void 0,children:o().translator.trans("fof-polls.forum.upload_image.upload_button")})))},n.upload=function(){var t=this;this.loading||(this.$input=$('<input type="file">'),this.$input.appendTo("body").hide().trigger("click").on("change",(function(e){var n=new FormData;n.append(t.attrs.name,$(e.target)[0].files[0]),t.loading=!0,m.redraw(),o().request({method:"POST",url:t.resourceUrl(),serialize:function(t){return t},body:n}).then(t.success.bind(t),t.failure.bind(t))})))},n.remove=function(){var t,e,n=this;this.loading=!0,m.redraw();var r=void 0;null!=(t=this.attrs.poll)&&t.exists||null!=(e=this.attrs.option)&&e.exists||(r=this.fileName),o().request({method:"DELETE",url:this.resourceUrl(r)}).then((function(t){var o,e;return null!=(o=n.attrs.poll)&&o.exists&&n.attrs.poll.pushAttributes({image:null,imageUrl:null,isImageUpload:!1}),null!=(e=n.attrs.option)&&e.exists&&n.attrs.option.pushAttributes({imageUrl:!1}),t})).then(this.success.bind(this),this.failure.bind(this))},n.resourceUrl=function(t){void 0===t&&(t=void 0);var e=o().forum.attribute("apiUrl")+"/fof/polls/"+this.attrs.name,n=this.attrs.poll,r=this.attrs.option;return t?e+="/name/"+t:(null!=n&&n.exists&&(e+="/"+(null==n?void 0:n.id())),null!=r&&r.exists&&(e+="/"+(null==r?void 0:r.id()))),e},n.getImageUrl=function(){var t,o;return!1!==this.uploadedImageUrl?this.uploadedImageUrl:(null==(t=this.attrs.poll)?void 0:t.imageUrl())||(null==(o=this.attrs.option)?void 0:o.imageUrl())},n.success=function(t){var o,e,n;this.loading=!1,this.uploadedImageUrl=null==t?void 0:t.fileUrl,this.fileName=null==t?void 0:t.fileName,null==(o=(e=this.attrs).onUpload)||o.call(e,null==t?void 0:t.fileName),m.redraw(),null==(n=this.$input)||n.remove()},n.failure=function(t){var o;this.loading=!1,m.redraw(),null==(o=this.$input)||o.remove()},e}(S());const ao=flarum.core.compat["common/utils/RequestError"];var so=e.n(ao),io=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).options=[],o.optionAnswers=[],o.optionImageUrls=[],o.question=void 0,o.subtitle=void 0,o.image=void 0,o.imageAlt=void 0,o.endDate=void 0,o.publicPoll=void 0,o.allowMultipleVotes=void 0,o.hideVotes=void 0,o.allowChangeVote=void 0,o.maxVotes=void 0,o.datepickerMinDate="",o}P(e,t);var n=e.prototype;return n.oninit=function(o){var e;t.prototype.oninit.call(this,o),this.state=new F(this.attrs.poll);var n=this.state.poll;this.options=null!=(e=n.tempOptions)?e:n.options(),this.optionAnswers=this.options.map((function(t){return M()(t.answer())})),this.optionImageUrls=this.options.map((function(t){return M()(t.imageUrl())})),this.question=M()(n.question()),this.subtitle=M()(n.subtitle()),this.image=M()(n.image()),this.imageAlt=M()(n.imageAlt()),this.endDate=M()(this.formatDate(n.endDate())),this.publicPoll=M()(n.publicPoll()),this.allowMultipleVotes=M()(n.allowMultipleVotes()),this.hideVotes=M()(n.hideVotes()),this.allowChangeVote=M()(n.allowChangeVote()),this.maxVotes=M()(n.maxVotes()||0),this.datepickerMinDate=this.formatDate(),this.endDate()&&dayjs(n.endDate).isAfter(dayjs())&&(this.datepickerMinDate=this.formatDate(n.endDate()))},n.view=function(){return m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"PollDiscussionModal-form"},this.fields().toArray()))},n.fields=function(){var t,e=new(L());e.add("question",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.question_placeholder")),m("input",{type:"text",name:"question",className:"FormControl",bidi:this.question})),100),e.add("subtitle",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.subtitle_placeholder")),m("input",{type:"text",name:"subtitle",className:"FormControl",bidi:this.subtitle})),95);var n=this.image();return e.add("poll_image",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.poll_image.label")),this.uploadConditional(n,null==(t=this.state.poll)?void 0:t.isImageUpload(),m("[",null,m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_image.help")),m("input",{type:"hidden",name:"pollImage",bidi:this.image})),m(lo,{name:"pollImage",poll:this.state.poll,onUpload:this.pollImageUploadSuccess.bind(this)}),m("input",{type:"text",name:"pollImage",className:"FormControl",bidi:this.image,placeholder:o().translator.trans("fof-polls.forum.modal.image_option_placeholder")}))),90),n&&e.add("poll_image_alt",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.poll_image.alt_label")),m("input",{type:"text",required:!0,name:"imageAlt",className:"FormControl",bidi:this.imageAlt}),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_image.alt_help_text"))),90),e.add("answers",m("div",{className:"PollModal--answers Form-group"},m("label",{className:"label PollModal--answers-title"},m("span",null,o().translator.trans("fof-polls.forum.modal.options_label"))),this.displayOptions().toArray(),m(bt(),{text:o().translator.trans("fof-polls.forum.modal.tooltip.options.add-button")},m(S(),{className:"Button PollModal--button Button--icon PollModal--add-button",icon:"fas fa-plus",onclick:this.addOption.bind(this)}))),80),e.add("date",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.date_placeholder")),m("div",{className:"PollModal--date"},m("input",{className:"FormControl",type:"datetime-local",name:"date",bidi:this.endDate,min:this.datepickerMinDate,max:this.formatDate("2038")}),S().component({className:"Button PollModal--button Button--icon",icon:"fas fa-times",onclick:this.endDate.bind(this,null)})),this.endDate()&&m("p",{className:"helpText"},m("i",{class:"icon fas fa-clock"}),"",dayjs(this.endDate()).isBefore(dayjs())?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.endDate()).fromNow()}))),40),e.add("public",m("div",{className:"Form-group"},k().component({state:this.publicPoll()||!1,onchange:this.publicPoll},o().translator.trans("fof-polls.forum.modal.public_poll_label"))),20),e.add("hide-votes",m("div",{className:"Form-group"},m(k(),{state:this.endDate()&&this.hideVotes(),onchange:this.hideVotes,disabled:!this.endDate()},o().translator.trans("fof-polls.forum.modal.hide_votes_label")),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.hide_votes_label_help"))),20),e.add("allow-change-vote",m("div",{className:"Form-group"},m(k(),{state:this.allowChangeVote(),onchange:this.allowChangeVote},o().translator.trans("fof-polls.forum.modal.allow_change_vote_label"))),20),e.add("allow-multiple-votes",m("div",{className:"Form-group"},k().component({state:this.allowMultipleVotes()||!1,onchange:this.allowMultipleVotes},o().translator.trans("fof-polls.forum.modal.allow_multiple_votes_label"))),15),this.allowMultipleVotes()&&e.add("max-votes",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.max_votes_label")),m("input",{type:"number",min:"0",max:this.options.length,name:"maxVotes",className:"FormControl",bidi:this.maxVotes}),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.max_votes_help"))),15),e.add("submit",m("div",{className:"Form-group"},m(S(),{type:"submit",className:"Button Button--primary PollModal-SubmitButton",icon:"fas fa-save",loading:this.state.loading},o().translator.trans("fof-polls.forum.modal.submit")),this.state.poll.exists&&m(S(),{className:"Button Button--secondary PollModal-deleteButton",icon:"fas fa-trash-alt",loading:this.state.deleting,onclick:this.delete.bind(this)},o().translator.trans("fof-polls.forum.modal.delete"))),-10),e},n.displayOptions=function(){var t=this,e=new(L());return o().forum.attribute("canUploadPollImages"),this.options.forEach((function(n,r){var l=t.optionImageUrls[r];e.add("option-"+r,m("div",{className:"Form-group"},m("fieldset",{className:"Poll-answer-input"},m("input",{className:"FormControl",type:"text",name:"answer"+(r+1),bidi:t.optionAnswers[r],placeholder:o().translator.trans("fof-polls.forum.modal.option_placeholder")+" #"+(r+1)}),o().forum.attribute("allowPollOptionImage")&&m("div",{className:"Poll-answer-image"},t.uploadConditional(!!l(),null==n?void 0:n.isImageUpload(),m("[",null,m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.poll_option_image.label")),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_option_image.help")),m("input",{type:"hidden",name:"answerImage"+(r+1),value:l()})),m(lo,{name:"pollOptionImage",option:n,onUpload:t.pollOptionImageUploadSuccess.bind(t,r)}),m("input",{type:"text",name:"answerImage"+(r+1),className:"FormControl",bidi:l,placeholder:o().translator.trans("fof-polls.forum.modal.image_option_placeholder")})))),r>=2?S().component({type:"button",className:"Button PollModal--button Button--icon",icon:"fas fa-minus",onclick:r>=2?t.removeOption.bind(t,r):""}):""))})),e},n.addOption=function(){var t=Math.max(o().forum.attribute("pollMaxOptions"),2);this.options.length<t?(this.options.push(o().store.createRecord("poll_options")),this.optionAnswers.push(M()("")),this.optionImageUrls.push(M()(""))):alert(U()(o().translator.trans("fof-polls.forum.modal.max",{max:t})))},n.removeOption=function(t){this.options.splice(t,1),this.optionAnswers.splice(t,1),this.optionImageUrls.splice(t,1)},n.data=function(){var t,e=this;if(""===this.question())throw new q(o().translator.trans("fof-polls.forum.modal.include_question"));if(this.options.length<2)throw new q(o().translator.trans("fof-polls.forum.modal.min"));var n=this.state.poll.exists,r=this.options.map((function(t,o){return t.pushAttributes({answer:e.optionAnswers[o](),imageUrl:e.optionImageUrls[o]()}),n?t.data:t.data.attributes}));return{question:this.question(),subtitle:this.subtitle(),pollImage:this.image(),imageAlt:this.imageAlt(),endDate:null!=(t=this.dateToTimestamp(this.endDate()))&&t,publicPoll:this.publicPoll(),hideVotes:this.hideVotes(),allowChangeVote:this.allowChangeVote(),allowMultipleVotes:this.allowMultipleVotes(),maxVotes:this.maxVotes(),options:r}},n.onsubmit=function(){var t=b(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,this.attrs.onsubmit(this.data(),this.state);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),t.t0 instanceof q?o().alerts.show({type:"error"},t.t0.message):t.t0 instanceof so()&&(console.error(t.t0),o().alerts.show({type:"error"},o().translator.trans("fof-polls.forum.modal.error")));case 9:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(o){return t.apply(this,arguments)}}(),n.delete=function(){var t=b(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.state.loading=!0,t.prev=1,t.next=4,no.deleteAction(this.state.poll);case 4:this.state.deleting=!0;case 5:return t.prev=5,this.state.loading=!1,m.redraw(),t.finish(5);case 9:case"end":return t.stop()}}),t,this,[[1,,5,9]])})));return function(){return t.apply(this,arguments)}}(),n.formatDate=function(t,o){void 0===t&&(t=void 0),void 0===o&&(o=!1);var e=dayjs(t);return!1!==t&&e.isValid()?e.format("YYYY-MM-DDTHH:mm"):!1!==o&&this.formatDate(o)},n.dateToTimestamp=function(t){var o=dayjs(t);return t&&o.isValid()?o.format():null},n.pollImageUploadSuccess=function(t){this.image(t)},n.pollOptionImageUploadSuccess=function(t,o){this.optionImageUrls[t]=M()(o)},n.uploadConditional=function(t,e,n,r,l){var a,s=o().forum.attribute("canUploadPollImages"),i=(null==(a=this.state.poll)?void 0:a.exists)||o().forum.attribute("canStartPolls")&&o().forum.attribute("canStartGlobalPolls");return s||e?i||e?m("[",null,n,m("div",{class:"Poll-image-inputs"},!t&&l,r)):m("[",null,l,m("p",{class:"helpText"},o().translator.trans("fof-polls.forum.modal.poll_image.later_help"))):l},e}(V()),uo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.add_title")},n.className=function(){return"PollDiscussionModal Modal--medium"},n.content=function(){return[m("div",{className:"Modal-body"},m(io,{poll:this.attrs.poll,onsubmit:this.onFormSubmit.bind(this)}))]},n.onFormSubmit=function(){var t=b(_().mark((function t(o,e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.hide(),t.next=3,this.attrs.onsubmit(o);case 3:case"end":return t.stop()}}),t,this)})));return function(o,e){return t.apply(this,arguments)}}(),e}(I());function co(t){if(t){var e=o().store.createRecord("polls");return e.tempOptions=t.options.map((function(t){var e=o().store.createRecord("poll_options");return e.pushAttributes(t),e})),e.pushAttributes(t),e}return t}var po=function(t){t.prototype.addPoll=function(){var t=this;o().modal.show(uo,{poll:co(this.composer.fields.poll),onsubmit:function(o){return t.composer.fields.poll=o}})},(0,r.extend)(t.prototype,"headerItems",(function(t){var e,n,r=null==(e=this.composer.body)||null==(e=e.attrs)?void 0:e.discussion;(null!=(n=null==r?void 0:r.canStartPoll())?n:o().forum.canStartPolls())&&t.add("polls",m("a",{className:"ComposerBody-poll",onclick:this.addPoll.bind(this)},m("span",{className:d()("PollLabel",!this.composer.fields.poll&&"none")},o().translator.trans("fof-polls.forum.composer_discussion."+(this.composer.fields.poll?"edit":"add")+"_poll"))),1)})),(0,r.extend)(t.prototype,"data",(function(t){this.composer.fields.poll&&(t.poll=this.composer.fields.poll)}))};const mo=flarum.core.compat["forum/components/CommentPost"];var fo=e.n(mo);const ho=flarum.core.compat["forum/components/DiscussionPage"];var vo=e.n(ho),go=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.edit_title")},n.onFormSubmit=function(){var t=b(_().mark((function t(e,n){var r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.save(e);case 2:r=o().alerts.show({type:"success"},o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(r)}),1e4);case 4:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),e}(uo),yo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loadingOptions=!1,o.useSubmitUI=void 0,o.pendingSubmit=!1,o.pendingOptions=void 0,o.updateVisibility=function(){},o}P(e,t);var n=e.prototype;return n.oninit=function(o){var e,n;t.prototype.oninit.call(this,o),this.useSubmitUI=!(null!=(e=this.attrs.poll)&&e.canChangeVote())&&(null==(n=this.attrs.poll)?void 0:n.allowMultipleVotes()),this.pendingOptions=null},n.oncreate=function(o){t.prototype.oncreate.call(this,o),this.preventClose=this.preventClose.bind(this),window.addEventListener("beforeunload",this.preventClose)},n.onremove=function(o){t.prototype.onremove.call(this,o),window.removeEventListener("beforeunload",this.preventClose)},n.view=function(){var t=this.attrs.poll,e=t.options()||[],n=t.allowMultipleVotes()?t.maxVotes():1;0===n&&(n=e.length);var r=this.infoItems(n);return m("div",{className:"Post-poll","data-id":t.id()},m("div",{className:"PollHeading"},m("div",{className:"PollHeading-title-container"},m("h3",{className:"PollHeading-title"},t.question()),t.subtitle()&&m("p",{className:"helpText PollHeading-subtitle"},t.subtitle())),m("div",{className:"PollHeading-actions"},t.canSeeVoters()&&m(bt(),{text:o().translator.trans("fof-polls.forum.public_poll")},m(S(),{className:"Button PollHeading-voters",onclick:this.showVoters.bind(this),icon:"fas fa-poll"})),t.canEdit()&&m(bt(),{text:o().translator.trans("fof-polls.forum.moderation.edit")},m(S(),{className:"Button PollHeading-edit",onclick:o().modal.show.bind(o().modal,go,{poll:t}),icon:"fas fa-pen"})),t.canDelete()&&m(bt(),{text:o().translator.trans("fof-polls.forum.moderation.delete")},m(S(),{className:"Button PollHeading-delete",onclick:this.deletePoll.bind(this),icon:"fas fa-trash"})))),!!t.imageUrl()&&m(Nt,{poll:t}),m("div",null,m("div",{className:"PollOptions"},e.map(this.viewOption.bind(this))),m("div",{className:"Poll-sticky"},!r.isEmpty()&&m("div",{className:"helpText PollInfoText"},r.toArray()),this.useSubmitUI&&this.pendingSubmit&&m(S(),{className:"Button Button--primary Poll-submit",loading:this.loadingOptions,onclick:this.onsubmit.bind(this)},o().translator.trans("fof-polls.forum.poll.submit_button")))))},n.infoItems=function(t){var e,n=new(L()),r=this.attrs.poll,l=(null==(e=r.myVotes())?void 0:e.length)>0;return!o().session.user||r.canVote()||r.hasEnded()||n.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),r.endDate()&&n.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),r.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(r.endDate()).fromNow()}))),r.canVote()&&(n.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),r.canChangeVote()||n.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(l?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),n},n.viewOption=function(t){var e,n,r,l=this.attrs.poll,a=(null==(e=l.myVotes())?void 0:e.length)>0,s=l.voteCount(),i=this.pendingOptions?this.pendingOptions.has(t.id()):null==(n=l.myVotes())||null==n.some?void 0:n.some((function(o){return o.option()===t})),u=t.voteCount(),c=s>0?Math.round(u/s*100):0,p="number"==typeof u,f=this.loadingOptions||a&&!l.canChangeVote(),h=p?c:Number(i)/((null==(r=l.myVotes())?void 0:r.length)||1)*100,v=!o().session.user||!l.hasEnded()&&l.canVote()&&(!a||l.canChangeVote()),g=m("div",{className:"PollBar","data-selected":!!i,style:"--poll-option-width: "+h+"%"},v&&m("label",{className:"PollAnswer-checkbox"},m("input",{onchange:this.changeVote.bind(this,t),type:"checkbox",checked:i,disabled:f}),m("span",{className:"checkmark"})),m("div",{className:"PollAnswer-text"},m("span",{className:"PollAnswer-text-answer"},t.answer()),i&&!v&&ht()("fas fa-check-circle",{className:"PollAnswer-check"}),p&&m("span",{className:d()("PollPercent",100!==c&&"PollPercent--option")},c,"%")),t.imageUrl()?m("img",{className:"PollAnswer-image",src:t.imageUrl(),alt:t.answer(),loading:"lazy"}):null);return m("div",{className:d()("PollOption",a&&"PollVoted",l.hasEnded()&&"PollEnded",t.imageUrl()&&"PollOption-hasImage"),"data-id":t.id()},p?m(bt(),{text:o().translator.trans("fof-polls.forum.tooltip.votes",{count:u}),onremove:this.hideOptionTooltip},g):g)},n.changeVote=function(t,e){var n,r;if(!o().session.user)return o().modal.show(xt()),void(e.target instanceof HTMLInputElement&&(e.target.checked=!1));var l=this.pendingOptions||new Set(null==(n=(r=this.attrs.poll.myVotes()).map)?void 0:n.call(r,(function(t){var o;return null==(o=t.option())?void 0:o.id()}))),a=l.delete(t.id());return this.attrs.poll.allowMultipleVotes()||l.clear(),a||l.add(t.id()),this.useSubmitUI?(this.pendingOptions=l.size?l:null,void(this.pendingSubmit=!!this.pendingOptions)):this.submit(l,null,(function(){e.target instanceof HTMLInputElement&&(e.target.checked=a)}))},n.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}),null)},n.submit=function(){var t=b(_().mark((function t(e,n,r){var l;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingOptions=!0,m.redraw(),t.prev=2,t.prev=3,t.next=6,o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.attrs.poll.id()+"/votes",body:{data:{optionIds:Array.from(e)}}});case 6:l=t.sent,o().store.pushPayload(l),null==n||n(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),null==r||r(t.t0);case 14:return t.prev=14,this.loadingOptions=!1,m.redraw(),t.finish(14);case 18:case"end":return t.stop()}}),t,this,[[2,,14,18],[3,11]])})));return function(o,e,n){return t.apply(this,arguments)}}(),n.showVoters=function(){o().modal.show(St,{poll:this.attrs.poll,post:this.attrs.post})},n.deletePoll=function(){confirm(U()(o().translator.trans("fof-polls.forum.moderation.delete_confirm")))&&this.attrs.poll.delete().then((function(){m.redraw.sync()}))},n.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},n.preventClose=function(t){if(this.pendingOptions)return t.preventDefault(),!0},e}(V());function bo(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=Array(o);e<o;e++)n[e]=t[e];return n}const wo=flarum.core.compat["forum/utils/PostControls"];var Po=e.n(wo),No=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=void 0,o}P(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.poll=this.attrs.poll},e.view=function(){return m("div",{className:"PollShowcase--item"},m(Mt,{poll:this.poll}))},o}(V()),_o=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.attrs.state.refresh()},n.view=function(){return m("div",{className:"PollShowcase"},m("div",{className:"PollShowcase--active"},m("h2",{className:"PollShowcase-title PollShowcase-title--active"},o().translator.trans("fof-polls.forum.showcase.active-polls")),this.showcaseItems().toArray(),0===this.showcaseItems().toArray().length&&m($t(),{text:o().translator.trans("fof-polls.forum.showcase.no-active-polls")})),m("div",{className:"PollShowcase--ended"},m("h2",{className:"PollShowcase-title PollShowcase-title--ended"},o().translator.trans("fof-polls.forum.showcase.ended-polls")),this.endedItems().toArray(),0===this.endedItems().toArray().length&&m($t(),{text:o().translator.trans("fof-polls.forum.showcase.no-recent-polls")})))},n.showcaseItems=function(){var t=new(L());return this.attrs.state.getPages().map((function(o){o.items.map((function(o){o.hasEnded()||t.add("poll-active-"+o.id(),m(No,{poll:o}))}))})),t},n.endedItems=function(){var t=new(L());return this.attrs.state.getPages().map((function(o){o.items.map((function(o){o.hasEnded()&&t.add("poll-ended-"+o.id(),m(No,{poll:o}))}))})),t},e}(V()),xo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),o().forum.attribute("globalPollsEnabled")?(this.state=new Zt({sort:m.route.param("sort"),filter:m.route.param("filter"),include:this.includeParams()}),this.state.refresh(),o().setTitle(U()(o().translator.trans("fof-polls.forum.page.nav")))):m.route.set("/")},n.includeParams=function(){return["options","votes","myVotes","myVotes.option"]},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return this.loading||o.add("poll-showcase",m(_o,{state:this.state})),o},n.sidebarItems=function(){var e=this,n=t.prototype.sidebarItems.call(this),r=o().forum.attribute("canStartGlobalPolls");return n.remove("newDiscussion"),r&&n.add("newGlobalPoll",m(S(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){e.newPollAction()},disabled:!r},o().translator.trans("fof-polls.forum.poll."+(r?"start_poll_button":"cannot_start_poll_button"))),100),n},n.newPollAction=function(){o().session.user?m.route.set(o().route("fof.polls.composer")):o().modal.show(xt())},e}(qt),Io=function(){function t(o){this.pollGroup=void 0,this.loading=void 0,this.deleting=void 0,o||(o=t.createNewPollGroup()),this.loading=!1,this.deleting=!1,this.pollGroup=o}t.createNewPollGroup=function(){var t=o().store.createRecord("poll_groups");return t.pushAttributes({name:""}),t};var e=t.prototype;return e.save=function(){var t=b(_().mark((function t(o){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.pollGroup.save(o);case 5:this.pollGroup=t.sent;case 6:return t.prev=6,this.loading=!1,m.redraw(),t.finish(6);case 10:case"end":return t.stop()}}),t,this,[[2,,6,10]])})));return function(o){return t.apply(this,arguments)}}(),e.delete=function(){var t=b(_().mark((function t(){var e,n=this;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm(o().translator.trans("fof-polls.forum.poll_groups.controls.delete_confirmation"))){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,m.redraw(),e=this.pollGroup,t.prev=5,t.next=8,e.delete().then((function(){n.deleting=!0,So.showDeletionAlert(e,"success")})).catch((function(){return So.showDeletionAlert(e,"error")}));case 8:return t.prev=8,this.loading=!1,m.redraw(),t.finish(8);case 12:case"end":return t.stop()}}),t,this,[[5,,8,12]])})));return function(){return t.apply(this,arguments)}}(),t}(),Ao=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).name=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new Io(this.attrs.pollGroup),this.name=M()(this.state.pollGroup.name()||"")},n.view=function(){return m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"PollGroupModal-form"},this.fields().toArray()))},n.fields=function(){var t=this,e=new(L());if(e.add("name",m("div",{className:"Form-group"},m("label",{className:"label"},"Name"),m("input",{type:"text",name:"name",className:"FormControl",bidi:this.name,required:!0})),100),e.add("submit",m("div",{className:"Form-group"},m(S(),{type:"submit",className:"Button Button--primary PollGroupModal-SubmitButton",icon:"fas fa-save",loading:this.state.loading},o().translator.trans("fof-polls.forum.poll_groups.composer.save_changes")),this.state.pollGroup.exists&&m(S(),{className:"Button Button--secondary PollGroupModal-deleteButton",icon:"fas fa-trash-alt",loading:this.state.deleting,onclick:this.delete.bind(this)},o().translator.trans("fof-polls.forum.poll_groups.composer.delete")))),this.state.pollGroup.exists){var n=this.pollItems().toArray();n.length>0&&e.add("polls",m("div",{className:"PollList"},m("ul",{className:"PollList-polls PollGroup-polls"},n))),e.add("addPoll",m("div",{className:"Form-group"},m(S(),{className:"Button Button--primary PollGroupModal-addPollButton",icon:"fas fa-plus",onclick:function(){return So.addPoll(t.state.pollGroup)}},o().translator.trans("fof-polls.forum.poll_groups.controls.add_poll_label"))))}return e},n.pollItems=function(){var t=this.state.pollGroup.polls(),o=new(L());return t&&0!==t.length?(t.forEach((function(t){t&&o.add("poll-"+t.id(),m("li",{key:t.id(),className:"PollGroup-poll"},m(Ht,{poll:t})))})),o):o},n.data=function(){if(!this.name())throw new q("Name cannot be empty");return{name:this.name()}},n.onsubmit=function(){var t=b(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,this.attrs.onsubmit(this.data(),this.state);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),t.t0 instanceof q?o().alerts.show({type:"error"},t.t0.message):(console.error(t.t0),o().alerts.show({type:"error"},"An error occurred while saving the poll group"));case 9:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(o){return t.apply(this,arguments)}}(),n.delete=function(){var t=b(_().mark((function t(){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.state.delete();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(V()),Vo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).pollGroup=void 0,o}P(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.pollGroup=this.attrs.pollGroup},n.view=function(){return m("div",{className:"ComposePollGroupHero Hero"},m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h2",{className:"Hero-title"},o().translator.trans("fof-polls.forum.poll_groups.composer."+(this.pollGroup.id()?"edit":"add")+"_title")),m("div",{className:"ComposePollGroupHero-controls"},this.controlItems().toArray()))))},n.controlItems=function(){var t=new(L());return t.add("groups",m(W(),{icon:"fas fa-layer-group",className:"Button Button--secondary PollGroupListLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.groups.list")},o().translator.trans("fof-polls.forum.poll_groups.composer.groups_manager"))),this.pollGroup.exists&&t.add("view",m(W(),{icon:"far fa-arrow-up-right-from-square",className:"Button Button--secondary PollGroupPreviewLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.groups.view",{id:this.pollGroup.id()})},o().translator.trans("fof-polls.forum.poll_groups.composer.view_group"))),t},e}(V()),Co=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).pollGroup=null,o.loading=!1,o}P(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;if(t.prototype.oninit.call(this,e),o().forum.attribute("pollGroupsEnabled")&&o().forum.attribute("canStartPollGroup")){this.bodyClass="App--compose-poll-group";var r=m.route.param("id");(r?this.loadEditingPollGroup(r):Promise.resolve(Io.createNewPollGroup())).then((function(t){var e,r;n.pollGroup=t,null==t||!t.exists||t.canEdit()?(o().history.push("compose-poll-group",o().translator.trans("fof-polls.forum.poll_groups.composer."+(null!=(e=n.pollGroup)&&e.id()?"edit":"add")+"_title")),o().setTitle(o().translator.trans("fof-polls.forum.poll_groups.composer."+(null!=(r=n.pollGroup)&&r.id()?"edit":"add")+"_title")),m.redraw()):m.route.set("/")}))}else m.route.set("/")},n.loadEditingPollGroup=function(){var t=b(_().mark((function t(e){var n,r;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=o().store.getById("poll_groups",e))){t.next=3;break}return t.abrupt("return",n);case 3:return this.loading=!0,t.next=6,o().store.find("fof/polls/groups",e);case 6:return r=t.sent,this.loading=!1,t.abrupt("return",r);case 9:case"end":return t.stop()}}),t,this)})));return function(o){return t.apply(this,arguments)}}(),n.view=function(){return this.loading||!this.pollGroup?m(Y(),null):m("div",{className:"ComposePollGroupPage"},m(Vo,{pollGroup:this.pollGroup}),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset"},m(Ao,{pollGroup:this.pollGroup,onsubmit:this.onsubmit.bind(this)})))))},n.onsubmit=function(){var t=b(_().mark((function t(e,n){var r,l,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===n.pollGroup.id(),t.next=3,n.save(e);case 3:l=r?{type:"success",controls:[m(S(),{className:"Button Button--link",onclick:function(){return m.route.set(o().route("fof.polls.groups.composer",{id:n.pollGroup.id()}))}},o().translator.trans("fof-polls.forum.compose.continue_editing"))]}:{type:"success"},a=o().alerts.show(l,o().translator.trans("fof-polls.forum.poll_groups.composer.success")),setTimeout((function(){return o().alerts.dismiss(a)}),1e4),r&&m.route.set(o().route("fof.polls.groups.list"));case 7:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),n.sidebarItems=function(){var t=new(L());return t.add("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){return et().prototype.navItems()},e}(R());const So={controls:function(t,o){var e=this,n=new(L());return["moderation","destructive"].forEach((function(r){var l=e[r+"Controls"](t,o).toArray();l.length&&(l.forEach((function(t){return n.add(t.itemName,t)})),n.add(r+"Separator",m(eo(),null)))})),n},moderationControls:function(t,e){var n=new(L());return t.canEdit()&&(n.add("edit",m(S(),{icon:"fas fa-pencil-alt",onclick:this.editAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_groups.controls.edit_label"))),n.add("addPoll",m(S(),{icon:"fas fa-plus",onclick:this.addPoll.bind(this,t)},o().translator.trans("fof-polls.forum.poll_groups.controls.add_poll_label"))),n.add("view",m(S(),{icon:"far fa-arrow-up-right-from-square",onclick:function(){return m.route.set(o().route("fof.polls.groups.view",{id:t.id()}))}},o().translator.trans("fof-polls.forum.poll_groups.controls.view_label")))),n},destructiveControls:function(t,e){var n=new(L());return t.canDelete()&&n.add("delete",m(S(),{icon:"far fa-trash-alt",onclick:this.deleteAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_groups.controls.delete_label"))),n},deleteAction:function(t){var e=this;return b(_().mark((function n(){return _().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm(o().translator.trans("fof-polls.forum.poll_groups.controls.delete_confirmation"))){n.next=2;break}return n.abrupt("return");case 2:return n.abrupt("return",t.delete().then((function(){e.showDeletionAlert(t,"success"),o().current.matches(Co,{id:t.id()})?o().history.back():window.location.reload()})).catch((function(){return e.showDeletionAlert(t,"error")})));case 3:case"end":return n.stop()}}),n)})))()},showDeletionAlert:function(t,e){var n={success:"fof-polls.forum.poll_groups.controls.delete_success_message",error:"fof-polls.forum.poll_groups.controls.delete_error_message"}[e];o().alerts.show({type:e},o().translator.trans(n,{pollGroup:t}))},editAction:function(t){m.route.set(o().route("fof.polls.groups.composer",{id:t.id()}))},addPoll:function(t){o().modal.show(uo,{onsubmit:function(e){o().store.createRecord("polls").save(ro({},e,{relationships:{pollGroup:t}}),{data:{include:"options,myVotes,myVotes.option"}}).then((function(o){var e;null==(e=t.rawRelationship("polls"))||null==e.push||e.push({type:"polls",id:o.id()}),m.redraw()}))}})}};var Go=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.pollItems=function(){var t=this,o=this.attrs.pollGroup.polls(),e=new(L());return o&&0!==o.length?(o.forEach((function(o){o&&e.add("poll-"+o.id(),m("li",{key:o.id(),className:"PollGroup-poll"},t.attrs.compactView?m(Ht,{poll:o}):m(No,{poll:o})))})),e):e},n.mainItems=function(){var t=new(L()),o=this.attrs.pollGroup;return t.add("title",m("h3",{className:"PollGroupListItem-title"},o.name())),t.add("controls",this.controlsView(So.controls(o,this).toArray())),t},n.view=function(){var t=this.pollItems().toArray();return m("div",{className:d()("PollGroupListItem","PollGroupListItem--pollgroup")},m("div",{className:"PollGroupListItem-main"},this.mainItems().toArray()),m("ul",{className:"PollGroupListItem-polls"},t.length>0?t:m("span",null,o().translator.trans("fof-polls.forum.poll_groups.list_page.no_polls"))))},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollGroupListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},e}(V()),ko=function(t){function e(){return t.apply(this,arguments)||this}return P(e,t),e.prototype.view=function(){var t,e=this.attrs.state,n=e.getParams(),r=e.isInitialLoading()||e.isLoadingNext();if(r?t=m(Y(),null):e.hasNext()&&(t=m(S(),{className:"Button",onclick:e.loadNext.bind(e)},o().translator.trans("fof-polls.forum.poll_groups.list_page.load_more_button"))),e.isEmpty()){var l=o().translator.trans("fof-polls.forum.poll_groups.list_page.empty_text");return m("div",{className:"PollGroupList"},m($t(),{text:l}))}return m("div",{className:d()("PollGroupList",{"PollGroupList--searchResults":e.isSearchResults()})},m("ul",{"aria-busy":r,className:"PollGroupList-pollgroups"},e.getPages().map((function(t){return t.items.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},m(Go,{pollGroup:t,params:n,compactView:!0}))}))}))),m("div",{className:"PollGroupList-loadMore"},t))},e}(V()),Oo=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.pollGroup=null,o.pollGroups=[],o}P(e,t);var n=e.prototype;return n.view=function(){return m("div",{className:"PollGroupsPage"},this.pageContent().toArray())},n.pageContent=function(){var t=new(L());return t.add("hero",this.hero(),100),t.add("main",m("div",{className:"container"},this.mainContent().toArray()),10),t},n.mainContent=function(){var t=new(L());return t.add("sidebar",this.sidebar(),100),t.add("content",this.content(),10),t},n.content=function(){return m("div",{className:"PollGroupsPage-content sideNavOffset"},this.contentItems().toArray())},n.contentItems=function(){var t=new(L());return this.loading&&t.add("loading",m(Y(),null)),t},n.hero=function(){return m(jt,{title:o().translator.trans("fof-polls.forum.poll_groups.list_page.title"),icon:"fas fa-layer-group"})},n.sidebar=function(){return m("nav",{className:"PollGroupsPage-nav IndexPage-nav sideNav"},m("ul",null,X()(this.sidebarItems().toArray())))},n.sidebarItems=function(){var t=this,e=et().prototype.sidebarItems(),n=o().forum.attribute("canStartGlobalPolls");return e.setContent("nav",m(tt(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),e.remove("newDiscussion"),n&&e.add("newPollGroup",m(S(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){t.newPollGroupAction()},disabled:!n},o().translator.trans("fof-polls.forum.poll_groups.list_page."+(n?"start_poll_group_button":"cannot_start_poll_group_button"))),100),e},n.navItems=function(){var t=et().prototype.navItems();if(o().initializers.has("flarum-tags"))for(var e in t.remove("separator"),t.remove("moreTags"),t.toObject())e.startsWith("tag")&&"tags"!==e&&t.remove(e);return t},n.newPollGroupAction=function(){o().session.user?m.route.set(o().route("fof.polls.groups.composer")):o().modal.show(xt())},e}(R());function Lo(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=Array(o);e<o;e++)n[e]=t[e];return n}var Eo=new(Jt()),Mo=function(t){function e(o,e){var n;return void 0===e&&(e=1),(n=t.call(this,o,e,20)||this).extraGroups=[],n.eventEmitter=void 0,n.eventEmitter=Eo.on("pollgroup.deleted",n.deletePollGroup.bind(n)),n}P(e,t);var n=e.prototype;return n.requestParams=function(){var t,o={include:this.requestIncludes(),filter:this.params.filter||{},sort:this.sortMap()[null!=(t=this.params.sort)?t:""]};return this.params.q&&(o.filter.q=this.params.q),o},n.includes=function(){return["polls"]},n.requestIncludes=function(){var t=this.includes();return[].concat(t,this.params.include||[]).join(",")},n.loadPage=function(e){void 0===e&&(e=1);var n=o().preloadedApiDocument();return n?(this.initialLoading=!1,Promise.resolve(n)):t.prototype.loadPage.call(this,e)},n.clear=function(){t.prototype.clear.call(this),this.extraGroups=[]},n.sortMap=function(){var t={};return this.params.q&&(t.relevance=""),t.newest="-createdAt",t.oldest="createdAt",t},n.isSearchResults=function(){return!!this.params.q},n.removePollGroup=function(t){this.eventEmitter.emit("pollgroup.deleted",t)},n.deletePollGroup=function(t){for(var o,e=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return Lo(t,o);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Lo(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.pages);!(o=e()).done;){var n=o.value,r=n.items.indexOf(t);if(-1!==r){n.items.splice(r,1);break}}var l=this.extraGroups.indexOf(t);-1!==l&&this.extraGroups.splice(l,1),m.redraw()},n.addPollGroup=function(t){this.removePollGroup(t),this.extraGroups.unshift(t),m.redraw()},n.getAllItems=function(){return this.extraGroups.concat(t.prototype.getAllItems.call(this))},n.getPages=function(){var o=t.prototype.getPages.call(this);return this.extraGroups.length?[{number:-1,items:this.extraGroups}].concat(o):o},Tt(e,[{key:"type",get:function(){return"fof/polls/groups"}}])}(Qt()),Bo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),o().forum.attribute("canViewPollGroups")?(this.state=new Mo({sort:m.route.param("sort"),filter:m.route.param("filter")}),this.state.refresh()):m.route.set("/")},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return o.add("pollGroupList",m(ko,{state:this.state}),10),o},e}(Oo),Uo=function(t){function e(){return t.apply(this,arguments)||this}P(e,t);var n=e.prototype;return n.oninit=function(t){var e=this;if(o().forum.attribute("canViewPollGroups")){var n=m.route.param("id");this.pollGroup=o().store.getById("poll",n)||null,this.pollGroup||(this.loading=!0,o().store.find("fof/polls/groups",n).then((function(t){e.pollGroup=t,e.loading=!1,o().setTitle(e.pollGroup.name()),m.redraw()})))}else m.route.set("/")},n.contentItems=function(){var o=t.prototype.contentItems.call(this);return this.pollGroup&&o.add("pollGroup",m(Go,{pollGroup:this.pollGroup})),o},e}(Oo),Do={CreatePollModal:uo,PostPoll:yo,EditPollModal:go,ListVotersModal:St,PollForm:io,ComposePollHero:J,ComposePollPage:nt,PollsPage:to,PollView:Mt,PollViewPage:Ft,PollSubmitButton:kt,PollOption:wt,PollOptions:Pt,PollsShowcasePage:xo,PollShowcase:_o,PollShowcaseItem:No,AbstractPollPage:qt,PollTitle:Lt,PollSubtitle:Et,PollImage:Nt,PollListItem:Ht,PollList:zt,PollGroupList:ko,PollGroupListItem:Go,AbstractPollGroupsPage:Oo,PollGroupListPage:Bo,PollGroupViewPage:Uo,PollGroupForm:Ao,ComposePollGroupPage:Co};const To=flarum.core.compat["common/Model"];var jo=e.n(To);const qo=flarum.core.compat["common/utils/computed"];var Fo=e.n(qo),Ho=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).tempOptions=void 0,o}P(o,t);var e=o.prototype;return e.question=function(){return jo().attribute("question").call(this)},e.subtitle=function(){return jo().attribute("subtitle").call(this)},e.image=function(){return jo().attribute("image").call(this)},e.imageUrl=function(){return jo().attribute("imageUrl").call(this)},e.imageAlt=function(){return jo().attribute("imageAlt").call(this)},e.isImageUpload=function(){return jo().attribute("isImageUpload").call(this)},e.hasEnded=function(){return jo().attribute("hasEnded").call(this)},e.endDate=function(){return jo().attribute("endDate",jo().transformDate).call(this)},e.publicPoll=function(){return jo().attribute("publicPoll").call(this)},e.hideVotes=function(){return jo().attribute("hideVotes").call(this)},e.allowChangeVote=function(){return jo().attribute("allowChangeVote").call(this)},e.allowMultipleVotes=function(){return jo().attribute("allowMultipleVotes").call(this)},e.maxVotes=function(){return jo().attribute("maxVotes").call(this)},e.voteCount=function(){return jo().attribute("voteCount").call(this)},e.canVote=function(){return jo().attribute("canVote").call(this)},e.canEdit=function(){return jo().attribute("canEdit").call(this)},e.canDelete=function(){return jo().attribute("canDelete").call(this)},e.canSeeVoters=function(){return jo().attribute("canSeeVoters").call(this)},e.canChangeVote=function(){return jo().attribute("canChangeVote").call(this)},e.options=function(){return jo().hasMany("options").call(this)||[]},e.votes=function(){return jo().hasMany("votes").call(this)},e.myVotes=function(){return jo().hasMany("myVotes").call(this)||[]},e.pollGroup=function(){return jo().hasOne("pollGroup").call(this)},e.isGlobal=function(){return jo().attribute("isGlobal").call(this)},e.isHidden=function(){return Fo()("hiddenAt",(function(t){return!!t})).call(this)},e.isUnread=function(){return!1},e.apiEndpoint=function(){return"/fof/polls"+(this.exists?"/"+this.data.id:"")},o}(jo()),Ro=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.answer=function(){return jo().attribute("answer").call(this)},e.imageUrl=function(){return jo().attribute("imageUrl").call(this)},e.isImageUpload=function(){return jo().attribute("isImageUpload").call(this)},e.voteCount=function(){return jo().attribute("voteCount").call(this)},e.poll=function(){return jo().hasOne("polls").call(this)},e.votes=function(){return jo().hasMany("votes").call(this)},e.apiEndpoint=function(){return"/fof/polls/answers"+(this.exists?"/"+this.data.id:"")},o}(jo()),$o=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.poll=function(){return jo().hasOne("poll").call(this)},e.option=function(){var t=jo().hasOne("option").call(this);return!1===t?null:t},e.user=function(){return jo().hasOne("user").call(this)},e.pollId=function(){return jo().attribute("pollId").call(this)},e.optionId=function(){return jo().attribute("optionId").call(this)},e.apiEndpoint=function(){return"/fof/polls/"+this.pollId()+"/vote"},o}(jo()),zo=function(t){function o(){return t.apply(this,arguments)||this}P(o,t);var e=o.prototype;return e.name=function(){return jo().attribute("name").call(this)},e.createdAt=function(){return jo().attribute("createdAt",jo().transformDate).call(this)},e.polls=function(){return jo().hasMany("polls").call(this)||null},e.canEdit=function(){return jo().attribute("canEdit").call(this)},e.canDelete=function(){return jo().attribute("canDelete").call(this)},e.apiEndpoint=function(){return"/fof/polls/groups"+(this.exists?"/"+this.id():"")},o}(jo()),Yo={Poll:Ho,PollOption:Ro,PollVote:$o,PollGroup:zo},Qo={PollFormState:F,PollListState:Zt,PollState:Gt,PollGroupFormState:Io,PollGroupListState:Mo},Wo={PollControls:no,PollGroupControls:So};const Jo=flarum.core.compat["common/extenders"];var Ko=e.n(Jo);const Xo=flarum.core.compat["common/models/Post"];var Zo=e.n(Xo);const te=flarum.core.compat["common/models/Forum"];var oe=e.n(te);const ee=[(new(Ko().Routes)).add("fof.polls.showcase","/polls",xo).add("fof.polls.list","/polls/all",to).add("fof.polls.view","/polls/view/:id",Ft).add("fof.polls.composer","/polls/composer",nt).add("fof.polls.groups.composer","/polls/groups/composer",Co).add("fof.polls.groups.list","/polls/groups",Bo).add("fof.polls.groups.view","/polls/groups/:id",Uo),(new(Ko().Store)).add("polls",Ho).add("poll_options",Ro).add("poll_votes",$o).add("poll_groups",zo),new(Ko().Model)(Zo()).hasMany("polls").attribute("canStartPoll"),new(Ko().Model)(oe()).attribute("canStartPolls"),new(Ko().Model)(c()).attribute("hasPoll").attribute("canStartPoll")];o().initializers.add("fof/polls",(function(){var t;(0,r.extend)(i().prototype,"requestParams",(function(t){t.include.push("poll")})),(0,r.extend)(c().prototype,"badges",(function(t){this.hasPoll()&&t.add("poll",a().component({type:"poll",label:o().translator.trans("fof-polls.forum.tooltip.badge"),icon:"fas fa-poll"}),5)})),po(h()),po(g()),(0,r.extend)(fo().prototype,"content",(function(t){var o=this.attrs.post;if((!o.isHidden()||this.revealContent)&&o.polls())for(var e,n=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return bo(t,o);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?bo(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.polls());!(e=n()).done;){var r=e.value;r&&t.push(m(yo,{post:o,poll:r}))}})),(0,r.extend)(fo().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var o=t.attrs.post.polls(),e=null==o||null==o.map?void 0:o.map((function(t){var o,e,n,r,l;return t&&[null==(o=t.data)?void 0:o.attributes,null==(e=(n=t.options()).map)?void 0:e.call(n,(function(t){var o;return null==t||null==(o=t.data)?void 0:o.attributes})),null==(r=(l=t.myVotes()).map)?void 0:r.call(l,(function(t){var o;return null==(o=t.option())?void 0:o.id()}))]}));return JSON.stringify(e)}))})),(0,r.extend)(vo().prototype,"oncreate",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.bind("updatedPollOptions",(function(t){var e=o().store.getById("polls",t.pollId);e&&e.pushAttributes({voteCount:t.pollVoteCount});var n=t.options;for(var r in n){var l=o().store.getById("poll_options",r);l&&void 0!==l.voteCount()&&l.pushAttributes({voteCount:n[r]})}m.redraw()}))}))})),(0,r.extend)(vo().prototype,"onremove",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.unbind("updatedPollOptions")}))})),t=function(t){return o().modal.show(uo,{onsubmit:function(e){return o().store.createRecord("polls").save(ro({},e,{relationships:{post:t}}),{data:{include:"options,myVotes,myVotes.option"}}).then((function(o){var e;return null==(e=t.rawRelationship("polls"))||null==e.push||e.push({type:"polls",id:o.id()}),o}))}})},(0,r.extend)(Po(),"moderationControls",(function(e,n){!n.isHidden()&&n.canStartPoll()&&e.add("addPoll",m(S(),{icon:"fas fa-poll",onclick:t.bind(this,n)},o().translator.trans("fof-polls.forum.moderation.add")))})),(0,r.extend)(et().prototype,"navItems",(function(t){o().forum.attribute("globalPollsEnabled")&&(t.add("fof-polls-showcase",W().component({href:o().route("fof.polls.showcase"),icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.page.nav")),35),o().forum.attribute("canStartGlobalPolls")&&(t.add("fof-polls-list",W().component({href:o().route("fof.polls.list"),icon:"fas fa-list"},o().translator.trans("fof-polls.forum.page.nav-all")),32),o().forum.attribute("canViewPollGroups")&&t.add("fof-poll-groups-list",W().component({href:o().route("fof.polls.groups.list"),icon:"fas fa-layer-group"},o().translator.trans("fof-polls.forum.page.nav-groups")),30)))}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map