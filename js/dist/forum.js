/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,o,e)=>{var n=e(735).default;function r(){"use strict";t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var o,e={},a=Object.prototype,s=a.hasOwnProperty,i=Object.defineProperty||function(t,o,e){t[o]=e.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",p=l.toStringTag||"@@toStringTag";function m(t,o,e){return Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[o]}try{m({},"")}catch(o){m=function(t,o,e){return t[o]=e}}function f(t,o,e,n){var r=o&&o.prototype instanceof w?o:w,a=Object.create(r.prototype),s=new E(n||[]);return i(a,"_invoke",{value:A(t,e,s)}),a}function d(t,o,e){try{return{type:"normal",arg:t.call(o,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",v="suspendedYield",y="executing",b="completed",g={};function w(){}function P(){}function x(){}var N={};m(N,u,(function(){return this}));var _=Object.getPrototypeOf,V=_&&_(_(L([])));V&&V!==a&&s.call(V,u)&&(N=V);var O=x.prototype=w.prototype=Object.create(N);function C(t){["next","throw","return"].forEach((function(o){m(t,o,(function(t){return this._invoke(o,t)}))}))}function S(t,o){function e(r,a,i,l){var u=d(t[r],t,a);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==n(p)&&s.call(p,"__await")?o.resolve(p.__await).then((function(t){e("next",t,i,l)}),(function(t){e("throw",t,i,l)})):o.resolve(p).then((function(t){c.value=t,i(c)}),(function(t){return e("throw",t,i,l)}))}l(u.arg)}var r;i(this,"_invoke",{value:function(t,n){function a(){return new o((function(o,r){e(t,n,o,r)}))}return r=r?r.then(a,a):a()}})}function A(t,e,n){var r=h;return function(a,s){if(r===y)throw new Error("Generator is already running");if(r===b){if("throw"===a)throw s;return{value:o,done:!0}}for(n.method=a,n.arg=s;;){var i=n.delegate;if(i){var l=I(i,n);if(l){if(l===g)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=b,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=y;var u=d(t,e,n);if("normal"===u.type){if(r=n.done?b:v,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=b,n.method="throw",n.arg=u.arg)}}}function I(t,e){var n=e.method,r=t.iterator[n];if(r===o)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=o,I(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,g;var s=a.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=o),e.delegate=null,g):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function k(t){var o={tryLoc:t[0]};1 in t&&(o.catchLoc=t[1]),2 in t&&(o.finallyLoc=t[2],o.afterLoc=t[3]),this.tryEntries.push(o)}function M(t){var o=t.completion||{};o.type="normal",delete o.arg,t.completion=o}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function L(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=o,e.done=!0,e};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return P.prototype=x,i(O,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:P,configurable:!0}),P.displayName=m(x,p,"GeneratorFunction"),e.isGeneratorFunction=function(t){var o="function"==typeof t&&t.constructor;return!!o&&(o===P||"GeneratorFunction"===(o.displayName||o.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,m(t,p,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},C(S.prototype),m(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,o,n,r,a){void 0===a&&(a=Promise);var s=new S(f(t,o,n,r),a);return e.isGeneratorFunction(o)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},C(O),m(O,p,"Generator"),m(O,u,(function(){return this})),m(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var o=Object(t),e=[];for(var n in o)e.push(n);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in o)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=L,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(M),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=o),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=s.call(a,"catchLoc"),u=s.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,o){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=o&&o<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=o,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(t,o){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&o&&(this.next=o),g},finish:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),M(e),g}},catch:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var r=n.arg;M(e)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:L(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=o),g}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,o,e)=>{var n=e(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},o={};function e(n){var r=o[n];if(void 0!==r)return r.exports;var a=o[n]={exports:{}};return t[n](a,a.exports,e),a.exports}e.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},e.d=(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},e.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";e.r(n),e.d(n,{components:()=>mo,extend:()=>Ao,models:()=>Po,states:()=>xo});const t=flarum.core.compat["forum/app"];var o=e.n(t);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/Badge"];var s=e.n(a);const i=flarum.core.compat["forum/components/DiscussionList"];var l=e.n(i);const u=flarum.core.compat["common/models/Discussion"];var c=e.n(u);const p=flarum.core.compat["common/utils/classList"];var f=e.n(p);const d=flarum.core.compat["forum/components/DiscussionComposer"];var h=e.n(d);const v=flarum.core.compat["forum/components/ReplyComposer"];var y=e.n(v);function b(t,o){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},b(t,o)}function g(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,b(t,o)}const w=flarum.core.compat["common/components/Modal"];var P=e.n(w);function x(t,o,e,n,r,a,s){try{var i=t[a](s),l=i.value}catch(t){return void e(t)}i.done?o(l):Promise.resolve(l).then(n,r)}function N(t){return function(){var o=this,e=arguments;return new Promise((function(n,r){var a=t.apply(o,e);function s(t){x(a,n,r,s,i,"next",t)}function i(t){x(a,n,r,s,i,"throw",t)}s(void 0)}))}}var _=e(183),V=e.n(_);const O=flarum.core.compat["common/Component"];var C=e.n(O);const S=flarum.core.compat["common/components/Button"];var A=e.n(S);const I=flarum.core.compat["common/components/Switch"];var k=e.n(I);const M=flarum.core.compat["common/utils/ItemList"];var E=e.n(M);const L=flarum.core.compat["common/utils/Stream"];var D=e.n(L);const B=flarum.core.compat["common/utils/extractText"];var j=e.n(B);function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function R(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(R=function(){return!!t})()}function U(t){var o="function"==typeof Map?new Map:void 0;return U=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(o){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return function(t,o,e){if(R())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,o);var r=new(t.bind.apply(t,n));return e&&b(r,e.prototype),r}(t,arguments,T(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),b(e,t)},U(t)}var F=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o}(U(Error)),q=function(){function t(o){this.poll=void 0,this.loading=void 0,this.deleting=void 0,this.expandedGroup=void 0,o||(o=t.createNewPoll()),this.loading=!1,this.deleting=!1,this.poll=o,this.expandedGroup="setup"}t.createNewPoll=function(){var t=o().store.createRecord("polls");return t.pushAttributes({question:"",endDate:"",publicPoll:!1,allowMultipleVotes:!1,hideVotes:!1,allowChangeVote:!1,maxVotes:0}),t.pushData({relationships:{options:[]}}),t};var e=t.prototype;return e.isExpanded=function(t){return this.expandedGroup===t},e.expand=function(t){this.expandedGroup=t,m.redraw()},e.save=function(){var t=N(V().mark((function t(o){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.save(o);case 5:this.poll=t.sent;case 6:return t.prev=6,this.loading=!1,m.redraw(),t.finish(6);case 10:case"end":return t.stop()}}),t,this,[[2,,6,10]])})));return function(o){return t.apply(this,arguments)}}(),e.delete=function(){var t=N(V().mark((function t(){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),t.prev=2,t.next=5,this.poll.delete();case 5:this.deleting=!0;case 6:return t.prev=6,this.loading=!1,m.redraw(),t.finish(6);case 10:case"end":return t.stop()}}),t,this,[[2,,6,10]])})));return function(){return t.apply(this,arguments)}}(),t}();const H=flarum.core.compat["common/components/Page"];var G=e.n(H);const Y=flarum.core.compat["common/components/LoadingIndicator"];var z=e.n(Y);const $=flarum.core.compat["common/components/LinkButton"];var J=e.n($),K=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=void 0,o}g(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.poll=this.attrs.poll},n.view=function(){return m("div",{className:"ComposeGoodieCollectionHero Hero IndexPageHero"},m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h2",{className:"Hero-title"},o().translator.trans("fof-polls.forum.compose."+(this.poll.id()?"edit":"add")+"_title")),m("div",{className:"IndexPageHero-controls"},this.controlItems().toArray()))))},n.controlItems=function(){var t=new(E());return t.add("edit",m(J(),{icon:"far fa-edit",className:"Button Button--secondary IndexPage-newDiscussion GoodiesManagerLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.list")},o().translator.trans("fof-polls.forum.compose.polls_manager"))),this.poll.exists&&t.add("view",m(J(),{icon:"far fa-arrow-up-right-from-square",className:"Button Button--secondary IndexPage-newDiscussion GoodiePreviewLink",itemClassName:"App-primaryControl",href:o().route("fof.polls.view",{id:this.poll.id()})},o().translator.trans("fof-polls.forum.compose.polls_preview"))),t},e}(C());const Q=flarum.core.compat["common/helpers/listItems"];var W=e.n(Q);const X=flarum.core.compat["common/components/SelectDropdown"];var Z=e.n(X);const tt=flarum.core.compat["forum/components/IndexPage"];var ot=e.n(tt),et=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=null,o.loading=!1,o}g(e,t);var n=e.prototype;return n.oninit=function(e){var n,r,a=this;t.prototype.oninit.call(this,e);var s=m.route.param("id");s?(this.poll=o().store.getById("poll",s),this.poll||(this.loading=!0,o().store.find("fof/polls",s).then((function(t){var e;a.poll=t,a.loading=!1,o().setTitle(o().translator.trans("fof-polls.forum.compose."+(null!=(e=a.poll)&&e.id()?"edit":"add")+"_title")),m.redraw()})))):this.poll=q.createNewPoll(),o().history.push("compose-poll",o().translator.trans("fof-polls.forum.compose."+(null!=(n=this.poll)&&n.id()?"edit":"add")+"_title")),this.bodyClass="App--compose-poll",o().setTitle(o().translator.trans("fof-polls.forum.compose."+(null!=(r=this.poll)&&r.id()?"edit":"add")+"_title"))},n.view=function(){if(o().forum.attribute("canStartGlobalPolls"))return this.loading?m(z(),null):m("div",{className:"ComposePollCollectionPage"},m(K,{poll:this.poll}),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsPage-nav sideNav"},m("ul",null,W()(this.sidebarItems().toArray()))),m("div",{className:"sideNavOffset"},m(Qt,{poll:this.poll,onsubmit:this.onsubmit.bind(this)})))));m.route.set("/")},n.onsubmit=function(){var t=N(V().mark((function t(e,n){var r,a,s;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=void 0===n.poll.id(),t.next=3,n.save(e);case 3:a=r?{type:"success",controls:[m(A(),{className:"Button Button--link",onclick:function(){return m.route.set(o().route("fof.polls.compose",{id:n.poll.id()}))}},o().translator.trans("fof-polls.forum.compose.continue_editing"))]}:{type:"success"},s=o().alerts.show(a,o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(s)}),1e4),r&&m.route.set(o().route("fof.polls.list"));case 7:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),n.sidebarItems=function(){var t=new(E());return t.add("nav",m(Z(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),t},n.navItems=function(){return ot().prototype.navItems()},e}(G());const nt=flarum.core.compat["common/utils/SubtreeRetainer"];var rt=e.n(nt);const at=flarum.core.compat["common/components/Dropdown"];var st=e.n(at);const it=flarum.core.compat["common/components/Link"];var lt=e.n(it);const ut=flarum.core.compat["common/helpers/highlight"];var ct=e.n(ut);const pt=flarum.core.compat["forum/utils/slidable"];var mt=e.n(pt);const ft=flarum.core.compat["common/helpers/icon"];var dt=e.n(ft),ht=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){return m("p",null,"PollPage")},o}(G());const vt=flarum.core.compat["common/utils/abbreviateNumber"];var yt=e.n(vt),bt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).subtree=void 0,o.poll=void 0,o.highlightRegExp=void 0,o}g(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.poll=this.attrs.poll,this.subtree=new(rt())((function(){return n.poll.freshness}),(function(){var t=o().session.user&&o().session.user.markedAllAsReadAt();return t&&t.getTime()}),(function(){return n.active()}))},n.elementAttrs=function(){return{className:f()("PollListItem",{active:this.active(),"PollListItem--hidden":this.poll.isHidden(),Slidable:"ontouchstart"in window})}},n.view=function(){var t=Kt.controls(this.poll,this).toArray(),o=this.elementAttrs();return m("div",o,this.controlsView(t),this.contentView(),this.slidableUnderneathView())},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"UserCard-controls PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.slidableUnderneathView=function(){var t=this.poll.isUnread();return m("span",{className:f()("Slidable-underneath Slidable-underneath--left Slidable-underneath--elastic",{disabled:!t}),onclick:this.markAsRead.bind(this)},dt()("fas fa-check"))},n.contentView=function(){return m("div",{className:f()("PollListItem-content")},this.mainView(),this.infoView())},n.mainView=function(){return m(lt(),{href:o().route("fof.polls.view",{id:this.poll.id()}),className:"PollListItem-main"},m("h2",{className:"PollListItem-title"},ct()(this.poll.question(),this.highlightRegExp)))},n.infoView=function(){return m("div",null,this.poll.subtitle()&&m("p",{className:"PollListItem-subtitle helpText"},this.poll.subtitle()),m("ul",{className:"UserCard-info"},W()(this.infoItems().toArray())))},n.oncreate=function(o){if(t.prototype.oncreate.call(this,o),"ontouchstart"in window){var e=mt()(this.element);this.$(".PollListItem-controls").on("hidden.bs.dropdown",(function(){return e.reset()}))}},n.onbeforeupdate=function(o){return t.prototype.onbeforeupdate.call(this,o),this.subtree.needsRebuild()},n.active=function(){return o().current.matches(ht,{poll:this.poll})},n.markAsRead=function(){this.poll.isUnread()&&(this.poll.save({lastVotedNumber:this.poll.voteCount()}),m.redraw())},n.infoItems=function(){var t=new(E()),e=!this.poll.hasEnded(),n=this.poll.endDate()?[dt()("fas fa-clock")," ",e?o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.poll.endDate()).fromNow()}):o().translator.trans("fof-polls.forum.poll_ended")]:[dt()("fas fa-om")," ",o().translator.trans("fof-polls.forum.poll_never_ends")];t.add("active",m("span",{className:f()("UserCard-lastSeen",{active:e})},n));var r=this.poll.voteCount();return void 0!==r&&t.add("discussion-count",m("div",{className:"userStat"},dt()("fas fa-poll fa-fw"),[" ",o().translator.trans("fof-polls.forum.polls_count",{count:yt()(r)})]),70),t},e}(C());const gt=flarum.core.compat["common/components/Placeholder"];var wt=e.n(gt),Pt=function(t){function e(){return t.apply(this,arguments)||this}return g(e,t),e.prototype.view=function(){var t,e=this.attrs.state,n=e.getParams(),r=e.isInitialLoading()||e.isLoadingNext();if(r?t=m(z(),null):e.hasNext()&&(t=m(A(),{className:"Button",onclick:e.loadNext.bind(e)},o().translator.trans("fof-polls.forum.polls_list.load_more_button"))),e.isEmpty()){var a=o().translator.trans("fof-polls.forum.polls_list.empty_text");return m("div",{className:"PollList"},m(wt(),{text:a}))}return e.pageSize,m("div",{className:f()("PollList",{"PollList--searchResults":e.isSearchResults()})},m("ul",{"aria-busy":r,className:"PollList-polls"},e.getPages().map((function(t){return t.items.map((function(t){return m("li",{key:t.id(),"data-id":t.id()},m(bt,{poll:t,params:n}))}))}))),m("div",{className:"PollList-loadMore"},t))},e}(C());const xt=flarum.core.compat["forum/components/LogInModal"];var Nt=e.n(xt);function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function Vt(t){var o=function(t,o){if("object"!=_t(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_t(o)?o:String(o)}function Ot(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vt(n.key),n)}}const Ct=flarum.core.compat["common/states/PaginatedListState"];var St=e.n(Ct);const At=flarum.core.compat["common/utils/EventEmitter"];function It(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}var kt=new(e.n(At)()),Mt=function(t){function e(o,e){var n;return void 0===e&&(e=1),(n=t.call(this,o,e,20)||this).extraPolls=[],n.eventEmitter=void 0,n.eventEmitter=kt.on("poll.deleted",n.deletePoll.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n))),n}g(e,t);var n,r,a=e.prototype;return a.requestParams=function(){var t,o={include:["options","votes"],filter:this.params.filter||{},sort:this.sortMap()[null!=(t=this.params.sort)?t:""]};return this.params.q&&(o.filter.q=this.params.q),o},a.loadPage=function(e){void 0===e&&(e=1);var n=o().preloadedApiDocument();return n?(this.initialLoading=!1,Promise.resolve(n)):t.prototype.loadPage.call(this,e)},a.clear=function(){t.prototype.clear.call(this),this.extraPolls=[]},a.sortMap=function(){var t={};return this.params.q&&(t.relevance=""),t.newest="-createdAt",t.oldest="createdAt",t},a.isSearchResults=function(){return!!this.params.q},a.removePoll=function(t){this.eventEmitter.emit("poll.deleted",t)},a.deletePoll=function(t){for(var o,e=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return It(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?It(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.pages);!(o=e()).done;){var n=o.value,r=n.items.indexOf(t);if(-1!==r){n.items.splice(r,1);break}}var a=this.extraPolls.indexOf(t);-1!==a&&this.extraPolls.splice(a),m.redraw()},a.addPoll=function(t){this.removePoll(t),this.extraPolls.unshift(t),m.redraw()},a.getAllItems=function(){return this.extraPolls.concat(t.prototype.getAllItems.call(this))},a.getPages=function(){var o=t.prototype.getPages.call(this);return this.extraPolls.length?[{number:-1,items:this.extraPolls}].concat(o):o},n=e,(r=[{key:"type",get:function(){return"fof/polls"}}])&&Ot(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}(St()),Et=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){return m("span",{id:"vote_"+this.attrs.id+"_label",className:"PollOption-label"},this.attrs.text)},o}(C()),Lt=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){var t=this.attrs.isResult;return m("input",{type:"radio",name:this.attrs.name,value:this.attrs.value,style:{opacity:t?0:1},className:"PollOption-input","aria-labelledby":this.attrs.name+"-"+this.attrs.id+"-label","aria-describedby":this.attrs.name+"-"+this.attrs.id+"-description",onchange:this.attrs.onchange})},o}(C()),Dt=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){var t=this.attrs.option;return m("label",{className:"PollOption"},m(Lt,{id:t.id(),isResult:!1,name:"vote",value:"Vote for this option",onchange:this.attrs.onchange}),m("span",{className:"PollOption-information"},m(Et,{id:t.id(),text:t.answer()})))},o}(C()),Bt=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){return m("span",{className:"PollResult-number"},this.attrs.number," %")},o}(C()),jt=function(t){function o(){return t.apply(this,arguments)||this}return g(o,t),o.prototype.view=function(){var t=this.attrs.option,o=this.attrs.state,e=t.voteCount();return e=e?100*e/o.overallVoteCount():0,m("label",{className:"PollResult"},m(Lt,{id:t.id(),isResult:!1,name:"vote",value:"Vote for this option"}),m("span",{className:"PollResult-information"},m("div",{className:"PollResult-row"},m(Et,{text:t.answer()}),m(Bt,{number:yt()(e)})),m("progress",{type:"range",min:"0",max:o.overallVoteCount(),value:e,className:"PollResult-bar"})))},o}(C()),Tt=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.view=function(){return m("div",{className:"Poll-options list-layout"},this.pollOptions().toArray())},e.pollOptions=function(){var t=new(E()),o=this.attrs.state;return o.showCheckMarks?this.attrs.options.forEach((function(e){t.add("option"+e.id(),m(Dt,{option:e,onchange:o.changeVote.bind(o,e)}))})):this.attrs.options.forEach((function(e){t.add("result"+e.id(),m(jt,{option:e,state:o}))})),t},o}(C());const Rt=flarum.core.compat["common/helpers/avatar"];var Ut=e.n(Rt);const Ft=flarum.core.compat["common/helpers/username"];var qt=e.n(Ft),Ht=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.loading=D()(!0),o().store.find("fof/polls",this.attrs.poll.id(),{include:"votes,votes.user,votes.option"}).then((function(){return n.loading(!1)})).finally((function(){return m.redraw()}))},n.className=function(){return"Modal--medium VotesModal"},n.title=function(){return o().translator.trans("fof-polls.forum.votes_modal.title")},n.content=function(){return m("div",{className:"Modal-body"},this.loading()?m(z(),null):this.attrs.poll.options().map(this.optionContent.bind(this)))},n.optionContent=function(t){var e=(this.attrs.poll.votes()||[]).filter((function(o){return t.id()===o.option().id()}));return m("div",{className:"VotesModal-option"},m("h2",null,t.answer()+":"),e.length?m("div",{className:"VotesModal-list"},e.map(this.voteContent.bind(this))):m("h4",null,o().translator.trans("fof-polls.forum.modal.no_voters")))},n.voteContent=function(t){var e=t.user(),n=e&&{href:o().route.user(e)};return m(lt(),n,Ut()(e)," ",qt()(e))},e}(P()),Gt=function(){function t(t){var e=this;this.poll=void 0,this.pendingSubmit=void 0,this.pendingOptions=void 0,this.loadingOptions=void 0,this.useSubmitUI=void 0,this.showCheckMarks=void 0,this.showVoters=function(){o().modal.show(Ht,{poll:e.poll})},this.preventClose=function(t){if(e.pendingOptions)return t.preventDefault(),!0},this.poll=t,this.pendingSubmit=!1,this.pendingOptions=null,this.loadingOptions=!1,this.useSubmitUI=!(null!=t&&t.canChangeVote())&&(null==t?void 0:t.allowMultipleVotes()),this.showCheckMarks=!o().session.user||!t.hasEnded()&&t.canVote()&&(!this.hasVoted()||t.canChangeVote())}var e=t.prototype;return e.hasVoted=function(){return this.poll.myVotes().length>0},e.overallVoteCount=function(){var t=this.poll.options();return Math.max(100,(t||[]).reduce((function(t,o){return t+o.voteCount()}),0))},e.showButton=function(){return this.useSubmitUI&&this.pendingSubmit},e.changeVote=function(t,e){var n=e.target;if(!o().session.user)return o().modal.show(Nt()),void(n.checked=!1);var r=this.pendingOptions||new Set(this.poll.myVotes().map((function(t){return t.option().id()}))),a=r.delete(t.id());this.poll.allowMultipleVotes()||r.clear(),a||r.add(t.id()),this.pendingOptions=r.size?r:null,this.pendingSubmit=!!this.pendingOptions,m.redraw()},e.hasSelectedOptions=function(){return this.pendingSubmit},e.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}))},e.submit=function(t,e,n){var r=this;return void 0===n&&(n=null),this.loadingOptions=!0,m.redraw(),o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.poll.id()+"/votes",body:{data:{optionIds:Array.from(t)}}}).then((function(t){o().store.pushPayload(t),null==e||e()})).catch((function(t){null==n||n(t)})).finally((function(){r.loadingOptions=!1,r.showCheckMarks=!1,m.redraw()}))},e.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},t}(),Yt=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new Gt(this.attrs.poll)},n.view=function(){var t=this.attrs.poll,e=this.state,n=Kt.controls(t,this);return n.add("view",m(A(),{onclick:e.showVoters,icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.public_poll"))),m("div",{className:"Poll","data-id":t.id()},this.controlsView(n.toArray()),m("div",{className:"Poll-wrapper"},this.createMainView().toArray()))},n.createMainView=function(){var t=new(E()),o=this.attrs.poll;return t.add("title",m("h2",{className:"Poll-title"},o.question())),t.add("subtitle",m("p",{className:"Poll-subtitle"},o.subtitle())),t.add("form",m("form",null,this.createFormItems().toArray())),t},n.createFormItems=function(){var t=this.state,e=new(E()),n=this.attrs.poll,r=this.infoItems(n.maxVotes());return e.add("elements",m("fieldset",null,m("legend",{className:"sr-only"},"app.translator.trans('fof-polls.forum.answers')"),m(Tt,{options:n.options(),state:t}))),e.add("sticky",m("div",{className:"Poll-sticky"},!r.isEmpty()&&m("div",{className:"helpText PollInfoText"},r.toArray()),m(A(),{className:"Button Button--primary Poll-submit",loading:t.loadingOptions,onclick:t.onsubmit.bind(t),disabled:!t.hasSelectedOptions()},o().translator.trans("fof-polls.forum.poll.submit_button")))),e},n.deletePoll=function(){Kt.deleteAction(this.attrs.poll)},n.editPoll=function(){Kt.editAction(this.attrs.poll)},n.controlsView=function(t){return!!t.length&&m(st(),{icon:"fas fa-ellipsis-v",className:"PollListItem-controls",menuClassName:"Dropdown-menu--right",buttonClassName:"Button Button--icon Button--flat",accessibleToggleLabel:o().translator.trans("fof-polls.forum.poll_controls.toggle_dropdown_accessible_label")},t)},n.infoItems=function(t){var e=new(E()),n=this.attrs.poll;return!o().session.user||n.canVote()||n.hasEnded()||e.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),n.endDate()&&e.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),n.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(n.endDate()).fromNow()}))),n.canVote()&&(e.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),n.canChangeVote()||e.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(this.state.hasVoted()?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),e},e}(C()),zt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).loading=!1,o.poll=null,o}g(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state=new Mt({sort:m.route.param("sort"),filter:m.route.param("filter")}),this.state.refresh(),o().setTitle(j()(o().translator.trans("fof-polls.forum.page.nav")))},n.oncreate=function(o){t.prototype.oncreate.call(this,o)},n.view=function(){return this.loading?m(z(),null):this.poll?m("div",{className:"PollsPage"},m("div",{className:"container"},m(Yt,{poll:this.poll}))):m("div",{className:"PollsPage"},ot().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"PollsPage-nav sideNav"},m("ul",null,W()(this.sidebarItems().toArray()))),m("div",{className:"PollsPage-results sideNavOffset"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},W()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},W()(this.actionItems().toArray()))),m(Pt,{state:this.state})))))},n.sidebarItems=function(){var t=this,e=new(E()),n=o().forum.attribute("canStartGlobalPolls");return e.add("newGlobalPoll",m(A(),{icon:"fas fa-edit",className:"Button Button--primary App-primaryControl PollsPage-newPoll",itemClassName:"App-primaryControl",onclick:function(){t.newPollAction()},disabled:!n},o().translator.trans("fof-polls.forum.poll."+(n?"start_poll_button":"cannot_start_poll_button")))),e.add("nav",m(Z(),{buttonClassName:"Button",className:"App-titleControl",accessibleToggleLabel:o().translator.trans("core.forum.index.toggle_sidenav_dropdown_accessible_label")},this.navItems().toArray())),e},n.actionItems=function(){var t=this,e=new(E());return e.add("refresh",A().component({title:o().translator.trans("fof-polls.forum.page.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:function(){t.state.refresh()}})),e},n.viewItems=function(){return ot().prototype.viewItems()},n.navItems=function(){return ot().prototype.navItems()},n.newPollAction=function(){o().session.user?m.route.set(o().route("fof.polls.compose")):o().modal.show(Nt())},e}(G());const $t=flarum.core.compat["common/components/Separator"];var Jt=e.n($t);const Kt={controls:function(t,o){var e=this,n=new(E());return["poll","moderation","destructive"].forEach((function(r){var a=e[r+"Controls"](t,o).toArray();a.length&&(a.forEach((function(t){return n.add(t.itemName,t)})),n.add(r+"Separator",m(Jt(),null)))})),n},pollControls:function(t,o){return new(E())},moderationControls:function(t,e){var n=new(E());return t.canEdit()&&n.add("edit",m(A(),{icon:"fas fa-pen",onclick:this.editAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.edit_label"))),n},destructiveControls:function(t,e){var n=new(E());return t.canDelete()&&n.add("delete",m(A(),{icon:"fas fa-times",onclick:this.deleteAction.bind(this,t)},o().translator.trans("fof-polls.forum.poll_controls.delete_label"))),n},deleteAction:function(t){var e=this;return N(V().mark((function n(){return V().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(confirm(o().translator.trans("fof-polls.forum.poll_controls.delete_confirmation"))){n.next=2;break}return n.abrupt("return");case 2:return n.abrupt("return",t.delete().then((function(){e.showDeletionAlert(t,"success"),o().current.matches(et,{id:t.id()})||o().current.matches(zt,{id:t.id()})?o().history.back():window.location.reload()})).catch((function(){return e.showDeletionAlert(t,"error")})));case 3:case"end":return n.stop()}}),n)})))()},showDeletionAlert:function(t,e){var n={success:"$fof-polls.forum.poll_controls.delete_success_message",error:"fof-polls.forum.poll_controls.delete_error_message"}[e];o().alerts.show({type:e},o().translator.trans(n,{poll:t}))},editAction:function(t){m.route.set(o().route("fof.polls.compose",{id:t.id()}))}};var Qt=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).state=void 0,o.options=void 0,o}g(e,t);var n=e.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new q(this.attrs.poll);var e=this.state.poll;this.options=e.options(),this.optionAnswers=this.options.map((function(t){return D()(t.answer())})),this.optionImageUrls=this.options.map((function(t){return D()(t.imageUrl())})),this.question=D()(e.question()),this.subtitle=D()(e.subtitle()),this.endDate=D()(this.formatDate(e.endDate())),this.publicPoll=D()(e.publicPoll()),this.allowMultipleVotes=D()(e.allowMultipleVotes()),this.hideVotes=D()(e.hideVotes()),this.allowChangeVote=D()(e.allowChangeVote()),this.maxVotes=D()(e.maxVotes()||0),this.datepickerMinDate=this.formatDate(void 0),this.endDate()&&dayjs(e.endDate).isAfter(dayjs())&&(this.datepickerMinDate=this.formatDate(e.endDate))},n.view=function(){return m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"PollDiscussionModal-form"},this.fields().toArray()))},n.fields=function(){var t=new(E());return t.add("question",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.question_placeholder")),m("input",{type:"text",name:"question",className:"FormControl",bidi:this.question})),100),t.add("subtitle",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.subtitle_placeholder")),m("input",{type:"text",name:"subtitle",className:"FormControl",bidi:this.subtitle})),95),t.add("answers",m("div",{className:"PollModal--answers Form-group"},m("label",{className:"label PollModal--answers-title"},m("span",null,o().translator.trans("fof-polls.forum.modal.options_label")),A().component({className:"Button PollModal--button Button--icon small",icon:"fas fa-plus",onclick:this.addOption.bind(this)})),this.displayOptions()),80),t.add("date",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.date_placeholder")),m("div",{className:"PollModal--date"},m("input",{className:"FormControl",type:"datetime-local",name:"date",bidi:this.endDate,min:this.datepickerMinDate,max:this.formatDate("2038")}),A().component({className:"Button PollModal--button Button--icon",icon:"fas fa-times",onclick:this.endDate.bind(this,null)})),this.endDate()&&m("p",{className:"helpText"},m("i",{class:"icon fas fa-clock"})," ",dayjs(this.endDate()).isBefore(dayjs())?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(this.endDate()).fromNow()}))),40),t.add("public",m("div",{className:"Form-group"},k().component({state:this.publicPoll()||!1,onchange:this.publicPoll},o().translator.trans("fof-polls.forum.modal.public_poll_label"))),20),t.add("hide-votes",m("div",{className:"Form-group"},m(k(),{state:this.endDate()&&this.hideVotes(),onchange:this.hideVotes,disabled:!this.endDate()},o().translator.trans("fof-polls.forum.modal.hide_votes_label"))),20),t.add("allow-change-vote",m("div",{className:"Form-group"},m(k(),{state:this.allowChangeVote(),onchange:this.allowChangeVote},o().translator.trans("fof-polls.forum.modal.allow_change_vote_label"))),20),t.add("allow-multiple-votes",m("div",{className:"Form-group"},k().component({state:this.allowMultipleVotes()||!1,onchange:this.allowMultipleVotes},o().translator.trans("fof-polls.forum.modal.allow_multiple_votes_label"))),15),this.allowMultipleVotes()&&t.add("max-votes",m("div",{className:"Form-group"},m("label",{className:"label"},o().translator.trans("fof-polls.forum.modal.max_votes_label")),m("input",{type:"number",min:"0",max:this.options.length,name:"maxVotes",className:"FormControl",bidi:this.maxVotes}),m("p",{className:"helpText"},o().translator.trans("fof-polls.forum.modal.max_votes_help"))),15),t.add("submit",m("div",{className:"Form-group"},m(A(),{type:"submit",className:"Button Button--primary PollModal-SubmitButton",icon:"fas fa-save",loading:this.state.loading},o().translator.trans("fof-polls.forum.modal.submit")),this.state.poll.exists&&m(A(),{className:"Button Button--secondary",icon:"fas fa-trash-alt",loading:this.state.deleting,onclick:this.delete.bind(this)},o().translator.trans("fof-polls.forum.modal.delete"))),-10),t},n.displayOptions=function(){var t=this;return Object.keys(this.options).map((function(e,n){return m("div",{className:"Form-group"},m("fieldset",{className:"Poll-answer-input"},m("input",{className:"FormControl",type:"text",name:"answer"+(n+1),bidi:t.optionAnswers[n],placeholder:o().translator.trans("fof-polls.forum.modal.option_placeholder")+" #"+(n+1)}),o().forum.attribute("allowPollOptionImage")?m("input",{className:"FormControl",type:"text",name:"answerImage"+(n+1),bidi:t.optionImageUrls[n],placeholder:o().translator.trans("fof-polls.forum.modal.image_option_placeholder")+" #"+(n+1)}):null),n>=2?A().component({type:"button",className:"Button PollModal--button Button--icon",icon:"fas fa-minus",onclick:n>=2?t.removeOption.bind(t,n):""}):"")}))},n.addOption=function(){var t=Math.max(o().forum.attribute("pollMaxOptions"),2);this.options.length<t?(this.options.push(o().store.createRecord("poll_options")),this.optionAnswers.push(D()("")),this.optionImageUrls.push(D()(""))):alert(j()(o().translator.trans("fof-polls.forum.modal.max",{max:t})))},n.removeOption=function(t){this.options.splice(t,1),this.optionAnswers.splice(t,1),this.optionImageUrls.splice(t,1)},n.data=function(){var t=this;if(""===this.question())throw new F(o().translator.trans("fof-polls.forum.modal.include_question"));if(this.options.length<2)throw new F(o().translator.trans("fof-polls.forum.modal.min"));var e=this.state.poll.exists,n=this.options.map((function(o,n){return o.pushAttributes({answer:t.optionAnswers[n](),imageUrl:t.optionImageUrls[n]()}),e?o.data:o.data.attributes}));return{question:this.question(),subtitle:this.subtitle(),endDate:this.dateToTimestamp(this.endDate()),publicPoll:this.publicPoll(),hideVotes:this.hideVotes(),allowChangeVote:this.allowChangeVote(),allowMultipleVotes:this.allowMultipleVotes(),maxVotes:this.maxVotes(),options:n}},n.onsubmit=function(){var t=N(V().mark((function t(e){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.prev=1,t.next=4,this.attrs.onsubmit(this.data(),this.state);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),t.t0 instanceof F?o().alerts.show({type:"error"},t.t0.message):(console.error(t.t0),o().alerts.show({type:"error"},o().translator.trans("fof-polls.forum.modal.error")));case 9:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(o){return t.apply(this,arguments)}}(),n.delete=function(){var t=N(V().mark((function t(){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.state.loading=!0,t.prev=1,t.next=4,Kt.deleteAction(this.state.poll);case 4:this.state.deleting=!0;case 5:return t.prev=5,this.state.loading=!1,m.redraw(),t.finish(5);case 9:case"end":return t.stop()}}),t,this,[[1,,5,9]])})));return function(){return t.apply(this,arguments)}}(),n.formatDate=function(t,o){void 0===o&&(o=!1);var e=dayjs(t);return!1!==t&&e.isValid()?e.format("YYYY-MM-DDTHH:mm"):!1!==o?this.formatDate(o):null},n.dateToTimestamp=function(t){var o=dayjs(t);return!(!t||!o.isValid())&&o.format()},e}(C()),Wt=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.add_title")},n.className=function(){return"PollDiscussionModal Modal--medium"},n.content=function(){return[m("div",{className:"Modal-body"},m(Qt,{poll:this.attrs.poll,onsubmit:this.onsubmit.bind(this)}))]},n.onsubmit=function(t){this.hide(),this.attrs.onsubmit(t)},e}(P()),Xt=function(t){t.prototype.addPoll=function(){var t=this;o().modal.show(Wt,{poll:this.composer.fields.poll,onsubmit:function(o){return t.composer.fields.poll=o}})},(0,r.extend)(t.prototype,"headerItems",(function(t){var e,n,r=null==(e=this.composer.body)||null==(e=e.attrs)?void 0:e.discussion;(null!=(n=null==r?void 0:r.canStartPoll())?n:o().forum.canStartPolls())&&t.add("polls",m("a",{className:"ComposerBody-poll",onclick:this.addPoll.bind(this)},m("span",{className:f()("PollLabel",!this.composer.fields.poll&&"none")},o().translator.trans("fof-polls.forum.composer_discussion."+(this.composer.fields.poll?"edit":"add")+"_poll"))),1)})),(0,r.extend)(t.prototype,"data",(function(t){this.composer.fields.poll&&(t.poll=this.composer.fields.poll)}))};const Zt=flarum.core.compat["forum/components/CommentPost"];var to=e.n(Zt);const oo=flarum.core.compat["common/components/Tooltip"];var eo=e.n(oo),no=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var n=e.prototype;return n.title=function(){return o().translator.trans("fof-polls.forum.modal.edit_title")},n.onsubmit=function(){var t=N(V().mark((function t(e,n){var r;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.save(e);case 2:r=o().alerts.show({type:"success"},o().translator.trans("fof-polls.forum.compose.success")),setTimeout((function(){return o().alerts.dismiss(r)}),1e4);case 4:case"end":return t.stop()}}),t)})));return function(o,e){return t.apply(this,arguments)}}(),e}(Wt),ro=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var n=e.prototype;return n.oninit=function(o){var e,n;t.prototype.oninit.call(this,o),this.loadingOptions=!1,this.useSubmitUI=!(null!=(e=this.attrs.poll)&&e.canChangeVote())&&(null==(n=this.attrs.poll)?void 0:n.allowMultipleVotes()),this.pendingSubmit=!1,this.pendingOptions=null},n.oncreate=function(o){t.prototype.oncreate.call(this,o),this.preventClose=this.preventClose.bind(this),window.addEventListener("beforeunload",this.preventClose)},n.onremove=function(o){t.prototype.onremove.call(this,o),window.removeEventListener("beforeunload",this.preventClose)},n.view=function(){var t=this.attrs.poll,e=t.options()||[],n=t.allowMultipleVotes()?t.maxVotes():1;0===n&&(n=e.length);var r=this.infoItems(n);return m("div",{className:"Post-poll","data-id":t.id()},m("div",{className:"PollHeading"},m("div",{className:"PollHeading-title-container"},m("h3",{className:"PollHeading-title"},t.question()),t.subtitle()&&m("p",{className:"helpText PollHeading-subtitle"},t.subtitle())),m("div",{className:"PollHeading-actions"},t.canSeeVoters()&&m(eo(),{text:o().translator.trans("fof-polls.forum.public_poll")},m(A(),{className:"Button PollHeading-voters",onclick:this.showVoters.bind(this),icon:"fas fa-poll"})),t.canEdit()&&m(eo(),{text:o().translator.trans("fof-polls.forum.moderation.edit")},m(A(),{className:"Button PollHeading-edit",onclick:o().modal.show.bind(o().modal,no,{poll:t}),icon:"fas fa-pen"})),t.canDelete()&&m(eo(),{text:o().translator.trans("fof-polls.forum.moderation.delete")},m(A(),{className:"Button PollHeading-delete",onclick:this.deletePoll.bind(this),icon:"fas fa-trash"})))),m("div",null,m("div",{className:"PollOptions"},e.map(this.viewOption.bind(this))),m("div",{className:"Poll-sticky"},!r.isEmpty()&&m("div",{className:"helpText PollInfoText"},r.toArray()),this.useSubmitUI&&this.pendingSubmit&&m(A(),{className:"Button Button--primary Poll-submit",loading:this.loadingOptions,onclick:this.onsubmit.bind(this)},o().translator.trans("fof-polls.forum.poll.submit_button")))))},n.infoItems=function(t){var e,n=new(E()),r=this.attrs.poll,a=(null==(e=r.myVotes())?void 0:e.length)>0;return!o().session.user||r.canVote()||r.hasEnded()||n.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),o().translator.trans("fof-polls.forum.no_permission"))),r.endDate()&&n.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),r.hasEnded()?o().translator.trans("fof-polls.forum.poll_ended"):o().translator.trans("fof-polls.forum.days_remaining",{time:dayjs(r.endDate()).fromNow()}))),r.canVote()&&(n.add("max-votes",m("span",null,m("i",{className:"icon fas fa-poll fa-fw"}),o().translator.trans("fof-polls.forum.max_votes_allowed",{max:t}))),r.canChangeVote()||n.add("cannot-change-vote",m("span",null,m("i",{className:"icon fas fa-"+(a?"times":"exclamation")+"-circle fa-fw"}),o().translator.trans("fof-polls.forum.poll.cannot_change_vote")))),n},n.viewOption=function(t){var e,n,r,a=this.attrs.poll,s=(null==(e=a.myVotes())?void 0:e.length)>0,i=a.voteCount(),l=this.pendingOptions?this.pendingOptions.has(t.id()):null==(n=a.myVotes())||null==n.some?void 0:n.some((function(o){return o.option()===t})),u=t.voteCount(),c=i>0?Math.round(u/i*100):0,p="number"==typeof u,d=this.loadingOptions||s&&!a.canChangeVote(),h=p?c:Number(l)/((null==(r=a.myVotes())?void 0:r.length)||1)*100,v=!o().session.user||!a.hasEnded()&&a.canVote()&&(!s||a.canChangeVote()),y=m("div",{className:"PollBar","data-selected":!!l,style:"--poll-option-width: "+h+"%"},v&&m("label",{className:"PollAnswer-checkbox checkbox"},m("input",{onchange:this.changeVote.bind(this,t),type:"checkbox",checked:l,disabled:d}),m("span",{className:"checkmark"})),m("div",{className:"PollAnswer-text"},m("span",{className:"PollAnswer-text-answer"},t.answer()),l&&!v&&dt()("fas fa-check-circle",{className:"PollAnswer-check"}),p&&m("span",{className:f()("PollPercent",100!==c&&"PollPercent--option")},c,"%")),t.imageUrl()?m("img",{className:"PollAnswer-image",src:t.imageUrl(),alt:t.answer()}):null);return m("div",{className:f()("PollOption",s&&"PollVoted",a.hasEnded()&&"PollEnded",t.imageUrl()&&"PollOption-hasImage"),"data-id":t.id()},p?m(eo(),{text:o().translator.trans("fof-polls.forum.tooltip.votes",{count:u}),onremove:this.hideOptionTooltip},y):y)},n.changeVote=function(t,e){var n,r;if(!o().session.user)return o().modal.show(Nt()),void(e.target.checked=!1);var a=this.pendingOptions||new Set(null==(n=(r=this.attrs.poll.myVotes()).map)?void 0:n.call(r,(function(t){return t.option().id()}))),s=a.delete(t.id());return this.attrs.poll.allowMultipleVotes()||a.clear(),s||a.add(t.id()),this.useSubmitUI?(this.pendingOptions=a.size?a:null,void(this.pendingSubmit=!!this.pendingOptions)):this.submit(a,null,(function(){return e.target.checked=s}))},n.onsubmit=function(){var t=this;return this.submit(this.pendingOptions,(function(){t.pendingOptions=null,t.pendingSubmit=!1}))},n.submit=function(t,e,n){var r=this;return this.loadingOptions=!0,m.redraw(),o().request({method:"PATCH",url:o().forum.attribute("apiUrl")+"/fof/polls/"+this.attrs.poll.id()+"/votes",body:{data:{optionIds:Array.from(t)}}}).then((function(t){o().store.pushPayload(t),null==e||e()})).catch((function(t){null==n||n(t)})).finally((function(){r.loadingOptions=!1,m.redraw()}))},n.showVoters=function(){o().modal.show(Ht,{poll:this.attrs.poll,post:this.attrs.post})},n.deletePoll=function(){confirm(o().translator.trans("fof-polls.forum.moderation.delete_confirm"))&&this.attrs.poll.delete().then((function(){m.redraw.sync()}))},n.hideOptionTooltip=function(t){t.attrs.tooltipVisible=!1,t.state.updateVisibility()},n.preventClose=function(t){if(this.pendingOptions)return t.preventDefault(),!0},e}(C());const ao=flarum.core.compat["forum/components/DiscussionPage"];var so=e.n(ao);function io(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}function lo(){return lo=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},lo.apply(this,arguments)}const uo=flarum.core.compat["forum/utils/PostControls"];var co=e.n(uo),po=function(t){function e(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).poll=null,o.loading=!1,o}g(e,t);var n=e.prototype;return n.oninit=function(e){var n=this;t.prototype.oninit.call(this,e);var r=m.route.param("id");this.poll=o().store.getById("poll",r),this.poll||(this.loading=!0,o().store.find("fof/polls",r).then((function(t){n.poll=t,n.loading=!1,o().setTitle(j()(o().translator.trans("fof-polls.forum.page.poll_detail"))),m.redraw()})))},n.view=function(){return this.loading?m(z(),null):m("div",{className:"PollsPage"},m("div",{className:"container"},m(Yt,{poll:this.poll})))},e}(G()),mo={CreatePollModal:Wt,PostPoll:ro,EditPollModal:no,ListVotersModal:Ht,PollForm:Qt,ComposePollHero:K,ComposePollPage:et,PollsPage:zt,PollView:Yt,PollViewPage:po};const fo=flarum.core.compat["common/Model"];var ho=e.n(fo);const vo=flarum.core.compat["common/utils/computed"];var yo=e.n(vo),bo=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.question=function(){return ho().attribute("question").call(this)},e.subtitle=function(){return ho().attribute("subtitle").call(this)},e.hasEnded=function(){return ho().attribute("hasEnded").call(this)},e.endDate=function(){return ho().attribute("endDate",ho().transformDate).call(this)},e.publicPoll=function(){return ho().attribute("publicPoll").call(this)},e.hideVotes=function(){return ho().attribute("hideVotes").call(this)},e.allowChangeVote=function(){return ho().attribute("allowChangeVote").call(this)},e.allowMultipleVotes=function(){return ho().attribute("allowMultipleVotes").call(this)},e.maxVotes=function(){return ho().attribute("maxVotes").call(this)},e.voteCount=function(){return ho().attribute("voteCount").call(this)},e.canVote=function(){return ho().attribute("canVote").call(this)},e.canEdit=function(){return ho().attribute("canEdit").call(this)},e.canDelete=function(){return ho().attribute("canDelete").call(this)},e.canSeeVoters=function(){return ho().attribute("canSeeVoters").call(this)},e.canChangeVote=function(){return ho().attribute("canChangeVote").call(this)},e.options=function(){return ho().hasMany("options").call(this)},e.votes=function(){return ho().hasMany("votes").call(this)},e.myVotes=function(){return ho().hasMany("myVotes").call(this)||[]},e.isGlobal=function(){return ho().attribute("isGlobal").call(this)},e.isHidden=function(){return yo()("hiddenAt",(function(t){return!!t})).call(this)},e.isUnread=function(){return!1},e.apiEndpoint=function(){return"/fof/polls"+(this.exists?"/"+this.data.id:"")},o}(ho()),go=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.answer=function(){return ho().attribute("answer").call(this)},e.imageUrl=function(){return ho().attribute("imageUrl").call(this)},e.voteCount=function(){return ho().attribute("voteCount").call(this)},e.poll=function(){return ho().hasOne("polls").call(this)},e.votes=function(){return ho().hasMany("votes").call(this)},e.apiEndpoint=function(){return"/fof/polls/answers"+(this.exists?"/"+this.data.id:"")},o}(ho()),wo=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.poll=function(){return ho().hasOne("poll").call(this)},e.option=function(){return ho().hasOne("option").call(this)},e.user=function(){return ho().hasOne("user").call(this)},e.pollId=function(){return ho().attribute("pollId").call(this)},e.optionId=function(){return ho().attribute("optionId").call(this)},e.apiEndpoint=function(){return"/fof/polls/"+this.pollId()+"/vote"},o}(ho()),Po={Poll:bo,PollOption:go,PollVote:wo},xo={PollFormState:q,PollListState:Mt,PollState:Gt};const No=flarum.core.compat["common/extenders"];var _o=e.n(No);const Vo=flarum.core.compat["common/models/Post"];var Oo=e.n(Vo);const Co=flarum.core.compat["common/models/Forum"];var So=e.n(Co);const Ao=[(new(_o().Routes)).add("fof.polls.list","/polls",zt).add("fof.polls.view","/polls/view/:id",po).add("fof.polls.compose","/polls/composer",et),(new(_o().Store)).add("polls",bo).add("poll_options",go).add("poll_votes",wo),new(_o().Model)(Oo()).hasMany("polls").attribute("canStartPoll"),new(_o().Model)(So()).attribute("canStartPolls"),new(_o().Model)(c()).attribute("hasPoll").attribute("canStartPoll")];o().initializers.add("fof/polls",(function(){var t;(0,r.extend)(l().prototype,"requestParams",(function(t){t.include.push("poll")})),(0,r.extend)(c().prototype,"badges",(function(t){this.hasPoll()&&t.add("poll",s().component({type:"poll",label:o().translator.trans("fof-polls.forum.tooltip.badge"),icon:"fas fa-signal"}),5)})),Xt(h()),Xt(y()),(0,r.extend)(to().prototype,"content",(function(t){var o=this.attrs.post;if((!o.isHidden()||this.revealContent)&&o.polls())for(var e,n=function(t,o){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,o){if(t){if("string"==typeof t)return io(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?io(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.polls());!(e=n()).done;){var r=e.value;r&&t.push(m(ro,{post:o,poll:r}))}})),(0,r.extend)(to().prototype,"oninit",(function(){var t=this;this.subtree.check((function(){var o=t.attrs.post.polls(),e=null==o||null==o.map?void 0:o.map((function(t){var o,e,n,r,a;return t&&[null==(o=t.data)?void 0:o.attributes,null==(e=(n=t.options()).map)?void 0:e.call(n,(function(t){var o;return null==t||null==(o=t.data)?void 0:o.attributes})),null==(r=(a=t.myVotes()).map)?void 0:r.call(a,(function(t){var o;return null==(o=t.option())?void 0:o.id()}))]}));return JSON.stringify(e)}))})),(0,r.extend)(so().prototype,"oncreate",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.bind("updatedPollOptions",(function(t){var e=o().store.getById("polls",t.pollId);e&&e.pushAttributes({voteCount:t.pollVoteCount});var n=t.options;for(var r in n){var a=o().store.getById("poll_options",r);a&&void 0!==a.voteCount()&&a.pushAttributes({voteCount:n[r]})}m.redraw()}))}))})),(0,r.extend)(so().prototype,"onremove",(function(){o().pusher&&o().pusher.then((function(t){t.channels.main.unbind("updatedPollOptions")}))})),t=function(t){return o().modal.show(Wt,{onsubmit:function(e){return o().store.createRecord("polls").save(lo({},e,{relationships:{post:t}}),{data:{include:"options,myVotes,myVotes.option"}}).then((function(o){var e;return null==(e=t.rawRelationship("polls"))||null==e.push||e.push({type:"polls",id:o.id()}),o}))}})},(0,r.extend)(co(),"moderationControls",(function(e,n){!n.isHidden()&&n.canStartPoll()&&e.add("addPoll",m(A(),{icon:"fas fa-poll",onclick:t.bind(this,n)},o().translator.trans("fof-polls.forum.moderation.add")))})),(0,r.extend)(ot().prototype,"navItems",(function(t){t.add("fof-polls-list",J().component({href:o().route("fof.polls.list"),icon:"fas fa-poll"},o().translator.trans("fof-polls.forum.page.nav")),35)}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map